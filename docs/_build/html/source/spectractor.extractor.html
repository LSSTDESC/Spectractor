

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>spectractor.extractor package &mdash; Spectractor 1.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'1.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Spectractor
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">spectractor.extractor package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-spectractor.extractor.dispersers">spectractor.extractor.dispersers module</a></li>
<li><a class="reference internal" href="#module-spectractor.extractor.extractor">spectractor.extractor.extractor module</a></li>
<li><a class="reference internal" href="#module-spectractor.extractor.images">spectractor.extractor.images module</a></li>
<li><a class="reference internal" href="#module-spectractor.extractor.psf">spectractor.extractor.psf module</a></li>
<li><a class="reference internal" href="#module-spectractor.extractor.spectroscopy">spectractor.extractor.spectroscopy module</a></li>
<li><a class="reference internal" href="#module-spectractor.extractor.spectrum">spectractor.extractor.spectrum module</a></li>
<li><a class="reference internal" href="#module-spectractor.extractor.targets">spectractor.extractor.targets module</a></li>
<li><a class="reference internal" href="#module-spectractor.extractor">Module contents</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Spectractor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>spectractor.extractor package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/source/spectractor.extractor.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spectractor-extractor-package">
<h1>spectractor.extractor package<a class="headerlink" href="#spectractor-extractor-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-spectractor.extractor.dispersers">
<span id="spectractor-extractor-dispersers-module"></span><h2>spectractor.extractor.dispersers module<a class="headerlink" href="#module-spectractor.extractor.dispersers" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="spectractor.extractor.dispersers.Grating">
<em class="property">class </em><code class="descclassname">spectractor.extractor.dispersers.</code><code class="descname">Grating</code><span class="sig-paren">(</span><em>N</em>, <em>label=''</em>, <em>D=55.45</em>, <em>data_dir='/Users/jneveu/Documents/LSST/Calibration/Spectractor/spectractor/extractor/dispersers/'</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p>Generic class for dispersers.</p>
<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.N">
<code class="descname">N</code><span class="sig-paren">(</span><em>x</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.N"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.N" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of grooves per mm of the grating at position x.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>x</strong> (<a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – The [x,y] pixel position.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><strong>N</strong> – The number of grooves per mm at position x</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Grating</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">N</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">))</span>
<span class="go">400</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.grating_lambda_to_pixel">
<code class="descname">grating_lambda_to_pixel</code><span class="sig-paren">(</span><em>lambdas</em>, <em>x0</em>, <em>order=1</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.grating_lambda_to_pixel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.grating_lambda_to_pixel" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert wavelength in nm into pixel distance with order 0.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>lambdas</strong> (<a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Wavelengths in nm.</li>
<li><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em> or </em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>]</em>) – Order 0 position detected in the raw image.</li>
<li><strong>order</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Order of the spectrum (default: 1)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">disperser</span> <span class="o">=</span> <span class="n">Grating</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">55</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span><span class="mi">800</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deltaX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lambdas</span> <span class="o">=</span> <span class="n">disperser</span><span class="o">.</span><span class="n">grating_pixel_to_lambda</span><span class="p">(</span><span class="n">deltaX</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">lambdas</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[ 0.          1.45454532  2.90909063  4.36363511  5.81817793]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pixels</span> <span class="o">=</span> <span class="n">disperser</span><span class="o">.</span><span class="n">grating_lambda_to_pixel</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pixels</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[ 0.  1.  2.  3.  4.]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.grating_pixel_to_lambda">
<code class="descname">grating_pixel_to_lambda</code><span class="sig-paren">(</span><em>deltaX</em>, <em>x0</em>, <em>order=1</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.grating_pixel_to_lambda"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.grating_pixel_to_lambda" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert pixels into wavelengths (in nm) with.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>deltaX</strong> (<a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Pixel distances to order 0.</li>
<li><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em> or </em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>]</em>) – Order 0 position detected in the non-rotated image.</li>
<li><strong>order</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Order of the spectrum (default: 1)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">disperser</span> <span class="o">=</span> <span class="n">Grating</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">55</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span><span class="mi">800</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deltaX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lambdas</span> <span class="o">=</span> <span class="n">disperser</span><span class="o">.</span><span class="n">grating_pixel_to_lambda</span><span class="p">(</span><span class="n">deltaX</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">lambdas</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[ 0.          1.45454532  2.90909063  4.36363511  5.81817793]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pixels</span> <span class="o">=</span> <span class="n">disperser</span><span class="o">.</span><span class="n">grating_lambda_to_pixel</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pixels</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[ 0.  1.  2.  3.  4.]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.grating_resolution">
<code class="descname">grating_resolution</code><span class="sig-paren">(</span><em>deltaX</em>, <em>x0</em>, <em>order=1</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.grating_resolution"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.grating_resolution" title="Permalink to this definition">¶</a></dt>
<dd><p>Return wavelength resolution in nm per pixel.
See mathematica notebook: derivative of the grating formula.
x0: the order 0 position on the full raw image.
deltaX: the distance in pixels between order 0 and signal point
in the rotated image.</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.load_files">
<code class="descname">load_files</code><span class="sig-paren">(</span><em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.load_files"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.load_files" title="Permalink to this definition">¶</a></dt>
<dd><p>If they exists, load the files in data_dir/label/ to set the main
characteristics of the grating. Overrides the N input at initialisation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Set to True to get more verbosity.</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>The files exist:
&gt;&gt;&gt; g = Grating(400, label=’Ron400’)
&gt;&gt;&gt; g.N_input
400.86918248709316
&gt;&gt;&gt; print(g.theta_tilt)
-0.277</p>
<p>The files do not exist:
&gt;&gt;&gt; g = Grating(400, label=’XXX’)
&gt;&gt;&gt; g.N_input
400
&gt;&gt;&gt; print(g.theta_tilt)
0</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.plot_transmission">
<code class="descname">plot_transmission</code><span class="sig-paren">(</span><em>xlim=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.plot_transmission"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.plot_transmission" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the transmission of the grating with respect to the wavelength (in nm).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>xlim</strong> (<em>[</em><em>xmin</em><em>,</em><em>xmax</em><em>]</em><em>, </em><em>optional</em>) – List of the X axis extrema (default: None).</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Grating</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ron400&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">plot_transmission</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">800</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.refraction_angle">
<code class="descname">refraction_angle</code><span class="sig-paren">(</span><em>deltaX</em>, <em>x0</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.refraction_angle"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.refraction_angle" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the refraction angle with respect to the disperser normal, using geometrical consideration,
given the distance to order 0 in pixels.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>deltaX</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The distance in pixels between the order 0 and a spectrum pixel in the rotated image.</li>
<li><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – The order 0 position [x0,y0] in the full non-rotated image.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>theta</strong> – The refraction angle in radians.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Grating</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">refraction_angle</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="p">[</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="mi">500</span><span class="o">*</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_PIXEL2MM</span><span class="p">,</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISTANCE2CCD</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.refraction_angle_lambda">
<code class="descname">refraction_angle_lambda</code><span class="sig-paren">(</span><em>lambdas</em>, <em>x0</em>, <em>order=1</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.refraction_angle_lambda"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.refraction_angle_lambda" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the refraction angle with respect to the disperser normal, using geometrical consideration,
given the wavelength in nm and the order of the spectrum.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lambdas</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – The distance in pixels between the order 0 and a spectrum pixel in the rotated image.</li>
<li><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – The order 0 pixel position [x0,y0] in the full non-rotated image.</li>
<li><strong>order</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – The order of the spectrum.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>theta</strong> – The refraction angle in radians.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Grating</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">refraction_angle</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="p">[</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="mi">500</span><span class="o">*</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_PIXEL2MM</span><span class="p">,</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISTANCE2CCD</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.dispersers.Hologram">
<em class="property">class </em><code class="descclassname">spectractor.extractor.dispersers.</code><code class="descname">Hologram</code><span class="sig-paren">(</span><em>label</em>, <em>D=55.45</em>, <em>data_dir='/Users/jneveu/Documents/LSST/Calibration/Spectractor/spectractor/extractor/dispersers/'</em>, <em>lambda_plot=256000</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Hologram"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Hologram" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.dispersers.Grating" title="spectractor.extractor.dispersers.Grating"><code class="xref py py-class docutils literal"><span class="pre">spectractor.extractor.dispersers.Grating</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.dispersers.Hologram.N">
<code class="descname">N</code><span class="sig-paren">(</span><em>x</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Hologram.N"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Hologram.N" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of grooves per mm of the grating at position x. If the position is inside
the data provided by the text files, this number is computed from an interpolation. If it lies outside,
it is computed from a 2D polynomial fit.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>x</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – The [x,y] pixel position on the CCD.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><strong>N</strong> – The number of grooves per mm at position x</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">Hologram</span><span class="p">(</span><span class="s1">&#39;HoloPhP&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">N</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">))</span>
<span class="go">345.4794168822986</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">N</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="go">283.56876727310373</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Hologram.load_specs">
<code class="descname">load_specs</code><span class="sig-paren">(</span><em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Hologram.load_specs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Hologram.load_specs" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the files in data_dir/label/ to set the main
characteristics of the hologram. If they do not exist, default values are used.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Set to True to get more verbosity.</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>The files exist:
&gt;&gt;&gt; h = Hologram(label=’HoloPhP’)
&gt;&gt;&gt; h.N((500,500))
345.4794168822986
&gt;&gt;&gt; h.theta((500,500))
-1.3393287109201792
&gt;&gt;&gt; h.holo_center
[856.004, 562.34]</p>
<p>The files do not exist:
&gt;&gt;&gt; h = Hologram(label=’XXX’)
&gt;&gt;&gt; h.N((500,500))
350
&gt;&gt;&gt; h.theta((500,500))
0
&gt;&gt;&gt; h.holo_center
[1024.0, 1024.0]</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.build_hologram">
<code class="descclassname">spectractor.extractor.dispersers.</code><code class="descname">build_hologram</code><span class="sig-paren">(</span><em>order0_position</em>, <em>order1_position</em>, <em>theta_tilt=0</em>, <em>lambda_plot=256000</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#build_hologram"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.build_hologram" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce the interference pattern printed on a hologram, with two sources
located at order0_position and order1_position, with an angle theta_tilt with respect
to the X axis. For plotting reasons, the wavelength can be set very large with
the lambda_plot parameter.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>order0_position</strong> (<a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – List [x0,y0] of the pixel coordinates of the order 0 source position (source A).</li>
<li><strong>order1_position</strong> (<a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – List [x1,y1] of the pixel coordinates of the order 1 source position (source B).</li>
<li><strong>theta_tilt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Angle (in degree) to tilt the interference pattern with respect to X axis (default: 0)</li>
<li><strong>lambda_plot</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Wavelength to produce the interference pattern (default: 256000)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>hologram</strong> – The hologram figure, of shape (CCD_IMSIZE,CCD_IMSIZE)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">2D-array,</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">hologram</span> <span class="o">=</span> <span class="n">build_hologram</span><span class="p">([</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">],[</span><span class="mi">800</span><span class="p">,</span><span class="mi">500</span><span class="p">],</span><span class="n">theta_tilt</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">lambda_plot</span><span class="o">=</span><span class="mi">200000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">hologram</span><span class="p">[:</span><span class="mi">5</span><span class="p">,:</span><span class="mi">5</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))))</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.build_ronchi">
<code class="descclassname">spectractor.extractor.dispersers.</code><code class="descname">build_ronchi</code><span class="sig-paren">(</span><em>x_center</em>, <em>theta_tilt=0</em>, <em>grooves=400</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#build_ronchi"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.build_ronchi" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce the Ronchi pattern (alternance of recatngular stripes of transparancy 0 and 1),
centered at x_center, with an angle theta_tilt with respect
to the X axis. Grooves parameter set the number of grooves per mm.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>x_center</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Center pixel to start the figure with a black stripe.</li>
<li><strong>theta_tilt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Angle (in degree) to tilt the interference pattern with respect to X axis (default: 0)</li>
<li><strong>grooves</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Number of grooves per mm (default: 400)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>hologram</strong> – The hologram figure, of shape (CCD_IMSIZE,CCD_IMSIZE)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">2D-array,</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ronchi</span> <span class="o">=</span> <span class="n">build_ronchi</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">theta_tilt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">grooves</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ronchi</span><span class="p">[:</span><span class="mi">5</span><span class="p">,:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[[0 1 0 0 1]</span>
<span class="go"> [0 1 0 0 1]</span>
<span class="go"> [0 1 0 0 1]</span>
<span class="go"> [0 1 0 0 1]</span>
<span class="go"> [0 1 0 0 1]]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.find_order01_positions">
<code class="descclassname">spectractor.extractor.dispersers.</code><code class="descname">find_order01_positions</code><span class="sig-paren">(</span><em>holo_center</em>, <em>N_interp</em>, <em>theta_interp</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#find_order01_positions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.find_order01_positions" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the order 0 and order 1 positions of an hologram.</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.get_N">
<code class="descclassname">spectractor.extractor.dispersers.</code><code class="descname">get_N</code><span class="sig-paren">(</span><em>deltaX</em>, <em>x0</em>, <em>D=55.45</em>, <em>wavelength=656</em>, <em>order=1</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#get_N"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.get_N" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the grooves per mm number given the spectrum pixel x position with
its wavelength in mm, the distance to the CCD in mm and the order number. It
uses the disperser formula.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>deltaX</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The distance in pixels between the order 0 and a spectrum pixel in the rotated image.</li>
<li><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>[</em><em>x0</em><em>,</em><em>y0</em><em>]</em>) – The order 0 position in the full non-rotated image.</li>
<li><strong>D</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The distance between the CCD and the disperser in mm.</li>
<li><strong>wavelength</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The wavelength at pixel x in nm (default: 656).</li>
<li><strong>order</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – The order of the spectrum (default: 1).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>theta</strong> – The number of grooves per mm.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">delta</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">600</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="n">get_N</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">],</span> <span class="n">D</span><span class="o">=</span><span class="n">D</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<span class="go">355</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.get_delta_pix_ortho">
<code class="descclassname">spectractor.extractor.dispersers.</code><code class="descname">get_delta_pix_ortho</code><span class="sig-paren">(</span><em>deltaX</em>, <em>x0</em>, <em>D=55.45</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#get_delta_pix_ortho"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.get_delta_pix_ortho" title="Permalink to this definition">¶</a></dt>
<dd><p>Subtract from the distance deltaX in pixels between a pixel x the order 0 the distance between
the projected incident point on the disperser and the order 0. In other words, the projection of the incident
angle theta0 from the disperser to the CCD is removed. The distance to the CCD D is in mm.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>deltaX</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The distance in pixels between the order 0 and a spectrum pixel in the rotated image.</li>
<li><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>[</em><em>x0</em><em>,</em><em>y0</em><em>]</em>) – The order 0 position in the full non-rotated image.</li>
<li><strong>D</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The distance between the CCD and the disperser in mm.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>distance</strong> – The projected distance in pixels</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">delta</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">55</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_delta_pix_ortho</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="p">[</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">D</span><span class="o">=</span><span class="n">D</span><span class="p">)</span>
<span class="go">500.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_delta_pix_ortho</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">],</span> <span class="n">D</span><span class="o">=</span><span class="n">D</span><span class="p">)</span>
<span class="go">497.66545567320992</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.get_refraction_angle">
<code class="descclassname">spectractor.extractor.dispersers.</code><code class="descname">get_refraction_angle</code><span class="sig-paren">(</span><em>deltaX</em>, <em>x0</em>, <em>D=55.45</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#get_refraction_angle"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.get_refraction_angle" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the refraction angle with respect to the disperser normal, using geometrical consideration.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>deltaX</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The distance in pixels between the order 0 and a spectrum pixel in the rotated image.</li>
<li><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>[</em><em>x0</em><em>,</em><em>y0</em><em>]</em>) – The order 0 position in the full non-rotated image.</li>
<li><strong>D</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The distance between the CCD and the disperser in mm.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>theta</strong> – The refraction angle in radians.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">delta</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">55</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">get_refraction_angle</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="p">[</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">D</span><span class="o">=</span><span class="n">D</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">delta</span><span class="o">*</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_PIXEL2MM</span><span class="p">,</span> <span class="n">D</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">get_refraction_angle</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">],</span> <span class="n">D</span><span class="o">=</span><span class="n">D</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
<span class="go">0.21</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.get_theta0">
<code class="descclassname">spectractor.extractor.dispersers.</code><code class="descname">get_theta0</code><span class="sig-paren">(</span><em>x0</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#get_theta0"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.get_theta0" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the incident angle on the disperser in radians, with respect to the disperser normal and the X axis.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a>) – The order 0 position in the full non-rotated image.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><strong>theta0</strong> – The incident angle in radians</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_theta0</span><span class="p">((</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_theta0</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="go">0.0</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.neutral_lines">
<code class="descclassname">spectractor.extractor.dispersers.</code><code class="descname">neutral_lines</code><span class="sig-paren">(</span><em>x_center</em>, <em>y_center</em>, <em>theta_tilt</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#neutral_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.neutral_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the nuetrla lines of an hologram.</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.order01_positions">
<code class="descclassname">spectractor.extractor.dispersers.</code><code class="descname">order01_positions</code><span class="sig-paren">(</span><em>holo_center</em>, <em>N</em>, <em>theta_tilt</em>, <em>theta0=0</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#order01_positions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.order01_positions" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the order 0 and order 1 positions of an hologram.</p>
</dd></dl>

</div>
<div class="section" id="module-spectractor.extractor.extractor">
<span id="spectractor-extractor-extractor-module"></span><h2>spectractor.extractor.extractor module<a class="headerlink" href="#module-spectractor.extractor.extractor" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="spectractor.extractor.extractor.Spectractor">
<code class="descclassname">spectractor.extractor.extractor.</code><code class="descname">Spectractor</code><span class="sig-paren">(</span><em>file_name</em>, <em>output_directory</em>, <em>guess</em>, <em>target</em>, <em>disperser_label=''</em>, <em>config='./config/ctio.ini'</em>, <em>atmospheric_lines=True</em>, <em>line_detection=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/extractor.html#Spectractor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.extractor.Spectractor" title="Permalink to this definition">¶</a></dt>
<dd><p>Main function to extract a spectrum from an image</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Input file nam of the image to analyse</li>
<li><strong>output_directory</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Output directory</li>
<li><strong>guess</strong> (<em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a><em>,</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a><em>]</em>) – [x0,y0] list of the guessed pixel positions of the target in the image (must be integers)</li>
<li><strong>target</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The name of the targeted object</li>
<li><strong>disperser_label</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The name of the disperser</li>
<li><strong>config</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The config file name</li>
<li><strong>atmospheric_lines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True atmospheric lines are used in the calibration fit</li>
<li><strong>line_detection</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <dl class="docutils">
<dt>If True the absorption or emission lines are</dt>
<dd>used to calibrate the pixel to wavelength relationship</dd>
</dl>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>spectrum</strong> – The extracted spectrum object</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#spectractor.extractor.spectrum.Spectrum" title="spectractor.extractor.spectrum.Spectrum">Spectrum</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Extract the spectrogram and its characteristics from the image:
&gt;&gt;&gt; import os
&gt;&gt;&gt; from spectractor.logbook import LogBook
&gt;&gt;&gt; logbook = LogBook(logbook=’./ctiofulllogbook_jun2017_v5.csv’)
&gt;&gt;&gt; file_names = [‘./tests/data/reduc_20170605_028.fits’]
&gt;&gt;&gt; for file_name in file_names:
…     tag = file_name.split(‘/’)[-1]
…     disperser_label, target, xpos, ypos = logbook.search_for_image(tag)
…     if target is None or xpos is None or ypos is None:
…         continue
…     spectrum = Spectractor(file_name, ‘./tests/data/’, [xpos, ypos], target, disperser_label, ‘./config/ctio.ini’)
…     assert spectrum is not None
…     assert os.path.isfile(‘tests/data/reduc_20170605_028_spectrum.fits’)</p>
</dd></dl>

</div>
<div class="section" id="module-spectractor.extractor.images">
<span id="spectractor-extractor-images-module"></span><h2>spectractor.extractor.images module<a class="headerlink" href="#module-spectractor.extractor.images" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="spectractor.extractor.images.Image">
<em class="property">class </em><code class="descclassname">spectractor.extractor.images.</code><code class="descname">Image</code><span class="sig-paren">(</span><em>file_name</em>, <em>target=''</em>, <em>disperser_label=''</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.images.Image.compute_parallactic_angle">
<code class="descname">compute_parallactic_angle</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image.compute_parallactic_angle"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image.compute_parallactic_angle" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the parallactic angle.</p>
<p>Script from A. Guyonnet.</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.images.Image.compute_statistical_error">
<code class="descname">compute_statistical_error</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image.compute_statistical_error"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image.compute_statistical_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the image noise map from Image.data as np.sqrt(data) / np.sqrt(gain * expo).</p>
<p>The read out noise is not included</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.images.Image.convert_to_ADU_rate_units">
<code class="descname">convert_to_ADU_rate_units</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image.convert_to_ADU_rate_units"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image.convert_to_ADU_rate_units" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert Image data from ADU to ADU/s units.</p>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">expo</span><span class="p">)</span>
<span class="go">600.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_before</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">convert_to_ADU_rate_units</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">data_before</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">im</span><span class="o">.</span><span class="n">expo</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.images.Image.convert_to_ADU_units">
<code class="descname">convert_to_ADU_units</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image.convert_to_ADU_units"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image.convert_to_ADU_units" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert Image data from ADU/s to ADU units.</p>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">expo</span><span class="p">)</span>
<span class="go">600.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_before</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">convert_to_ADU_rate_units</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_after</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">convert_to_ADU_units</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">data_before</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.images.Image.load_image">
<code class="descname">load_image</code><span class="sig-paren">(</span><em>file_name</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image.load_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image.load_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the image and store some information from header in class attributes.
Then load the target and disperser properties. Called when an Image instance is created.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The fits file name.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.images.Image.plot_image">
<code class="descname">plot_image</code><span class="sig-paren">(</span><em>ax=None, scale='lin', title='', units='Image units', plot_stats=False, target_pixcoords=None, figsize=[9.3, 8], aspect=None, vmin=None, vmax=None, cmap=None, cax=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image.plot_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image.plot_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot image.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ax</strong> (<em>Axes</em><em>, </em><em>optional</em>) – Axes instance (default: None).</li>
<li><strong>scale</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Scaling of the image (choose between: lin, log or log10) (default: lin)</li>
<li><strong>title</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Title of the image (default: “”)</li>
<li><strong>units</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Units of the image to be written in the color bar label (default: “Image units”)</li>
<li><strong>cmap</strong> (<em>colormap</em>) – Color map label (default: None)</li>
<li><strong>target_pixcoords</strong> (<em>array_like</em><em>, </em><em>optional</em>) – 2D array  giving the (x,y) coordinates of the targets on the image: add a scatter plot (default: None)</li>
<li><strong>vmin</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Minimum value of the image (default: None)</li>
<li><strong>vmax</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Maximum value of the image (default: None)</li>
<li><strong>aspect</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Aspect keyword to be passed to imshow (default: None)</li>
<li><strong>cax</strong> (<em>Axes</em><em>, </em><em>optional</em>) – Color bar axes if necessary (default: None).</li>
<li><strong>figsize</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><em>tuple</em></a>) – Figure size (default: [9.3, 8]).</li>
<li><strong>plot_stats</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True, plot the uncertainty map instead of the image (default: False).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">plot_image</span><span class="p">(</span><span class="n">target_pixcoords</span><span class="o">=</span><span class="p">[</span><span class="mi">820</span><span class="p">,</span> <span class="mi">580</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.images.Image.save_image">
<code class="descname">save_image</code><span class="sig-paren">(</span><em>output_file_name</em>, <em>overwrite=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image.save_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image.save_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the image in a fits file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>output_file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The output file name.</li>
<li><strong>overwrite</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True, overwrite the file if it exists previously (default: False).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">save_image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028_copy.fits&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.build_CTIO_gain_map">
<code class="descclassname">spectractor.extractor.images.</code><code class="descname">build_CTIO_gain_map</code><span class="sig-paren">(</span><em>image</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#build_CTIO_gain_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.build_CTIO_gain_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the CTIO gain map according to header GAIN values.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance to fill with file data and header.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.compute_rotation_angle_hessian">
<code class="descclassname">spectractor.extractor.images.</code><code class="descname">compute_rotation_angle_hessian</code><span class="sig-paren">(</span><em>image</em>, <em>deg_threshold=10</em>, <em>width_cut=100</em>, <em>right_edge=1848</em>, <em>margin_cut=12</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#compute_rotation_angle_hessian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.compute_rotation_angle_hessian" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the rotation angle in degree of a spectrogram with the Hessian of the image.
Use the disperser rotation angle map as a prior and the target_pixcoords values to crop the image
around the spectrogram.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance.</li>
<li><strong>deg_threshold</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Don’t consider pixel with Hessian angle above deg_threshold or below -deg_threshold (default: 10).</li>
<li><strong>width_cut</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Half with of the image to consider in height (default: parameters.YWINDOW).</li>
<li><strong>right_edge</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Maximum pixel on the right edge (default: parameters.CCD_IMSIZE - 200).</li>
<li><strong>margin_cut</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – After computing the Hessian, to avoid bad values on the edges the function cut on the
edge of image margin_cut pixels.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>theta</strong> – The median value of the histogram of angles deduced with the Hessian of the pixels (in degree).</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">=</span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">,</span> <span class="n">disperser_label</span><span class="o">=</span><span class="s1">&#39;HoloPhAg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Create a mock spectrogram:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">slope</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">slope</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">N</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">... </span>    <span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-1.py">Source code</a>)</p>
<div class="figure">
<img alt="../_images/spectractor-extractor-1.png" src="../_images/spectractor-extractor-1.png" />
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">target_pixcoords</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">compute_rotation_angle_hessian</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{theta:.2f}</span><span class="s1">, {np.arctan(slope)*180/np.pi:.2f}&#39;</span><span class="p">)</span>
<span class="go">-5.72, -5.71</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.find_target">
<code class="descclassname">spectractor.extractor.images.</code><code class="descname">find_target</code><span class="sig-paren">(</span><em>image</em>, <em>guess</em>, <em>rotated=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#find_target"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.find_target" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the target in the Image instance.</p>
<p>The object is search in a windows of size defined by the XWINDOW and YWINDOW parameters,
using two iterative fits of a PSF2D model.
User must give a guess array in the raw image.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance.</li>
<li><strong>guess</strong> (<em>array_like</em>) – Two parameter array giving the estimated position of the target in the image.</li>
<li><strong>rotated</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True, the target is searched in the rotated image.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>x0</strong> (<em>float</em>) – The x position of the target.</li>
<li><strong>y0</strong> (<em>float</em>) – The y position of the target.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.find_target_1Dprofile">
<code class="descclassname">spectractor.extractor.images.</code><code class="descname">find_target_1Dprofile</code><span class="sig-paren">(</span><em>image</em>, <em>sub_image</em>, <em>guess</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#find_target_1Dprofile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.find_target_1Dprofile" title="Permalink to this definition">¶</a></dt>
<dd><p>Find precisely the position of the targeted object fitting a PSF1D model
on each projection of the image along x and y, using outlier removal.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance.</li>
<li><strong>sub_image</strong> (<em>array_like</em>) – The cropped image data array where the fit is performed.</li>
<li><strong>guess</strong> (<em>array_like</em>) – Two parameter array giving the estimated position of the target in the image.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">820</span><span class="p">,</span> <span class="mi">580</span><span class="p">]</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-2.py">Source code</a>)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sub_image</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">Dx</span><span class="p">,</span> <span class="n">Dy</span><span class="p">,</span> <span class="n">sub_errors</span> <span class="o">=</span> <span class="n">find_target_init</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">guess</span><span class="p">,</span> <span class="n">rotated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">find_target_1Dprofile</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">sub_image</span><span class="p">,</span> <span class="n">guess</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">sub_image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">sub_image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.find_target_2Dprofile">
<code class="descclassname">spectractor.extractor.images.</code><code class="descname">find_target_2Dprofile</code><span class="sig-paren">(</span><em>image</em>, <em>sub_image</em>, <em>guess</em>, <em>sub_errors=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#find_target_2Dprofile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.find_target_2Dprofile" title="Permalink to this definition">¶</a></dt>
<dd><p>Find precisely the position of the targeted object fitting a PSF2D model.
A polynomial 2D background is subtracted first. Saturated pixels are masked with np.nan values.</p>
<p>THE ERROR ARRAY IS NOT USED FOR THE MOMENT.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance.</li>
<li><strong>sub_image</strong> (<em>array_like</em>) – The cropped image data array where the fit is performed.</li>
<li><strong>guess</strong> (<em>array_like</em>) – Two parameter array giving the estimated position of the target in the image.</li>
<li><strong>sub_image</strong> – The cropped image data array where the fit is performed.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">820</span><span class="p">,</span> <span class="mi">580</span><span class="p">]</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-3.py">Source code</a>)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sub_image</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">Dx</span><span class="p">,</span> <span class="n">Dy</span><span class="p">,</span> <span class="n">sub_errors</span> <span class="o">=</span> <span class="n">find_target_init</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">guess</span><span class="p">,</span> <span class="n">rotated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sub_image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sub_image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">find_target_2Dprofile</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">sub_image</span><span class="p">,</span> <span class="n">guess</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.find_target_init">
<code class="descclassname">spectractor.extractor.images.</code><code class="descname">find_target_init</code><span class="sig-paren">(</span><em>image, guess, rotated=False, widths=[100, 100]</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#find_target_init"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.find_target_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the search of the target cropping the image and setting the saturation level.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance.</li>
<li><strong>guess</strong> (<em>array_like</em>) – Two parameter array giving the estimated position of the target in the image.</li>
<li><strong>rotated</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True, the target is searched in the rotated image.</li>
<li><strong>widths</strong> (<em>array_like</em>) – Two parameter array to define the width of the cropped image (default: [parameters.XWINDOW, parameters.YWINDOW])</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>sub_image</strong> (<em>array_like</em>) – The cropped image data array where the fit has to be performed.</li>
<li><strong>x0</strong> (<em>float</em>) – The x position of the target.</li>
<li><strong>y0</strong> (<em>float</em>) – The y position of the target.</li>
<li><strong>Dx</strong> (<em>int</em>) – The width of the cropped image.</li>
<li><strong>Dy</strong> (<em>int</em>) – The height of the cropped image.</li>
<li><strong>sub_errors</strong> (<em>array_like</em>) – The cropped image uncertainty array where the fit has to be performed.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.load_CTIO_image">
<code class="descclassname">spectractor.extractor.images.</code><code class="descname">load_CTIO_image</code><span class="sig-paren">(</span><em>image</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#load_CTIO_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.load_CTIO_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Specific routine to load CTIO fits files and load their data and properties for Spectractor.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance to fill with file data and header.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.load_LPNHE_image">
<code class="descclassname">spectractor.extractor.images.</code><code class="descname">load_LPNHE_image</code><span class="sig-paren">(</span><em>image</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#load_LPNHE_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.load_LPNHE_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Specific routine to load LPNHE fits files and load their data and properties for Spectractor.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance to fill with file data and header.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.turn_image">
<code class="descclassname">spectractor.extractor.images.</code><code class="descname">turn_image</code><span class="sig-paren">(</span><em>image</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#turn_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.turn_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the rotation angle using the Hessian algorithm and turn the image.</p>
<p>The results are stored in Image.data_rotated and Image.stat_errors_rotated.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance.</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Create of False spectrogram</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">=</span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">,</span> <span class="n">disperser_label</span><span class="o">=</span><span class="s1">&#39;HoloPhAg&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">slope</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">slope</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">N</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">... </span>    <span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-4.py">Source code</a>)</p>
<div class="figure">
<img alt="../_images/spectractor-extractor-4.png" src="../_images/spectractor-extractor-4.png" />
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">target_pixcoords</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">turn_image</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-5.py">Source code</a>)</p>
<div class="figure">
<img alt="../_images/spectractor-extractor-5.png" src="../_images/spectractor-extractor-5.png" />
</div>
</dd></dl>

</div>
<div class="section" id="module-spectractor.extractor.psf">
<span id="spectractor-extractor-psf-module"></span><h2>spectractor.extractor.psf module<a class="headerlink" href="#module-spectractor.extractor.psf" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="spectractor.extractor.psf.ChromaticPSF1D">
<em class="property">class </em><code class="descclassname">spectractor.extractor.psf.</code><code class="descname">ChromaticPSF1D</code><span class="sig-paren">(</span><em>Nx</em>, <em>Ny</em>, <em>deg=4</em>, <em>saturation=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.check_bounds">
<code class="descname">check_bounds</code><span class="sig-paren">(</span><em>poly_params</em>, <em>noise_level=0</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.check_bounds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.check_bounds" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate the PSF1D profile parameters from the polynomial coefficients and check if they are within priors.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>poly_params</strong> (<em>array_like</em>) – <dl class="docutils">
<dt>Parameter array of the model, in the form:</dt>
<dd><ul class="first last">
<li>Nx first parameters are amplitudes for the Moffat transverse profiles</li>
<li>next parameters are polynomial coefficients for all the PSF1D parameters</li>
</ul>
</dd>
</dl>
</li>
<li><strong>the same order as in PSF1D definition</strong><strong>, </strong><strong>except amplitude_moffat</strong> (<em>in</em>) – </li>
<li><strong>noise_level</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) – Noise level to set minimal boundary for amplitudes (negatively).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>in_bounds</strong> – Return True if all parameters respect the model parameter priors.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)">bool</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.evaluate">
<code class="descname">evaluate</code><span class="sig-paren">(</span><em>poly_params</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.evaluate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.evaluate" title="Permalink to this definition">¶</a></dt>
<dd><p>Simulate a 2D spectrogram of size Nx times Ny.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>poly_params</strong> (<em>array_like</em>) – <dl class="docutils">
<dt>Parameter array of the model, in the form:</dt>
<dd><ul class="first last">
<li>Nx first parameters are amplitudes for the Moffat transverse profiles</li>
<li>next parameters are polynomial coefficients for all the PSF1D parameters</li>
</ul>
</dd>
</dl>
</li>
<li><strong>the same order as in PSF1D definition</strong><strong>, </strong><strong>except amplitude_moffat</strong> (<em>in</em>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>output</strong> – A 2D array with the model</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)">array</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">poly_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">poly_params</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>  
<span class="go">&lt;matplotlib.colorbar.Colorbar object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.fill_table_with_profile_params">
<code class="descname">fill_table_with_profile_params</code><span class="sig-paren">(</span><em>profile_params</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.fill_table_with_profile_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.fill_table_with_profile_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Fill the table with the profile parameters.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>profile_params</strong> (<a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – a Nx * len(self.PSF1D.param_names) numpy array containing the PSF1D parameters as a function of pixels.</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">poly_params_test</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">profile_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">from_poly_params_to_profile_params</span><span class="p">(</span><span class="n">poly_params_test</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fill_table_with_profile_params</span><span class="p">(</span><span class="n">profile_params</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">100</span><span class="p">))))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.from_poly_params_to_profile_params">
<code class="descname">from_poly_params_to_profile_params</code><span class="sig-paren">(</span><em>poly_params</em>, <em>force_positive=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.from_poly_params_to_profile_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.from_poly_params_to_profile_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate the PSF1D profile parameters from the polynomial coefficients. If poly_params length is smaller
than self.Nx, it is assumed that the amplitude_moffat parameters are not included and set to arbitrarily to 1.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>poly_params</strong> (<em>array_like</em>) – <dl class="docutils">
<dt>Parameter array of the model, in the form:</dt>
<dd><ul class="first last">
<li>Nx first parameters are amplitudes for the Moffat transverse profiles</li>
<li>next parameters are polynomial coefficients for all the PSF1D parameters</li>
</ul>
</dd>
</dl>
</li>
<li><strong>the same order as in PSF1D definition</strong><strong>, </strong><strong>except amplitude_moffat</strong> (<em>in</em>) – </li>
<li><strong>force_positive</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>, </em><em>optional</em>) – Force some profile parameters to be positive despite the polynomial coefficients (default: False)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>profile_params</strong> – Nx * len(self.PSF1D.param_names) numpy array containing the PSF1D parameters as a function of pixels.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)">array</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p># Build a mock spectrogram with random Poisson noise:
&gt;&gt;&gt; s = ChromaticPSF1D(Nx=100, Ny=100, deg=1, saturation=8000)
&gt;&gt;&gt; poly_params_test = s.generate_test_poly_params()
&gt;&gt;&gt; data = s.evaluate(poly_params_test)
&gt;&gt;&gt; data = np.random.poisson(data)
&gt;&gt;&gt; data_errors = np.sqrt(data+1)</p>
<p># From the polynomial parameters to the profile parameters:
&gt;&gt;&gt; profile_params = s.from_poly_params_to_profile_params(poly_params_test)
&gt;&gt;&gt; assert(np.all(np.isclose(profile_params[0], [0, 50, 5, 2, 0, 2, 8e3])))</p>
<p># From the profile parameters to the polynomial parameters:
&gt;&gt;&gt; profile_params = s.from_profile_params_to_poly_params(profile_params)
&gt;&gt;&gt; assert(np.all(np.isclose(profile_params, poly_params_test)))</p>
<p># From the polynomial parameters to the profile parameters without Moffat amplitudes:
&gt;&gt;&gt; profile_params = s.from_poly_params_to_profile_params(poly_params_test[100:])
&gt;&gt;&gt; assert(np.all(np.isclose(profile_params[0], [1, 50, 5, 2, 0, 2, 8e3])))</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.from_profile_params_to_poly_params">
<code class="descname">from_profile_params_to_poly_params</code><span class="sig-paren">(</span><em>profile_params</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.from_profile_params_to_poly_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.from_profile_params_to_poly_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform the profile_params array from fit_transverse_PSF1D into a set of parameters
for the chromatic PSF parameterisation.
Fit polynomial functions across the pixels for each PSF1D
parameters. The order of the function is given by self.degrees.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>profile_params</strong> (<a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – a Nx * len(self.PSF1D.param_names) numpy array containing the PSF1D parameters as a function of pixels.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><strong>profile_params</strong> – A set of parameters that can be evaluated by the chromatic PSF class evaluate function.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">array_like</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p># Build a mock spectrogram with random Poisson noise:
&gt;&gt;&gt; s = ChromaticPSF1D(Nx=100, Ny=100, deg=4, saturation=8000)
&gt;&gt;&gt; poly_params_test = s.generate_test_poly_params()
&gt;&gt;&gt; data = s.evaluate(poly_params_test)
&gt;&gt;&gt; data = np.random.poisson(data)
&gt;&gt;&gt; data_errors = np.sqrt(data+1)</p>
<p># From the polynomial parameters to the profile parameters:
&gt;&gt;&gt; profile_params = s.from_poly_params_to_profile_params(poly_params_test)
&gt;&gt;&gt; assert(np.all(np.isclose(profile_params[0], [0, 50, 5, 2, 0, 2, 8e3])))</p>
<p># From the profile parameters to the polynomial parameters:
&gt;&gt;&gt; profile_params = s.from_profile_params_to_poly_params(profile_params)
&gt;&gt;&gt; assert(np.all(np.isclose(profile_params, poly_params_test)))</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.from_profile_params_to_shape_params">
<code class="descname">from_profile_params_to_shape_params</code><span class="sig-paren">(</span><em>profile_params</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.from_profile_params_to_shape_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.from_profile_params_to_shape_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the PSF1D integrals and FWHMS given the profile_params array and fill the table.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>profile_params</strong> (<a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – a Nx * len(self.PSF1D.param_names) numpy array containing the PSF1D parameters as a function of pixels.</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">poly_params_test</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">profile_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">from_poly_params_to_profile_params</span><span class="p">(</span><span class="n">poly_params_test</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">from_profile_params_to_shape_params</span><span class="p">(</span><span class="n">profile_params</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;fwhm&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mf">12.7851</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.from_table_to_poly_params">
<code class="descname">from_table_to_poly_params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.from_table_to_poly_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.from_table_to_poly_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the polynomial parameters from self.table and fill an array with polynomial parameters.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><strong>poly_params</strong> – A set of polynomial parameters that can be evaluated by the chromatic PSF class evaluate function.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">array_like</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spectractor.extractor.spectrum</span> <span class="k">import</span> <span class="n">Spectrum</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;./tests/data/reduc_20170530_134_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">poly_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">chromatic_psf</span><span class="o">.</span><span class="n">from_table_to_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">poly_params</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">chromatic_psf</span><span class="o">.</span><span class="n">Nx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">poly_params</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">poly_params</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">poly_params</span><span class="p">)))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.from_table_to_profile_params">
<code class="descname">from_table_to_profile_params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.from_table_to_profile_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.from_table_to_profile_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the profile parameters from self.table and fill an array of profile parameters.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><strong>profile_params</strong> – Nx * len(self.PSF1D.param_names) numpy array containing the PSF1D parameters as a function of pixels.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)">array</a></td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spectractor.extractor.spectrum</span> <span class="k">import</span> <span class="n">Spectrum</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;./tests/data/reduc_20170530_134_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">profile_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">chromatic_psf</span><span class="o">.</span><span class="n">from_table_to_profile_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">profile_params</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">chromatic_psf</span><span class="o">.</span><span class="n">Nx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">chromatic_psf</span><span class="o">.</span><span class="n">PSF1D</span><span class="o">.</span><span class="n">param_names</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">profile_params</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">profile_params</span><span class="p">)))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.generate_test_poly_params">
<code class="descname">generate_test_poly_params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.generate_test_poly_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.generate_test_poly_params" title="Permalink to this definition">¶</a></dt>
<dd><p>A set of parameters to define a test spectrogram</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><strong>profile_params</strong> – The list of the test parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)">array</a></td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8000</span><span class="p">])))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.get_distance_along_dispersion_axis">
<code class="descname">get_distance_along_dispersion_axis</code><span class="sig-paren">(</span><em>shift_x=0</em>, <em>shift_y=0</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.get_distance_along_dispersion_axis"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.get_distance_along_dispersion_axis" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.plot_summary">
<code class="descname">plot_summary</code><span class="sig-paren">(</span><em>truth=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.plot_summary"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.plot_summary" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.rotate_table">
<code class="descname">rotate_table</code><span class="sig-paren">(</span><em>angle_degree</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.rotate_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.rotate_table" title="Permalink to this definition">¶</a></dt>
<dd><p>In self.table, rotate the columns Dx, Dy, Dy_fwhm_inf and Dy_fwhm_sup by an angle
given in degree. The results overwrite the previous columns in self.table.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>angle_degree</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Rotation angle in degree</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Dx_rot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">rotate_table</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Dy&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Dx&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Dy_fwhm_inf&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Dy_fwhm_sup&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.set_bounds">
<code class="descname">set_bounds</code><span class="sig-paren">(</span><em>data=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.set_bounds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.set_bounds" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns an array of bounds for iminuit. It is very touchy, change the values with caution !</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> (<em>array_like</em><em>, </em><em>optional</em>) – The data array, to set the bounds for the amplitude using its maximum.
If None is provided, no bounds are provided for the amplitude parameters.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><strong>bounds</strong> – 2D array containing the pair of bounds for each polynomial parameters.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">array_like</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.PSF1D">
<em class="property">class </em><code class="descclassname">spectractor.extractor.psf.</code><code class="descname">PSF1D</code><span class="sig-paren">(</span><em>amplitude_moffat=0.5</em>, <em>x_mean=0</em>, <em>gamma=3</em>, <em>alpha=3</em>, <em>eta_gauss=1</em>, <em>stddev=1</em>, <em>saturation=1</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1D" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">astropy.modeling.core.Fittable1DModel</span></code></p>
<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1D.alpha">
<code class="descname">alpha</code><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.alpha" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1D.amplitude_moffat">
<code class="descname">amplitude_moffat</code><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.amplitude_moffat" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="spectractor.extractor.psf.PSF1D.deriv">
<em class="property">static </em><code class="descname">deriv</code><span class="sig-paren">(</span><em>x</em>, <em>amplitude_moffat</em>, <em>x_mean</em>, <em>gamma</em>, <em>alpha</em>, <em>eta_gauss</em>, <em>stddev</em>, <em>saturation</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1D.deriv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.deriv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1D.eta_gauss">
<code class="descname">eta_gauss</code><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.eta_gauss" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="spectractor.extractor.psf.PSF1D.evaluate">
<em class="property">static </em><code class="descname">evaluate</code><span class="sig-paren">(</span><em>x</em>, <em>amplitude_moffat</em>, <em>x_mean</em>, <em>gamma</em>, <em>alpha</em>, <em>eta_gauss</em>, <em>stddev</em>, <em>saturation</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1D.evaluate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.evaluate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="spectractor.extractor.psf.PSF1D.fit_deriv">
<em class="property">static </em><code class="descname">fit_deriv</code><span class="sig-paren">(</span><em>x</em>, <em>amplitude_moffat</em>, <em>x_mean</em>, <em>gamma</em>, <em>alpha</em>, <em>eta_gauss</em>, <em>stddev</em>, <em>saturation</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1D.fit_deriv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.fit_deriv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF1D.fwhm">
<code class="descname">fwhm</code><span class="sig-paren">(</span><em>x_array=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1D.fwhm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.fwhm" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the full width half maximum of the PSF1D model with a dichotomie method.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>x_array</strong> (<em>array_like</em><em>, </em><em>optional</em>) – An abscisse array is one wants to find FWHM on the interpolated PSF1D model
(to smooth the spikes from spurious parameter sets).</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><strong>FWHM</strong> – The full width half maximum of the PSF1D model.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PSF</span> <span class="o">=</span> <span class="n">PSF1D</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span>  <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">PSF</span><span class="o">.</span><span class="n">fwhm</span><span class="p">(</span><span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">fwhm</span><span class="p">,</span> <span class="mf">7.25390625</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">PSF</span><span class="o">.</span><span class="n">fwhm</span><span class="p">(</span><span class="n">x_array</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">fwhm</span><span class="p">,</span> <span class="mf">7.083984375</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fwhm</span><span class="p">)</span>
<span class="go">7.083984375</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">PSF</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">))</span> 
<span class="go">[&lt;matplotlib.lines.Line2D object at 0x...&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1D.gamma">
<code class="descname">gamma</code><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.gamma" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1D.inputs">
<code class="descname">inputs</code><em class="property"> = ('x',)</em><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.inputs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF1D.integrate">
<code class="descname">integrate</code><span class="sig-paren">(</span><em>bounds=(-inf</em>, <em>inf)</em>, <em>x_array=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1D.integrate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.integrate" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the integral of the PSF1D model. Bounds are -np.inf, np.inf by default, or provided
if no x_array is provided. Otherwise the bounds comes from x_array edges.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>x_array</strong> (<em>array_like</em><em>, </em><em>optional</em>) – If not None, the interpoalted PSF1D modelis used for integration (default: None).</li>
<li><strong>bounds</strong> (<em>array_like</em><em>, </em><em>optional</em>) – The bounds of the integral (default bounds=(-np.inf, np.inf)).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>result</strong> – The integral of the PSF1D model.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PSF</span> <span class="o">=</span> <span class="n">PSF1D</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">PSF</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mf">10.059742339728174</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">PSF</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span> <span class="n">x_array</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mf">10.046698028728645</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">PSF</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">))</span> 
<span class="go">[&lt;matplotlib.lines.Line2D object at 0x...&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">PSF</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">))</span> 
<span class="go">[&lt;matplotlib.lines.Line2D object at 0x...&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF1D.interpolation">
<code class="descname">interpolation</code><span class="sig-paren">(</span><em>x_array</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1D.interpolation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.interpolation" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>x_array</strong> (<em>array_like</em>) – The abscisse array to interpolate the model.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><strong>interp</strong> – Function corresponding to the interpolated model on the x_array array.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.7)">callable</a></td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PSF</span> <span class="o">=</span> <span class="n">PSF1D</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">interp</span> <span class="o">=</span> <span class="n">PSF</span><span class="o">.</span><span class="n">interpolation</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">interp</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">PSF</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1D.outputs">
<code class="descname">outputs</code><em class="property"> = ('y',)</em><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.outputs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1D.param_names">
<code class="descname">param_names</code><em class="property"> = ('amplitude_moffat', 'x_mean', 'gamma', 'alpha', 'eta_gauss', 'stddev', 'saturation')</em><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.param_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1D.saturation">
<code class="descname">saturation</code><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.saturation" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1D.stddev">
<code class="descname">stddev</code><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.stddev" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1D.x_mean">
<code class="descname">x_mean</code><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.x_mean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.PSF1D_chisq">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">PSF1D_chisq</code><span class="sig-paren">(</span><em>params</em>, <em>model</em>, <em>xx</em>, <em>yy</em>, <em>yy_err=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1D_chisq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1D_chisq" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.PSF1D_chisq_jac">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">PSF1D_chisq_jac</code><span class="sig-paren">(</span><em>params</em>, <em>model</em>, <em>xx</em>, <em>yy</em>, <em>yy_err=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1D_chisq_jac"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1D_chisq_jac" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.PSF2D">
<em class="property">class </em><code class="descclassname">spectractor.extractor.psf.</code><code class="descname">PSF2D</code><span class="sig-paren">(</span><em>amplitude=1</em>, <em>x_mean=0</em>, <em>y_mean=0</em>, <em>gamma=3</em>, <em>alpha=3</em>, <em>eta_gauss=0.5</em>, <em>stddev=1</em>, <em>saturation=1</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2D" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">astropy.modeling.core.Fittable2DModel</span></code></p>
<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2D.alpha">
<code class="descname">alpha</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2D.alpha" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2D.amplitude">
<code class="descname">amplitude</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2D.amplitude" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2D.eta_gauss">
<code class="descname">eta_gauss</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2D.eta_gauss" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="spectractor.extractor.psf.PSF2D.evaluate">
<em class="property">static </em><code class="descname">evaluate</code><span class="sig-paren">(</span><em>x</em>, <em>y</em>, <em>amplitude</em>, <em>x_mean</em>, <em>y_mean</em>, <em>gamma</em>, <em>alpha</em>, <em>eta_gauss</em>, <em>stddev</em>, <em>saturation</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2D.evaluate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2D.evaluate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="spectractor.extractor.psf.PSF2D.fit_deriv">
<em class="property">static </em><code class="descname">fit_deriv</code><span class="sig-paren">(</span><em>x</em>, <em>y</em>, <em>amplitude</em>, <em>x_mean</em>, <em>y_mean</em>, <em>gamma</em>, <em>alpha</em>, <em>eta_gauss</em>, <em>stddev</em>, <em>saturation</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2D.fit_deriv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2D.fit_deriv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2D.gamma">
<code class="descname">gamma</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2D.gamma" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2D.inputs">
<code class="descname">inputs</code><em class="property"> = ('x', 'y')</em><a class="headerlink" href="#spectractor.extractor.psf.PSF2D.inputs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2D.outputs">
<code class="descname">outputs</code><em class="property"> = ('z',)</em><a class="headerlink" href="#spectractor.extractor.psf.PSF2D.outputs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2D.param_names">
<code class="descname">param_names</code><em class="property"> = ('amplitude', 'x_mean', 'y_mean', 'gamma', 'alpha', 'eta_gauss', 'stddev', 'saturation')</em><a class="headerlink" href="#spectractor.extractor.psf.PSF2D.param_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2D.saturation">
<code class="descname">saturation</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2D.saturation" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2D.stddev">
<code class="descname">stddev</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2D.stddev" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2D.x_mean">
<code class="descname">x_mean</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2D.x_mean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2D.y_mean">
<code class="descname">y_mean</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2D.y_mean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.PSF2D_chisq">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">PSF2D_chisq</code><span class="sig-paren">(</span><em>params</em>, <em>model</em>, <em>xx</em>, <em>yy</em>, <em>zz</em>, <em>zz_err=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2D_chisq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2D_chisq" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.PSF2D_chisq_jac">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">PSF2D_chisq_jac</code><span class="sig-paren">(</span><em>params</em>, <em>model</em>, <em>xx</em>, <em>yy</em>, <em>zz</em>, <em>zz_err=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2D_chisq_jac"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2D_chisq_jac" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.extract_background">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">extract_background</code><span class="sig-paren">(</span><em>data</em>, <em>err</em>, <em>deg=1</em>, <em>ws=(20</em>, <em>30)</em>, <em>pixel_step=1</em>, <em>sigma=5</em>, <em>live_fit=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#extract_background"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.extract_background" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit a polynomial background slice per slice along the x axis,
with outlier removal, on lateral bands defined by the ws parameter.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>data</strong> (<a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – The 2D array image. The transverse profile is fitted on the y direction for all pixels along the x direction.</li>
<li><strong>err</strong> (<a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – The uncertainties related to the data array.</li>
<li><strong>deg</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Degree of the polynomial model for the background (default: 1).</li>
<li><strong>ws</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a>) – up/down region extension where the sky background is estimated with format [int, int] (default: [20,30])</li>
<li><strong>pixel_step</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a><em>, </em><em>optional</em>) – The step in pixels between the slices to be fitted (default: 1).
The values for the skipped pixels are interpolated with splines from the fitted parameters.</li>
<li><strong>live_fit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>, </em><em>optional</em>) – If True, the transverse profile fit is plotted in live across the loop (default: False).</li>
<li><strong>sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Sigma for outlier rejection (default: 5).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>bgd_model_func</strong> – A 2D function to model the extracted background</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.7)">callable</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p># Build a mock spectrogram with random Poisson noise:
&gt;&gt;&gt; s0 = ChromaticPSF1D(Nx=100, Ny=100, saturation=1000)
&gt;&gt;&gt; params = s0.generate_test_poly_params()
&gt;&gt;&gt; saturation = params[-1]
&gt;&gt;&gt; data = s0.evaluate(params)
&gt;&gt;&gt; bgd = 10*np.ones_like(data)
&gt;&gt;&gt; data += bgd
&gt;&gt;&gt; data = np.random.poisson(data)
&gt;&gt;&gt; data_errors = np.sqrt(data+1)</p>
<p># Fit the transverse profile:
&gt;&gt;&gt; bgd_model = extract_background(data, data_errors, deg=1, ws=[30,50], live_fit=True, sigma=5, pixel_step=50)</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.fit_PSF1D">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">fit_PSF1D</code><span class="sig-paren">(</span><em>x</em>, <em>data</em>, <em>guess=None</em>, <em>bounds=None</em>, <em>data_errors=None</em>, <em>method='minimize'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#fit_PSF1D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.fit_PSF1D" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Fit a PSF 1D model with parameters :</dt>
<dd>amplitude_gauss, x_mean, stddev, amplitude_moffat, alpha, gamma, saturation</dd>
</dl>
<p>using basin hopping global minimization method.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>x</strong> (<em>np.array</em>) – 1D array of the x coordinates.</li>
<li><strong>data</strong> (<em>np.array</em>) – the 1D array profile.</li>
<li><strong>guess</strong> (<em>array_like</em><em>, </em><em>optional</em>) – list containing a first guess for the PSF parameters (default: None).</li>
<li><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – 2D list containing bounds for the PSF parameters with format ((min,…), (max…)) (default: None)</li>
<li><strong>data_errors</strong> (<em>np.array</em>) – the 1D array uncertainties.</li>
<li><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em>, </em><em>optional</em>) – method to use for the minimisation: choose between minimize and basinhopping.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>fitted_model</strong> – the PSF1D fitted model.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#spectractor.extractor.psf.PSF1D" title="spectractor.extractor.psf.PSF1D">PSF1D</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Create the model:
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; X = np.arange(0, 50)
&gt;&gt;&gt; PSF = PSF1D()
&gt;&gt;&gt; p = (50, 25, 5, 1, -0.2, 1, 60)
&gt;&gt;&gt; Y = PSF.evaluate(X, <a href="#id1"><span class="problematic" id="id2">*</span></a>p)
&gt;&gt;&gt; Y_err = np.sqrt(Y)/10.</p>
<p>Prepare the fit:
&gt;&gt;&gt; guess = (60, 20, 3.2, 1.2, -0.1, 2,  60)
&gt;&gt;&gt; bounds = ((0, 200), (10, 40), (0.5, 10), (0.5, 5), (-10, 200), (0.01, 10), (0, 400))</p>
<p>Fit with error bars:
&gt;&gt;&gt; model = fit_PSF1D(X, Y, guess=guess, bounds=bounds, data_errors=Y_err)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
&gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-3))</p>
<p>Fit without error bars:
&gt;&gt;&gt; model = fit_PSF1D(X, Y, guess=guess, bounds=bounds, data_errors=None)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
&gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-3))</p>
<p>Fit with error bars and basin hopping method:
&gt;&gt;&gt; model = fit_PSF1D(X, Y, guess=guess, bounds=bounds, data_errors=Y_err, method=’basinhopping’)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
&gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-3))</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.fit_PSF1D_minuit">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">fit_PSF1D_minuit</code><span class="sig-paren">(</span><em>x</em>, <em>data</em>, <em>guess=None</em>, <em>bounds=None</em>, <em>data_errors=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#fit_PSF1D_minuit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.fit_PSF1D_minuit" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Fit a PSF 1D model with parameters:</dt>
<dd>amplitude_gauss, x_mean, stddev, amplitude_moffat, alpha, gamma, saturation</dd>
</dl>
<p>using Minuit.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>x</strong> (<em>np.array</em>) – 1D array of the x coordinates.</li>
<li><strong>data</strong> (<em>np.array</em>) – the 1D array profile.</li>
<li><strong>guess</strong> (<em>array_like</em><em>, </em><em>optional</em>) – list containing a first guess for the PSF parameters (default: None).</li>
<li><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – 2D list containing bounds for the PSF parameters with format ((min,…), (max…)) (default: None)</li>
<li><strong>data_errors</strong> (<em>np.array</em>) – the 1D array uncertainties.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>fitted_model</strong> – the PSF1D fitted model.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#spectractor.extractor.psf.PSF1D" title="spectractor.extractor.psf.PSF1D">PSF1D</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Create the model:
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; X = np.arange(0, 50)
&gt;&gt;&gt; PSF = PSF1D()
&gt;&gt;&gt; p = (50, 25, 5, 1, -0.2, 1, 60)
&gt;&gt;&gt; Y = PSF.evaluate(X, <a href="#id3"><span class="problematic" id="id4">*</span></a>p)
&gt;&gt;&gt; Y_err = np.sqrt(1+Y)</p>
<p>Prepare the fit:
&gt;&gt;&gt; guess = (60, 20, 3.2, 1.2, -0.1, 2,  60)
&gt;&gt;&gt; bounds = ((0, 200), (10, 40), (0.5, 10), (0.5, 5), (-1, 0), (0.01, 10), (0, 400))</p>
<p>Fit with error bars:
&gt;&gt;&gt; model = fit_PSF1D_minuit(X, Y, guess=guess, bounds=bounds, data_errors=Y_err)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
&gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-2))</p>
<p>Fit without error bars:
&gt;&gt;&gt; model = fit_PSF1D_minuit(X, Y, guess=guess, bounds=bounds, data_errors=None)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
&gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-2))</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.fit_PSF1D_minuit_outlier_removal">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">fit_PSF1D_minuit_outlier_removal</code><span class="sig-paren">(</span><em>x</em>, <em>data</em>, <em>data_errors</em>, <em>guess=None</em>, <em>bounds=None</em>, <em>sigma=3</em>, <em>niter=2</em>, <em>consecutive=3</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#fit_PSF1D_minuit_outlier_removal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.fit_PSF1D_minuit_outlier_removal" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Fit a PSF 1D model with parameters:</dt>
<dd>amplitude_gauss, x_mean, stddev, amplitude_moffat, alpha, gamma, saturation</dd>
</dl>
<p>using Minuit. Find outliers data point above sigma*data_errors from the fit over niter iterations.
Only at least 3 consecutive outliers are considered.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>x</strong> (<em>np.array</em>) – 1D array of the x coordinates.</li>
<li><strong>data</strong> (<em>np.array</em>) – the 1D array profile.</li>
<li><strong>data_errors</strong> (<em>np.array</em>) – the 1D array uncertainties.</li>
<li><strong>guess</strong> (<em>array_like</em><em>, </em><em>optional</em>) – list containing a first guess for the PSF parameters (default: None).</li>
<li><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – 2D list containing bounds for the PSF parameters with format ((min,…), (max…)) (default: None)</li>
<li><strong>sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – the sigma limit to exclude data points (default: 3).</li>
<li><strong>niter</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – the number of loop iterations to exclude  outliers and refit the model (default: 2).</li>
<li><strong>consecutive</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – the number of outliers that have to be consecutive to be considered (default: 3).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>fitted_model</strong> (<em>PSF1D</em>) – the PSF1D fitted model.</li>
<li><strong>outliers</strong> (<em>list</em>) – the list of the outlier indices.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Create the model:
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; X = np.arange(0, 50)
&gt;&gt;&gt; PSF = PSF1D()
&gt;&gt;&gt; p = (1000, 25, 5, 1, -0.2, 1, 6000)
&gt;&gt;&gt; Y = PSF.evaluate(X, <a href="#id5"><span class="problematic" id="id6">*</span></a>p)
&gt;&gt;&gt; Y += 100*np.exp(-((X-10)/2)**2)
&gt;&gt;&gt; Y_err = np.sqrt(1+Y)</p>
<p>Prepare the fit:
&gt;&gt;&gt; guess = (600, 20, 3.2, 1.2, -0.1, 2,  6000)
&gt;&gt;&gt; bounds = ((0, 6000), (10, 40), (0.5, 10), (0.5, 5), (-1, 0), (0.01, 10), (0, 8000))</p>
<p>Fit with error bars:
&gt;&gt;&gt; model, outliers = fit_PSF1D_minuit_outlier_removal(X, Y, guess=guess, bounds=bounds, data_errors=Y_err,
… sigma=3, niter=2, consecutive=3)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
&gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-1))</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.fit_PSF1D_outlier_removal">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">fit_PSF1D_outlier_removal</code><span class="sig-paren">(</span><em>x</em>, <em>data</em>, <em>data_errors=None</em>, <em>sigma=3.0</em>, <em>niter=3</em>, <em>guess=None</em>, <em>bounds=None</em>, <em>method='minimize'</em>, <em>niter_basinhopping=5</em>, <em>T_basinhopping=0.2</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#fit_PSF1D_outlier_removal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.fit_PSF1D_outlier_removal" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Fit a PSF 1D model with parameters:</dt>
<dd>amplitude_gauss, x_mean, stddev, amplitude_moffat, alpha, gamma, saturation</dd>
</dl>
<p>using scipy. Find outliers data point above sigma*data_errors from the fit over niter iterations.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>x</strong> (<em>np.array</em>) – 1D array of the x coordinates.</li>
<li><strong>data</strong> (<em>np.array</em>) – the 1D array profile.</li>
<li><strong>data_errors</strong> (<em>np.array</em>) – the 1D array uncertainties.</li>
<li><strong>guess</strong> (<em>array_like</em><em>, </em><em>optional</em>) – list containing a first guess for the PSF parameters (default: None).</li>
<li><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – 2D list containing bounds for the PSF parameters with format ((min,…), (max…)) (default: None)</li>
<li><strong>sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – the sigma limit to exclude data points (default: 3).</li>
<li><strong>niter</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – the number of loop iterations to exclude  outliers and refit the model (default: 2).</li>
<li><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Can be ‘minimize’ or ‘basinhopping’ (default: ‘minimize’).</li>
<li><strong>niter_basinhopping</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a><em>, </em><em>optional</em>) – The number of basin hops (default: 5)</li>
<li><strong>T_basinhopping</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) – The temperature for the basin hops (default: 0.2)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>fitted_model</strong> (<em>PSF1D</em>) – the PSF1D fitted model.</li>
<li><strong>outliers</strong> (<em>list</em>) – the list of the outlier indices.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Create the model:
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; X = np.arange(0, 50)
&gt;&gt;&gt; PSF = PSF1D()
&gt;&gt;&gt; p = (1000, 25, 5, 1, -0.2, 1, 6000)
&gt;&gt;&gt; Y = PSF.evaluate(X, <a href="#id7"><span class="problematic" id="id8">*</span></a>p)
&gt;&gt;&gt; Y += 100*np.exp(-((X-10)/2)**2)
&gt;&gt;&gt; Y_err = np.sqrt(1+Y)</p>
<p>Prepare the fit:
&gt;&gt;&gt; guess = (600, 27, 3.2, 1.2, -0.1, 2,  6000)
&gt;&gt;&gt; bounds = ((0, 6000), (10, 40), (0.5, 10), (0.5, 5), (-1, 0), (0.01, 10), (0, 8000))</p>
<p>Fit without bars:
&gt;&gt;&gt; model, outliers = fit_PSF1D_outlier_removal(X, Y, guess=guess, bounds=bounds,
… sigma=3, niter=5, method=”minimize”)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
&gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-1))</p>
<p>Fit with error bars:
&gt;&gt;&gt; model, outliers = fit_PSF1D_outlier_removal(X, Y, guess=guess, bounds=bounds, data_errors=Y_err,
… sigma=3, niter=2, method=”minimize”)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
&gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-1))</p>
<p>Fit with error bars and basinhopping:
&gt;&gt;&gt; model, outliers = fit_PSF1D_outlier_removal(X, Y, guess=guess, bounds=bounds, data_errors=Y_err,
… sigma=3, niter=5, method=”basinhopping”, niter_basinhopping=20)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
&gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-1))</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.fit_PSF2D">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">fit_PSF2D</code><span class="sig-paren">(</span><em>x</em>, <em>y</em>, <em>data</em>, <em>guess=None</em>, <em>bounds=None</em>, <em>data_errors=None</em>, <em>method='minimize'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#fit_PSF2D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.fit_PSF2D" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Fit a PSF 2D model with parameters :</dt>
<dd>amplitude, x_mean, y_mean, stddev, eta, alpha, gamma, saturation</dd>
</dl>
<p>using basin hopping global minimization method.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>x</strong> (<em>np.array</em>) – 2D array of the x coordinates from meshgrid.</li>
<li><strong>y</strong> (<em>np.array</em>) – 2D array of the y coordinates from meshgrid.</li>
<li><strong>data</strong> (<em>np.array</em>) – the 2D array image.</li>
<li><strong>guess</strong> (<em>array_like</em><em>, </em><em>optional</em>) – List containing a first guess for the PSF parameters (default: None).</li>
<li><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – 2D list containing bounds for the PSF parameters with format ((min,…), (max…)) (default: None)</li>
<li><strong>data_errors</strong> (<em>np.array</em>) – the 2D array uncertainties.</li>
<li><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em>, </em><em>optional</em>) – the minimisation method: ‘minimize’ or ‘basinhopping’ (default: ‘minimize’).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>fitted_model</strong> – the PSF2D fitted model.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#spectractor.extractor.psf.PSF2D" title="spectractor.extractor.psf.PSF2D">PSF2D</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Create the model:
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; X, Y = np.mgrid[:50,:50]
&gt;&gt;&gt; PSF = PSF2D()
&gt;&gt;&gt; p = (50, 25, 25, 5, 1, -0.4, 1, 60)
&gt;&gt;&gt; Z = PSF.evaluate(X, Y, <a href="#id9"><span class="problematic" id="id10">*</span></a>p)
&gt;&gt;&gt; Z_err = np.sqrt(Z)/10.</p>
<p>Prepare the fit:
&gt;&gt;&gt; guess = (52, 22, 22, 3.2, 1.2, -0.1, 2, 60)
&gt;&gt;&gt; bounds = ((1, 200), (10, 40), (10, 40), (0.5, 10), (0.5, 5), (-100, 200), (0.01, 10), (0, 400))</p>
<p>Fit with error bars:
&gt;&gt;&gt; model = fit_PSF2D(X, Y, Z, guess=guess, bounds=bounds, data_errors=Z_err)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
&gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-3))</p>
<p>Fit without error bars:
&gt;&gt;&gt; model = fit_PSF2D(X, Y, Z, guess=guess, bounds=bounds, data_errors=None)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
&gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-3))</p>
<p>Fit with error bars and basin hopping method:
&gt;&gt;&gt; model = fit_PSF2D(X, Y, Z, guess=guess, bounds=bounds, data_errors=Z_err, method=’basinhopping’)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
&gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-3))</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.fit_PSF2D_minuit">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">fit_PSF2D_minuit</code><span class="sig-paren">(</span><em>x</em>, <em>y</em>, <em>data</em>, <em>guess=None</em>, <em>bounds=None</em>, <em>data_errors=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#fit_PSF2D_minuit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.fit_PSF2D_minuit" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Fit a PSF 2D model with parameters :</dt>
<dd>amplitude, x_mean, y_mean, stddev, eta, alpha, gamma, saturation</dd>
</dl>
<p>using basin hopping global minimization method.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>x</strong> (<em>np.array</em>) – 2D array of the x coordinates from meshgrid.</li>
<li><strong>y</strong> (<em>np.array</em>) – 2D array of the y coordinates from meshgrid.</li>
<li><strong>data</strong> (<em>np.array</em>) – the 2D array image.</li>
<li><strong>guess</strong> (<em>array_like</em><em>, </em><em>optional</em>) – List containing a first guess for the PSF parameters (default: None).</li>
<li><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – 2D list containing bounds for the PSF parameters with format ((min,…), (max…)) (default: None)</li>
<li><strong>data_errors</strong> (<em>np.array</em>) – the 2D array uncertainties.</li>
<li><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em>, </em><em>optional</em>) – the minimisation method: ‘minimize’ or ‘basinhopping’ (default: ‘minimize’).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>fitted_model</strong> – the PSF2D fitted model.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#spectractor.extractor.psf.PSF2D" title="spectractor.extractor.psf.PSF2D">PSF2D</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Create the model:
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; X, Y = np.mgrid[:50,:50]
&gt;&gt;&gt; PSF = PSF2D()
&gt;&gt;&gt; p = (50, 25, 25, 5, 1, -0.4, 1, 60)
&gt;&gt;&gt; Z = PSF.evaluate(X, Y, <a href="#id11"><span class="problematic" id="id12">*</span></a>p)
&gt;&gt;&gt; Z_err = np.sqrt(Z)/10.</p>
<p>Prepare the fit:
&gt;&gt;&gt; guess = (52, 22, 22, 3.2, 1.2, -0.1, 2, 60)
&gt;&gt;&gt; bounds = ((1, 200), (10, 40), (10, 40), (0.5, 10), (0.5, 5), (-100, 200), (0.01, 10), (0, 400))</p>
<p>Fit with error bars:
&gt;&gt;&gt; model = fit_PSF2D_minuit(X, Y, Z, guess=guess, bounds=bounds, data_errors=Z_err)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
&gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-3))</p>
<p>Fit without error bars:
&gt;&gt;&gt; model = fit_PSF2D_minuit(X, Y, Z, guess=guess, bounds=bounds, data_errors=None)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
&gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-3))</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.fit_chromatic_PSF1D">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">fit_chromatic_PSF1D</code><span class="sig-paren">(</span><em>data</em>, <em>chromatic_psf</em>, <em>bgd_model_func=None</em>, <em>data_errors=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#fit_chromatic_PSF1D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.fit_chromatic_PSF1D" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit a chromatic PSF1D model on 2D data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>data</strong> (<em>array_like</em>) – 2D array containing the image data.</li>
<li><strong>chromatic_psf</strong> (<a class="reference internal" href="#spectractor.extractor.psf.ChromaticPSF1D" title="spectractor.extractor.psf.ChromaticPSF1D"><em>ChromaticPSF1D</em></a>) – First guess for the chromatic PSF, filled with a first guess of the polynomial shape parameters, mandatory.</li>
<li><strong>bgd_model_func</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.7)"><em>callable</em></a><em>, </em><em>optional</em>) – A 2D function to model the extracted background (default: None -&gt; null background)</li>
<li><strong>data_errors</strong> (<em>np.array</em>) – the 2D array uncertainties.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>s</strong> – The chromatic PSF containing all the information on the wavelength dependences of the parameters adn the flux_sum.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#spectractor.extractor.psf.ChromaticPSF1D" title="spectractor.extractor.psf.ChromaticPSF1D">ChromaticPSF1D</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p># Build a mock spectrogram with random Poisson noise:
&gt;&gt;&gt; s0 = ChromaticPSF1D(Nx=100, Ny=100, deg=4, saturation=1000)
&gt;&gt;&gt; params = s0.generate_test_poly_params()
&gt;&gt;&gt; s0.poly_params = params
&gt;&gt;&gt; saturation = params[-1]
&gt;&gt;&gt; data = s0.evaluate(params)
&gt;&gt;&gt; bgd = 10*np.ones_like(data)
&gt;&gt;&gt; data += bgd
&gt;&gt;&gt; data = np.random.poisson(data)
&gt;&gt;&gt; data_errors = np.sqrt(data+1)</p>
<p># Estimate the first guess values
&gt;&gt;&gt; s, bgd_model_func = fit_transverse_PSF1D_profile(data, data_errors, w=20, ws=[30,50],
… pixel_step=1, saturation=saturation, live_fit=False, deg=4)
&gt;&gt;&gt; s.plot_summary(truth=s0)</p>
<p># Fit the data:
&gt;&gt;&gt; s = fit_chromatic_PSF1D(data, s, bgd_model_func=bgd_model_func, data_errors=data_errors)
&gt;&gt;&gt; s.plot_summary(truth=s0)</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.fit_transverse_PSF1D_profile">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">fit_transverse_PSF1D_profile</code><span class="sig-paren">(</span><em>data</em>, <em>err</em>, <em>w</em>, <em>ws</em>, <em>pixel_step=1</em>, <em>saturation=None</em>, <em>live_fit=False</em>, <em>sigma=5</em>, <em>deg=4</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#fit_transverse_PSF1D_profile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.fit_transverse_PSF1D_profile" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the transverse profile of a 2D data image with a PSF1D profile.
Loop is done on the x-axis direction.
An order 1 polynomial function is fitted to subtract the background for each pixel
with a 3*sigma outlier removal procedure to remove background stars.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>data</strong> (<a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – The 2D array image. The transverse profile is fitted on the y direction
for all pixels along the x direction.</li>
<li><strong>err</strong> (<a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – The uncertainties related to the data array.</li>
<li><strong>w</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Half width of central region where the spectrum is extracted and summed (default: 10)</li>
<li><strong>ws</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a>) – up/down region extension where the sky background is estimated with format [int, int] (default: [20,30])</li>
<li><strong>pixel_step</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a><em>, </em><em>optional</em>) – The step in pixels between the slices to be fitted (default: 1).
The values for the skipped pixels are interpolated with splines from the fitted parameters.</li>
<li><strong>saturation</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) – The saturation level of the image. Default is set to twice the maximum of the data array and has no effect.</li>
<li><strong>live_fit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>, </em><em>optional</em>) – If True, the transverse profile fit is plotted in live accross the loop (default: False).</li>
<li><strong>sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Sigma for outlier rejection (default: 5).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>s</strong> – The chromatic PSF containing all the information on the wavelength dependeces of the parameters adn the flux_sum.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#spectractor.extractor.psf.ChromaticPSF1D" title="spectractor.extractor.psf.ChromaticPSF1D">ChromaticPSF1D</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p># Build a mock spectrogram with random Poisson noise:
&gt;&gt;&gt; s0 = ChromaticPSF1D(Nx=100, Ny=100, saturation=1000)
&gt;&gt;&gt; params = s0.generate_test_poly_params()
&gt;&gt;&gt; saturation = params[-1]
&gt;&gt;&gt; data = s0.evaluate(params)
&gt;&gt;&gt; bgd = 10*np.ones_like(data)
&gt;&gt;&gt; data += bgd
&gt;&gt;&gt; data = np.random.poisson(data)
&gt;&gt;&gt; data_errors = np.sqrt(data+1)</p>
<p># Fit the transverse profile:
&gt;&gt;&gt; s, bgd_model = fit_transverse_PSF1D_profile(data, data_errors, w=20, ws=[30,50], pixel_step=10,
… saturation=saturation, live_fit=False, sigma=5)
&gt;&gt;&gt; assert(np.all(np.isclose(s.pixels[:5], np.arange(s.Nx)[:5], rtol=1e-3)))
&gt;&gt;&gt; assert(not np.any(np.isclose(s.table[‘flux_sum’][3:6], np.zeros(s.Nx)[3:6], rtol=1e-3)))
&gt;&gt;&gt; assert(np.all(np.isclose(s.table[‘Dy’][-10:-1], np.zeros(s.Nx)[-10:-1], rtol=1e-2)))
&gt;&gt;&gt; s.plot_summary(truth=s0)</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.plot_chromatic_PSF1D_residuals">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">plot_chromatic_PSF1D_residuals</code><span class="sig-paren">(</span><em>s</em>, <em>bgd</em>, <em>data</em>, <em>data_errors</em>, <em>guess=None</em>, <em>live_fit=False</em>, <em>title=''</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#plot_chromatic_PSF1D_residuals"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.plot_chromatic_PSF1D_residuals" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the residuals after fit_chromatic_PSF1D function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>s</strong> (<a class="reference internal" href="#spectractor.extractor.psf.ChromaticPSF1D" title="spectractor.extractor.psf.ChromaticPSF1D"><em>ChromaticPSF1D</em></a>) – The chromatic PSF1D function that has been fitted to data.</li>
<li><strong>bgd</strong> (<em>array_like</em>) – The 2D background array.</li>
<li><strong>data</strong> (<em>array_like</em>) – The 2D data array.</li>
<li><strong>data_errors</strong> (<em>array_like</em>) – The 2D data uncertainty array.</li>
<li><strong>guess</strong> (<em>array_like</em><em>, </em><em>optional</em>) – The guessed profile before the fit (default: None).</li>
<li><strong>live_fit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True, the plot is shown during the fitting procedure (default: False).</li>
<li><strong>title</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em>, </em><em>optional</em>) – Title of the plot (default: “”).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.plot_transverse_PSF1D_profile">
<code class="descclassname">spectractor.extractor.psf.</code><code class="descname">plot_transverse_PSF1D_profile</code><span class="sig-paren">(</span><em>x</em>, <em>indices</em>, <em>bgd_indices</em>, <em>data</em>, <em>err</em>, <em>fit=None</em>, <em>bgd_fit=None</em>, <em>params=None</em>, <em>PSF_guess=None</em>, <em>outliers=[]</em>, <em>sigma=3</em>, <em>live_fit=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#plot_transverse_PSF1D_profile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.plot_transverse_PSF1D_profile" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the transverse profile of  the spectrogram.</p>
<p>This plot function is called in transverse_PSF1D_profile if live_fit option is True.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>x</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Pixel index along the dispersion axis.</li>
<li><strong>indices</strong> (<em>array_like</em>) – Pixel indices across the dispersion axis.</li>
<li><strong>bgd_indices</strong> (<em>array_like</em>) – Pixel indices across the dispersion axis for the background estimate.</li>
<li><strong>data</strong> (<em>array_like</em>) – The 2D spectrogram data array.</li>
<li><strong>err</strong> (<em>array_like</em>) – The 2D spectrogram uncertainty data array.</li>
<li><strong>fit</strong> (<em>Fittable1DModel</em><em>, </em><em>optional</em>) – Best fitting model function for the profile (default: None).</li>
<li><strong>bgd_fit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.7)"><em>callable</em></a><em>, </em><em>optional</em>) – Best fitting model function for the background of the profile (default: None).</li>
<li><strong>params</strong> (<em>array_like</em><em>, </em><em>optional</em>) – Best fitting model parameter array (default: None).</li>
<li><strong>PSF_guess</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.7)"><em>callable</em></a><em>, </em><em>optional</em>) – Guessed fitting model function for the profile before the fit (default: None).</li>
<li><strong>outliers</strong> (<em>array_like</em><em>, </em><em>optional</em>) – Pixel indices of the outliers across the dispersion axis (default: None).</li>
<li><strong>sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a><em>, </em><em>optional</em>) – Value of the sigma-clipping rejection (default: 3).
Necessary only if an outlier array is given with the outliers keyword.</li>
<li><strong>live_fit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True, plot is shown  in live during the fitting procedure (default: False).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p># Build a mock spectrogram with random Poisson noise:
&gt;&gt;&gt; s0 = ChromaticPSF1D(Nx=100, Ny=100, saturation=1000)
&gt;&gt;&gt; params = s0.generate_test_poly_params()
&gt;&gt;&gt; saturation = params[-1]
&gt;&gt;&gt; data = s0.evaluate(params)
&gt;&gt;&gt; bgd = 10*np.ones_like(data)
&gt;&gt;&gt; data += bgd
&gt;&gt;&gt; data = np.random.poisson(data)
&gt;&gt;&gt; data_errors = np.sqrt(data+1)</p>
<p># Fit the transverse profile:
&gt;&gt;&gt; s, bgd_model = fit_transverse_PSF1D_profile(data, data_errors, w=20, ws=[30,50], pixel_step=50,
… saturation=saturation, live_fit=True, sigma=5)</p>
</dd></dl>

</div>
<div class="section" id="module-spectractor.extractor.spectroscopy">
<span id="spectractor-extractor-spectroscopy-module"></span><h2>spectractor.extractor.spectroscopy module<a class="headerlink" href="#module-spectractor.extractor.spectroscopy" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="spectractor.extractor.spectroscopy.Line">
<em class="property">class </em><code class="descclassname">spectractor.extractor.spectroscopy.</code><code class="descname">Line</code><span class="sig-paren">(</span><em>wavelength, label, atmospheric=False, emission=False, label_pos=[0.007, 0.02], width_bounds=[0.5, 6], use_for_calibration=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectroscopy.html#Line"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectroscopy.Line" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p>Class modeling the emission or absorption lines.</p>
<dl class="method">
<dt id="spectractor.extractor.spectroscopy.Line.gaussian_model">
<code class="descname">gaussian_model</code><span class="sig-paren">(</span><em>lambdas</em>, <em>A=1</em>, <em>sigma=2</em>, <em>use_fit=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectroscopy.html#Line.gaussian_model"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectroscopy.Line.gaussian_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a Gaussian model of the spectral line.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lambdas</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a>) – Wavelength array of float in nm</li>
<li><strong>A</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Amplitude of the Gaussian (default: +1)</li>
<li><strong>sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Standard deviation of the Gaussian (default: 2)</li>
<li><strong>use_fit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>, </em><em>optional</em>) – If True, it overrides the previous setting values and use the Gaussian fit made on data, if ti exists.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>model</strong> – The amplitude array of float of the Gaussian model of the line.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a>, <a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)">array</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Give lambdas as a float:
&gt;&gt;&gt; l = Line(656.3, atmospheric=False, label=’$Halpha$’)
&gt;&gt;&gt; sigma = 2.
&gt;&gt;&gt; model = l.gaussian_model(656.3, A=1, sigma=sigma, use_fit=False)
&gt;&gt;&gt; print(model)
1.0
&gt;&gt;&gt; model = l.gaussian_model(656.3+sigma*np.sqrt(2*np.log(2)), A=1, sigma=sigma, use_fit=False)
&gt;&gt;&gt; print(model)
0.5</p>
<p>Use a fit (for the example we create a mock fit result):
&gt;&gt;&gt; l.fit_lambdas = np.arange(600,700,2)
&gt;&gt;&gt; l.fit_gauss = gauss(l.fit_lambdas, 1e-10, 650, 2.3)
&gt;&gt;&gt; l.fit_fwhm = 2.3*2*np.sqrt(2*np.log(2))
&gt;&gt;&gt; lambdas = np.arange(500,1000,1)
&gt;&gt;&gt; model = l.gaussian_model(lambdas, A=1, sigma=sigma, use_fit=True)
&gt;&gt;&gt; print(model[:5])
[ 0.  0.  0.  0.  0.]</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.spectroscopy.Lines">
<em class="property">class </em><code class="descclassname">spectractor.extractor.spectroscopy.</code><code class="descname">Lines</code><span class="sig-paren">(</span><em>lines</em>, <em>redshift=0</em>, <em>atmospheric_lines=True</em>, <em>hydrogen_only=False</em>, <em>emission_spectrum=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectroscopy.html#Lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectroscopy.Lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p>Class gathering all the lines and associated methods.</p>
<dl class="method">
<dt id="spectractor.extractor.spectroscopy.Lines.plot_atomic_lines">
<code class="descname">plot_atomic_lines</code><span class="sig-paren">(</span><em>ax</em>, <em>color_atomic='g'</em>, <em>color_atmospheric='b'</em>, <em>fontsize=12</em>, <em>force=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectroscopy.html#Lines.plot_atomic_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectroscopy.Lines.plot_atomic_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Over plot the atomic lines as vertical lines, only if they are fitted or with high
signal to  noise ratio, unless force keyword is set to True.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ax</strong> (<em>Axes</em>) – An Axes instance on which plot the spectral lines.</li>
<li><strong>color_atomic</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Color of the atomic lines (default: ‘g’).</li>
<li><strong>color_atmospheric</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Color of the atmospheric lines (default: ‘b’).</li>
<li><strong>fontsize</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Font size of the spectral line labels (default: 12).</li>
<li><strong>force</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Force the plot of vertical lines if set to True (default: False).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="go">(300, 1000)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span> <span class="o">=</span> <span class="n">Lines</span><span class="p">(</span><span class="n">HYDROGEN_LINES</span><span class="o">+</span><span class="n">ATMOSPHERIC_LINES</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">high_snr</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">high_snr</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">plot_atomic_lines</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectroscopy.Lines.plot_detected_lines">
<code class="descname">plot_detected_lines</code><span class="sig-paren">(</span><em>ax=None</em>, <em>print_table=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectroscopy.html#Lines.plot_detected_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectroscopy.Lines.plot_detected_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Detect and fit the lines in a spectrum. The method is to look at maxima or minima
around emission or absorption tabulated lines, and to select surrounding pixels
to fit a (positive or negative) gaussian and a polynomial background. If several regions
overlap, a multi-gaussian fit is performed above a common polynomial background.
The mean global shift (in nm) between the detected and tabulated lines is returned, considering
only the lines with a signal-to-noise ratio above a threshold.
The order of the polynomial background is set in parameters.py with CALIB_BGD_ORDER.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ax</strong> (<em>Axes</em>) – The Axes instance if needed (default: None).</li>
<li><strong>print_table</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>, </em><em>optional</em>) – If True, print a summary table (default: False).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Creation of a mock spectrum with emission and absorption lines
&gt;&gt;&gt; from spectractor.extractor.spectrum import Spectrum, detect_lines
&gt;&gt;&gt; lambdas = np.arange(300,1000,1)
&gt;&gt;&gt; spectrum = 1e4*np.exp(-((lambdas-600)/200)**2)
&gt;&gt;&gt; spectrum += HALPHA.gaussian_model(lambdas, A=5000, sigma=3)
&gt;&gt;&gt; spectrum += HBETA.gaussian_model(lambdas, A=3000, sigma=2)
&gt;&gt;&gt; spectrum += O2.gaussian_model(lambdas, A=-3000, sigma=7)
&gt;&gt;&gt; spectrum_err = np.sqrt(spectrum)
&gt;&gt;&gt; spec = Spectrum()
&gt;&gt;&gt; spec.lambdas = lambdas
&gt;&gt;&gt; spec.data = spectrum
&gt;&gt;&gt; spec.err = spectrum_err
&gt;&gt;&gt; fwhm_func = interp1d(lambdas, 0.01 * lambdas)</p>
<p>Detect the lines
&gt;&gt;&gt; lines = Lines([HALPHA, HBETA, O2], hydrogen_only=True,
… atmospheric_lines=True, redshift=0, emission_spectrum=True)
&gt;&gt;&gt; global_chisq = detect_lines(lines, lambdas, spectrum, spectrum_err, fwhm_func=fwhm_func)
&gt;&gt;&gt; assert(global_chisq &lt; 1)</p>
<p>Plot the result
&gt;&gt;&gt; spec.lines = lines
&gt;&gt;&gt; fig = plt.figure()
&gt;&gt;&gt; plot_spectrum_simple(plt.gca(), lambdas, spec.data, data_err=spec.err)
&gt;&gt;&gt; lines.plot_detected_lines(plt.gca())
&gt;&gt;&gt; if parameters.DISPLAY: plt.show()</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectroscopy.Lines.sort_lines">
<code class="descname">sort_lines</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectroscopy.html#Lines.sort_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectroscopy.Lines.sort_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Sort the lines in increasing order of wavelength, and add the redshift effect.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><strong>sorted_lines</strong> – List of the sorted lines</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)">list</a></td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span> <span class="o">=</span> <span class="n">Lines</span><span class="p">(</span><span class="n">HYDROGEN_LINES</span><span class="o">+</span><span class="n">ATMOSPHERIC_LINES</span><span class="p">,</span> <span class="n">redshift</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_lines</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">sort_lines</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">wavelength</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">sorted_lines</span><span class="p">][:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[382.044, 393.366, 396.847, 410.2, 430.79]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-spectractor.extractor.spectrum">
<span id="spectractor-extractor-spectrum-module"></span><h2>spectractor.extractor.spectrum module<a class="headerlink" href="#module-spectractor.extractor.spectrum" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="spectractor.extractor.spectrum.Spectrum">
<em class="property">class </em><code class="descclassname">spectractor.extractor.spectrum.</code><code class="descname">Spectrum</code><span class="sig-paren">(</span><em>file_name=''</em>, <em>image=None</em>, <em>order=1</em>, <em>target=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.convert_from_ADUrate_to_flam">
<code class="descname">convert_from_ADUrate_to_flam</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.convert_from_ADUrate_to_flam"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.convert_from_ADUrate_to_flam" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert units from ADU/s to erg/s/cm^2/nm.
The SED is supposed to be in flam units ie erg/s/cm^2/nm</p>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;tests/data/reduc_20170605_028_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">convert_from_ADUrate_to_flam</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">err</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-2</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.convert_from_flam_to_ADUrate">
<code class="descname">convert_from_flam_to_ADUrate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.convert_from_flam_to_ADUrate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.convert_from_flam_to_ADUrate" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert units from erg/s/cm^2/nm to ADU/s.
The SED is supposed to be in flam units ie erg/s/cm^2/nm</p>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;tests/data/reduc_20170605_028_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">convert_from_flam_to_ADUrate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">err</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-2</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.load_chromatic_psf">
<code class="descname">load_chromatic_psf</code><span class="sig-paren">(</span><em>input_file_name</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.load_chromatic_psf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.load_chromatic_psf" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the spectrum from a fits file (data, error and wavelengths).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>input_file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Path to the input fits file</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">load_spectrum</span><span class="p">(</span><span class="s1">&#39;outputs/reduc_20170530_134_spectrum.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.load_filter">
<code class="descname">load_filter</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.load_filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.load_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Load filter properties and set relevant LAMBDA_MIN and LAMBDA_MAX values.</p>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="s1">&#39;FGB37&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">load_filter</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">parameters</span><span class="o">.</span><span class="n">LAMBDA_MIN</span> <span class="o">==</span> <span class="n">parameters</span><span class="o">.</span><span class="n">FGB37</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">parameters</span><span class="o">.</span><span class="n">LAMBDA_MAX</span> <span class="o">==</span> <span class="n">parameters</span><span class="o">.</span><span class="n">FGB37</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.load_spectrogram">
<code class="descname">load_spectrogram</code><span class="sig-paren">(</span><em>input_file_name</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.load_spectrogram"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.load_spectrogram" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the spectrum from a fits file (data, error and wavelengths).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>input_file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Path to the input fits file</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">load_spectrum</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028_spectrum.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.load_spectrum">
<code class="descname">load_spectrum</code><span class="sig-paren">(</span><em>input_file_name</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.load_spectrum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.load_spectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the spectrum from a fits file (data, error and wavelengths).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>input_file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Path to the input fits file</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">load_spectrum</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<span class="go">erg/s/cm$^2$/nm</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.plot_spectrogram">
<code class="descname">plot_spectrogram</code><span class="sig-paren">(</span><em>ax=None, scale='lin', title='', units='Image units', plot_stats=False, target_pixcoords=None, vmin=None, vmax=None, figsize=[9.3, 8], aspect=None, cmap=None, cax=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.plot_spectrogram"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.plot_spectrogram" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot spectrogram.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ax</strong> (<em>Axes</em><em>, </em><em>optional</em>) – Axes instance (default: None).</li>
<li><strong>scale</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Scaling of the image (choose between: lin, log or log10) (default: lin)</li>
<li><strong>title</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Title of the image (default: “”)</li>
<li><strong>units</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Units of the image to be written in the color bar label (default: “Image units”)</li>
<li><strong>cmap</strong> (<em>colormap</em>) – Color map label (default: None)</li>
<li><strong>target_pixcoords</strong> (<em>array_like</em><em>, </em><em>optional</em>) – 2D array  giving the (x,y) coordinates of the targets on the image: add a scatter plot (default: None)</li>
<li><strong>vmin</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Minimum value of the image (default: None)</li>
<li><strong>vmax</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Maximum value of the image (default: None)</li>
<li><strong>aspect</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Aspect keyword to be passed to imshow (default: None)</li>
<li><strong>cax</strong> (<em>Axes</em><em>, </em><em>optional</em>) – Color bar axes if necessary (default: None).</li>
<li><strong>figsize</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><em>tuple</em></a>) – Figure size (default: [9.3, 8]).</li>
<li><strong>plot_stats</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True, plot the uncertainty map instead of the spectrogram (default: False).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;tests/data/reduc_20170605_028_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_spectrogram</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.plot_spectrum">
<code class="descname">plot_spectrum</code><span class="sig-paren">(</span><em>ax=None</em>, <em>xlim=None</em>, <em>live_fit=False</em>, <em>label=''</em>, <em>force_lines=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.plot_spectrum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.plot_spectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot spectrum with emission and absorption lines.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ax</strong> (<em>Axes</em><em>, </em><em>optional</em>) – Axes instance (default: None).</li>
<li><strong>label</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Label for the legend (default: ‘’).</li>
<li><strong>xlim</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – List of minimum and maximum abscisses (default: None)</li>
<li><strong>live_fit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>, </em><em>optional</em>) – If True the spectrum is plotted in live during the fitting procedures
(default: False).</li>
<li><strong>force_lines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Force the over plot of vertical lines for atomic lines if set to True (default: False).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;tests/data/reduc_20170530_134_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">900</span><span class="p">],</span> <span class="n">live_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_lines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.save_spectrogram">
<code class="descname">save_spectrogram</code><span class="sig-paren">(</span><em>output_file_name</em>, <em>overwrite=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.save_spectrogram"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.save_spectrogram" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the spectrogram into a fits file (data, error and background).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>output_file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Path of the output fits file.</li>
<li><strong>overwrite</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>,  </em><em>optional</em>) – If True overwrite the output file if needed (default: False).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.save_spectrum">
<code class="descname">save_spectrum</code><span class="sig-paren">(</span><em>output_file_name</em>, <em>overwrite=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.save_spectrum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.save_spectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the spectrum into a fits file (data, error and wavelengths).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>output_file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Path of the output fits file.</li>
<li><strong>overwrite</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True overwrite the output file if needed (default: False).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;tests/data/reduc_20170605_028_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">save_spectrum</span><span class="p">(</span><span class="s1">&#39;./tests/test.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;./tests/test.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Overwrite previous file:
&gt;&gt;&gt; s.save_spectrum(‘./tests/test.fits’, overwrite=True)
&gt;&gt;&gt; assert os.path.isfile(‘./tests/test.fits’)
&gt;&gt;&gt; os.remove(‘./tests/test.fits’)</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.spectrum.calibrate_spectrum">
<code class="descclassname">spectractor.extractor.spectrum.</code><code class="descname">calibrate_spectrum</code><span class="sig-paren">(</span><em>spectrum</em>, <em>xlim=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#calibrate_spectrum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.calibrate_spectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert pixels into wavelengths given the position of the order 0,
the data for the spectrum, and the properties of the disperser. Convert the
spectrum amplitude from ADU rate to flams. Truncate the outputs to the wavelenghts
between parameters.LAMBDA_MIN and parameters.LAMBDA_MAX.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>spectrum</strong> (<a class="reference internal" href="#spectractor.extractor.spectrum.Spectrum" title="spectractor.extractor.spectrum.Spectrum"><em>Spectrum</em></a>) – Spectrum object to calibrate</li>
<li><strong>xlim</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – List of minimum and maximum abscisses</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.spectrum.calibrate_spectrum_with_lines">
<code class="descclassname">spectractor.extractor.spectrum.</code><code class="descname">calibrate_spectrum_with_lines</code><span class="sig-paren">(</span><em>spectrum</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#calibrate_spectrum_with_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.calibrate_spectrum_with_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert pixels into wavelengths given the position of the order 0,
the data for the spectrum, the properties of the disperser. Fit the absorption
(and eventually the emission) lines to perform a second calibration of the
distance between the CCD and the disperser. The number of fitting steps is
limited to 30.</p>
<p>Prerequisites: a first calibration from pixels to wavelengths must have been performed before</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>spectrum</strong> (<a class="reference internal" href="#spectractor.extractor.spectrum.Spectrum" title="spectractor.extractor.spectrum.Spectrum"><em>Spectrum</em></a>) – Spectrum object to calibrate</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><strong>lambdas</strong> – The new wavelength array in nm.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">array_like</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">LAMBDA_MIN</span> <span class="o">=</span> <span class="mi">550</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">LAMBDA_MAX</span> <span class="o">=</span> <span class="mi">800</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lambdas</span> <span class="o">=</span> <span class="n">calibrate_spectrum_with_lines</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.spectrum.detect_lines">
<code class="descclassname">spectractor.extractor.spectrum.</code><code class="descname">detect_lines</code><span class="sig-paren">(</span><em>lines</em>, <em>lambdas</em>, <em>spec</em>, <em>spec_err=None</em>, <em>fwhm_func=None</em>, <em>snr_minlevel=3</em>, <em>ax=None</em>, <em>xlim=(300</em>, <em>1100)</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#detect_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.detect_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Detect and fit the lines in a spectrum. The method is to look at maxima or minima
around emission or absorption tabulated lines, and to select surrounding pixels
to fit a (positive or negative) gaussian and a polynomial background. If several regions
overlap, a multi-gaussian fit is performed above a common polynomial background.
The mean global shift (in nm) between the detected and tabulated lines is returned, considering
only the lines with a signal-to-noise ratio above a threshold.
The order of the polynomial background is set in parameters.py with CALIB_BGD_ORDER.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lines</strong> (<a class="reference internal" href="#spectractor.extractor.spectroscopy.Lines" title="spectractor.extractor.spectroscopy.Lines"><em>Lines</em></a>) – The Lines object containing the line characteristics</li>
<li><strong>lambdas</strong> (<em>float array</em>) – The wavelength array (in nm)</li>
<li><strong>spec</strong> (<em>float array</em>) – The spectrum amplitude array</li>
<li><strong>spec_err</strong> (<em>float array</em><em>, </em><em>optional</em>) – The spectrum amplitude uncertainty array (default: None)</li>
<li><strong>fwhm_func</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.7)"><em>callable</em></a><em>, </em><em>optional</em>) – The fwhm of the cross spectrum to reset CALIB_PEAK_WIDTH parameter as a function of lambda (default: None)</li>
<li><strong>snr_minlevel</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The minimum signal over noise ratio to consider using a fitted line in the computation of the mean
shift output and to print it in the outpur table (default: 3)</li>
<li><strong>ax</strong> (<em>Axes</em><em>, </em><em>optional</em>) – An Axes instance to over plot the result of the fit (default: None).</li>
<li><strong>xlim</strong> (<a class="reference external" href="https://docs.python.org/3/library/array.html#module-array" title="(in Python v3.7)"><em>array</em></a><em>, </em><em>optional</em>) – (min, max) list limiting the wavelength interval where to detect spectral lines (default:
(parameters.LAMBDA_MIN, parameters.LAMBDA_MAX))</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>shift</strong> – The mean shift (in nm) between the detected and tabulated lines</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Creation of a mock spectrum with emission and absorption lines
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; lambdas = np.arange(300,1000,1)
&gt;&gt;&gt; spectrum = 1e4*np.exp(-((lambdas-600)/200)**2)
&gt;&gt;&gt; spectrum += HALPHA.gaussian_model(lambdas, A=5000, sigma=3)
&gt;&gt;&gt; spectrum += HBETA.gaussian_model(lambdas, A=3000, sigma=2)
&gt;&gt;&gt; spectrum += O2.gaussian_model(lambdas, A=-3000, sigma=7)
&gt;&gt;&gt; spectrum_err = np.sqrt(spectrum)
&gt;&gt;&gt; spec = Spectrum()
&gt;&gt;&gt; spec.lambdas = lambdas
&gt;&gt;&gt; spec.data = spectrum
&gt;&gt;&gt; spec.err = spectrum_err
&gt;&gt;&gt; fwhm_func = interp1d(lambdas, 0.01 * lambdas)</p>
<p>Detect the lines
&gt;&gt;&gt; lines = Lines([HALPHA, HBETA, O2], hydrogen_only=True,
… atmospheric_lines=True, redshift=0, emission_spectrum=True)
&gt;&gt;&gt; global_chisq = detect_lines(lines, lambdas, spectrum, spectrum_err, fwhm_func=fwhm_func)
&gt;&gt;&gt; assert(global_chisq &lt; 1)</p>
<p>Plot the result
&gt;&gt;&gt; spec.lines = lines
&gt;&gt;&gt; fig = plt.figure()
&gt;&gt;&gt; plot_spectrum_simple(plt.gca(), lambdas, spec.data, data_err=spec.err)
&gt;&gt;&gt; lines.plot_detected_lines(plt.gca())
&gt;&gt;&gt; if parameters.DISPLAY: plt.show()</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.spectrum.extract_spectrum_from_image">
<code class="descclassname">spectractor.extractor.spectrum.</code><code class="descname">extract_spectrum_from_image</code><span class="sig-paren">(</span><em>image</em>, <em>spectrum</em>, <em>w=10</em>, <em>ws=(20</em>, <em>30)</em>, <em>right_edge=1848</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#extract_spectrum_from_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.extract_spectrum_from_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the 1D spectrum from the image.</p>
<p>Method : remove a uniform background estimated from the rectangular lateral bands</p>
<p>The spectrum amplitude is the sum of the pixels in the 2*w rectangular window
centered on the order 0 y position.
The up and down backgrounds are estimated as the median in rectangular regions
above and below the spectrum, in the ws-defined rectangular regions; stars are filtered
as nan values using an hessian analysis of the image to remove structures.
The subtracted background is the mean of the two up and down backgrounds.
Stars are filtered.</p>
<dl class="docutils">
<dt>Prerequisites: the target position must have been found before, and the</dt>
<dd>image turned to have an horizontal dispersion line</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – Image object from which to extract the spectrum</li>
<li><strong>spectrum</strong> (<a class="reference internal" href="#spectractor.extractor.spectrum.Spectrum" title="spectractor.extractor.spectrum.Spectrum"><em>Spectrum</em></a>) – Spectrum object to store new wavelengths, data and error arrays</li>
<li><strong>w</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Half width of central region where the spectrum is extracted and summed (default: 10)</li>
<li><strong>ws</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a>) – up/down region extension where the sky background is estimated with format [int, int] (default: [20,30])</li>
<li><strong>right_edge</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Right-hand pixel position above which no pixel should be used (default: 1800)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-spectractor.extractor.targets">
<span id="spectractor-extractor-targets-module"></span><h2>spectractor.extractor.targets module<a class="headerlink" href="#module-spectractor.extractor.targets" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="spectractor.extractor.targets.ArcLamp">
<em class="property">class </em><code class="descclassname">spectractor.extractor.targets.</code><code class="descname">ArcLamp</code><span class="sig-paren">(</span><em>label</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#ArcLamp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.ArcLamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.targets.Target" title="spectractor.extractor.targets.Target"><code class="xref py py-class docutils literal"><span class="pre">spectractor.extractor.targets.Target</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.targets.ArcLamp.load">
<code class="descname">load</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#ArcLamp.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.ArcLamp.load" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.targets.Monochromator">
<em class="property">class </em><code class="descclassname">spectractor.extractor.targets.</code><code class="descname">Monochromator</code><span class="sig-paren">(</span><em>label</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Monochromator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Monochromator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.targets.Target" title="spectractor.extractor.targets.Target"><code class="xref py py-class docutils literal"><span class="pre">spectractor.extractor.targets.Target</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.targets.Monochromator.load">
<code class="descname">load</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Monochromator.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Monochromator.load" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.targets.Star">
<em class="property">class </em><code class="descclassname">spectractor.extractor.targets.</code><code class="descname">Star</code><span class="sig-paren">(</span><em>label</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Star"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Star" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.targets.Target" title="spectractor.extractor.targets.Target"><code class="xref py py-class docutils literal"><span class="pre">spectractor.extractor.targets.Target</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.targets.Star.build_sed">
<code class="descname">build_sed</code><span class="sig-paren">(</span><em>index=0</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Star.build_sed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Star.build_sed" title="Permalink to this definition">¶</a></dt>
<dd><p>Interpolate the database reference spectra and return self.sed as a function of the wavelength.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>index</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Index of the spectrum stored in the self.spectra list</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Star</span><span class="p">(</span><span class="s1">&#39;HD111980&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">build_sed</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">sed</span><span class="p">(</span><span class="mi">550</span><span class="p">)</span>
<span class="go">array(1.676051129017069e-11)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.targets.Star.load">
<code class="descname">load</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Star.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Star.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the coordinates of the target.</p>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Star</span><span class="p">(</span><span class="s1">&#39;3C273&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">coord</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
<span class="go">2d03m08.598s</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.targets.Star.load_spectra">
<code class="descname">load_spectra</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Star.load_spectra"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Star.load_spectra" title="Permalink to this definition">¶</a></dt>
<dd><p>Load reference spectra from Pysynphot database or NED database.</p>
<p>If the object redshift is &gt;0.2, the LAMBDA_MIN and LAMBDA_MAX parameters
are redshifted accordingly.</p>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Star</span><span class="p">(</span><span class="s1">&#39;3C273&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">4</span><span class="p">])</span>
<span class="go">[  0.00000000e+00   2.50485769e-14   2.42380612e-14   2.40887886e-14]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Star</span><span class="p">(</span><span class="s1">&#39;HD111980&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">4</span><span class="p">])</span>
<span class="go">[  2.16890002e-13   2.66480010e-13   2.03540011e-13   2.38780004e-13]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Star</span><span class="p">(</span><span class="s1">&#39;PKS1510-089&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">redshift</span><span class="p">)</span>
<span class="go">0.36</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{parameters.LAMBDA_MIN:.1f}</span><span class="s1">, </span><span class="si">{parameters.LAMBDA_MAX:.1f}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="go">408.0, 1496.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">4</span><span class="p">])</span>
<span class="go">[ 117.34012  139.27621   87.38032  143.0816 ]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.targets.Star.plot_spectra">
<code class="descname">plot_spectra</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Star.plot_spectra"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Star.plot_spectra" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the spectra stored in the self.spectra list.</p>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Star</span><span class="p">(</span><span class="s1">&#39;HD111980&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_spectra</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.targets.Target">
<em class="property">class </em><code class="descclassname">spectractor.extractor.targets.</code><code class="descname">Target</code><span class="sig-paren">(</span><em>label</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Target"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Target" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.targets.load_target">
<code class="descclassname">spectractor.extractor.targets.</code><code class="descname">load_target</code><span class="sig-paren">(</span><em>label</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#load_target"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.load_target" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the target properties according to the type set by parameters.OBS_OBJECT_TYPE.</p>
<p>Currently, the type can be either “STAR”, “HG-AR” or “MONOCHROMATOR”. The label parameter gives the
name of the source and allows to load its specific properties.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>label</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The label of the target.</li>
<li><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>, </em><em>optional</em>) – If True, more verbosity (default: False).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">OBS_OBJECT_TYPE</span> <span class="o">=</span> <span class="s2">&quot;STAR&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">load_target</span><span class="p">(</span><span class="s2">&quot;HD111980&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
<span class="go">HD111980</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">coord</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
<span class="go">-18d31m20.009s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">OBS_OBJECT_TYPE</span> <span class="o">=</span> <span class="s2">&quot;MONOCHROMATOR&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">load_target</span><span class="p">(</span><span class="s2">&quot;XX&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
<span class="go">XX</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">OBS_OBJECT_TYPE</span> <span class="o">=</span> <span class="s2">&quot;HG-AR&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">load_target</span><span class="p">(</span><span class="s2">&quot;XX&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">wavelength</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">lines</span><span class="p">][:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[253.652, 296.728, 302.15, 313.155, 334.148]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">OBS_OBJECT_TYPE</span> <span class="o">=</span> <span class="s2">&quot;OTHER&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">load_target</span><span class="p">(</span><span class="s2">&quot;XX&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-spectractor.extractor">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-spectractor.extractor" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Jeremy Neveu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>