

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>spectractor.extractor package &mdash; Spectractor 1.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="spectractor.fit package" href="spectractor.fit.html" />
    <link rel="prev" title="spectractor package" href="spectractor.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Spectractor
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">spectractor</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="spectractor.html">spectractor package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="spectractor.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">spectractor.extractor package</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectractor.fit.html">spectractor.fit package</a></li>
<li class="toctree-l4"><a class="reference internal" href="spectractor.simulation.html">spectractor.simulation package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="spectractor.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="spectractor.html#module-spectractor.config">spectractor.config module</a></li>
<li class="toctree-l3"><a class="reference internal" href="spectractor.html#module-spectractor.logbook">spectractor.logbook module</a></li>
<li class="toctree-l3"><a class="reference internal" href="spectractor.html#module-spectractor.parameters">spectractor.parameters module</a></li>
<li class="toctree-l3"><a class="reference internal" href="spectractor.html#module-spectractor.tools">spectractor.tools module</a></li>
<li class="toctree-l3"><a class="reference internal" href="spectractor.html#module-spectractor">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Spectractor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="modules.html">spectractor</a> &raquo;</li>
        
          <li><a href="spectractor.html">spectractor package</a> &raquo;</li>
        
      <li>spectractor.extractor package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/source/spectractor.extractor.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spectractor-extractor-package">
<h1>spectractor.extractor package<a class="headerlink" href="#spectractor-extractor-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-spectractor.extractor.dispersers">
<span id="spectractor-extractor-dispersers-module"></span><h2>spectractor.extractor.dispersers module<a class="headerlink" href="#module-spectractor.extractor.dispersers" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="spectractor.extractor.dispersers.Grating">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.dispersers.</code><code class="sig-name descname">Grating</code><span class="sig-paren">(</span><em class="sig-param">N</em>, <em class="sig-param">label=''</em>, <em class="sig-param">D=55.45</em>, <em class="sig-param">data_dir='/Users/jneveu/Documents/LSST/Calibration/Spectractor/spectractor/extractor/dispersers/'</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Generic class for dispersers.</p>
<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.N">
<code class="sig-name descname">N</code><span class="sig-paren">(</span><em class="sig-param">x</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.N"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.N" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of grooves per mm of the grating at position x.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x</strong> (<em>array</em>) – The [x,y] pixel position.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>N</strong> – The number of grooves per mm at position x</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Grating</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">N</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">))</span>
<span class="go">400</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.grating_lambda_to_pixel">
<code class="sig-name descname">grating_lambda_to_pixel</code><span class="sig-paren">(</span><em class="sig-param">lambdas</em>, <em class="sig-param">x0</em>, <em class="sig-param">order=1</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.grating_lambda_to_pixel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.grating_lambda_to_pixel" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert wavelength in nm into pixel distance with order 0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lambdas</strong> (<em>array</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Wavelengths in nm.</p></li>
<li><p><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em> or </em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>]</em>) – Order 0 position detected in the raw image.</p></li>
<li><p><strong>order</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Order of the spectrum (default: 1)</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">disperser</span> <span class="o">=</span> <span class="n">Grating</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">55</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span><span class="mi">800</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deltaX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lambdas</span> <span class="o">=</span> <span class="n">disperser</span><span class="o">.</span><span class="n">grating_pixel_to_lambda</span><span class="p">(</span><span class="n">deltaX</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">lambdas</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[0.         1.45454532 2.90909063 4.36363511 5.81817793]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pixels</span> <span class="o">=</span> <span class="n">disperser</span><span class="o">.</span><span class="n">grating_lambda_to_pixel</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pixels</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[0. 1. 2. 3. 4.]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.grating_pixel_to_lambda">
<code class="sig-name descname">grating_pixel_to_lambda</code><span class="sig-paren">(</span><em class="sig-param">deltaX</em>, <em class="sig-param">x0</em>, <em class="sig-param">order=1</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.grating_pixel_to_lambda"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.grating_pixel_to_lambda" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert pixels into wavelengths (in nm) with.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>deltaX</strong> (<em>array</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Pixel distances to order 0.</p></li>
<li><p><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em> or </em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>]</em>) – Order 0 position detected in the non-rotated image.</p></li>
<li><p><strong>order</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Order of the spectrum (default: 1)</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">disperser</span> <span class="o">=</span> <span class="n">Grating</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">55</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span><span class="mi">800</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deltaX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lambdas</span> <span class="o">=</span> <span class="n">disperser</span><span class="o">.</span><span class="n">grating_pixel_to_lambda</span><span class="p">(</span><span class="n">deltaX</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">lambdas</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[0.         1.45454532 2.90909063 4.36363511 5.81817793]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pixels</span> <span class="o">=</span> <span class="n">disperser</span><span class="o">.</span><span class="n">grating_lambda_to_pixel</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pixels</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[0. 1. 2. 3. 4.]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.grating_resolution">
<code class="sig-name descname">grating_resolution</code><span class="sig-paren">(</span><em class="sig-param">deltaX</em>, <em class="sig-param">x0</em>, <em class="sig-param">order=1</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.grating_resolution"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.grating_resolution" title="Permalink to this definition">¶</a></dt>
<dd><p>Return wavelength resolution in nm per pixel.
See mathematica notebook: derivative of the grating formula.
x0: the order 0 position on the full raw image.
deltaX: the distance in pixels between order 0 and signal point
in the rotated image.</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.load_files">
<code class="sig-name descname">load_files</code><span class="sig-paren">(</span><em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.load_files"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.load_files" title="Permalink to this definition">¶</a></dt>
<dd><p>If they exists, load the files in data_dir/label/ to set the main
characteristics of the grating. Overrides the N input at initialisation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Set to True to get more verbosity.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>The files exist:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Grating</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ron400&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">N_input</span>
<span class="go">400.86918248709316</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">theta_tilt</span><span class="p">)</span>
<span class="go">-0.277</span>
</pre></div>
</div>
<p>The files do not exist:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Grating</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;XXX&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">N_input</span>
<span class="go">400</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">theta_tilt</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.plot_transmission">
<code class="sig-name descname">plot_transmission</code><span class="sig-paren">(</span><em class="sig-param">xlim=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.plot_transmission"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.plot_transmission" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the transmission of the grating with respect to the wavelength (in nm).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>xlim</strong> (<em>[</em><em>xmin</em><em>,</em><em>xmax</em><em>]</em><em>, </em><em>optional</em>) – List of the X axis extrema (default: None).</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Grating</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ron400&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">plot_transmission</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">800</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.refraction_angle">
<code class="sig-name descname">refraction_angle</code><span class="sig-paren">(</span><em class="sig-param">deltaX</em>, <em class="sig-param">x0</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.refraction_angle"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.refraction_angle" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the refraction angle with respect to the disperser normal, using geometrical consideration,
given the distance to order 0 in pixels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>deltaX</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The distance in pixels between the order 0 and a spectrum pixel in the rotated image.</p></li>
<li><p><strong>x0</strong> (<em>array</em>) – The order 0 position [x0,y0] in the full non-rotated image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>theta</strong> – The refraction angle in radians.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Grating</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">refraction_angle</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="p">[</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="mi">500</span><span class="o">*</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_PIXEL2MM</span><span class="p">,</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISTANCE2CCD</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Grating.refraction_angle_lambda">
<code class="sig-name descname">refraction_angle_lambda</code><span class="sig-paren">(</span><em class="sig-param">lambdas</em>, <em class="sig-param">x0</em>, <em class="sig-param">order=1</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Grating.refraction_angle_lambda"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Grating.refraction_angle_lambda" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the refraction angle with respect to the disperser normal, using geometrical consideration,
given the wavelength in nm and the order of the spectrum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lambdas</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>array</em>) – The distance in pixels between the order 0 and a spectrum pixel in the rotated image.</p></li>
<li><p><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>array</em>) – The order 0 pixel position [x0,y0] in the full non-rotated image.</p></li>
<li><p><strong>order</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – The order of the spectrum.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>theta</strong> – The refraction angle in radians.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Grating</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">refraction_angle</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="p">[</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="mi">500</span><span class="o">*</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_PIXEL2MM</span><span class="p">,</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISTANCE2CCD</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.dispersers.Hologram">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.dispersers.</code><code class="sig-name descname">Hologram</code><span class="sig-paren">(</span><em class="sig-param">label</em>, <em class="sig-param">D=55.45</em>, <em class="sig-param">data_dir='/Users/jneveu/Documents/LSST/Calibration/Spectractor/spectractor/extractor/dispersers/'</em>, <em class="sig-param">lambda_plot=256000</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Hologram"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Hologram" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.dispersers.Grating" title="spectractor.extractor.dispersers.Grating"><code class="xref py py-class docutils literal notranslate"><span class="pre">spectractor.extractor.dispersers.Grating</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.dispersers.Hologram.N">
<code class="sig-name descname">N</code><span class="sig-paren">(</span><em class="sig-param">x</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Hologram.N"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Hologram.N" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of grooves per mm of the grating at position x. If the position is inside
the data provided by the text files, this number is computed from an interpolation. If it lies outside,
it is computed from a 2D polynomial fit.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>array</em>) – The [x,y] pixel position on the CCD.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>N</strong> – The number of grooves per mm at position x</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">Hologram</span><span class="p">(</span><span class="s1">&#39;HoloPhP&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">N</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">))</span>
<span class="go">345.4794168822986</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">N</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="go">283.56876727310373</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.dispersers.Hologram.load_specs">
<code class="sig-name descname">load_specs</code><span class="sig-paren">(</span><em class="sig-param">verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#Hologram.load_specs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.Hologram.load_specs" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the files in data_dir/label/ to set the main
characteristics of the hologram. If they do not exist, default values are used.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Set to True to get more verbosity.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>The files exist:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">Hologram</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;HoloPhP&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">N</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">))</span>
<span class="go">345.4794168822986</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">theta</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">))</span>
<span class="go">-1.3393287109201792</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">holo_center</span>
<span class="go">[856.004, 562.34]</span>
</pre></div>
</div>
<p>The files do not exist:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">Hologram</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;XXX&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">N</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">))</span>
<span class="go">350</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">theta</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">))</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">holo_center</span>
<span class="go">[1024.0, 1024.0]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.build_hologram">
<code class="sig-prename descclassname">spectractor.extractor.dispersers.</code><code class="sig-name descname">build_hologram</code><span class="sig-paren">(</span><em class="sig-param">order0_position</em>, <em class="sig-param">order1_position</em>, <em class="sig-param">theta_tilt=0</em>, <em class="sig-param">lambda_plot=256000</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#build_hologram"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.build_hologram" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce the interference pattern printed on a hologram, with two sources
located at order0_position and order1_position, with an angle theta_tilt with respect
to the X axis. For plotting reasons, the wavelength can be set very large with
the lambda_plot parameter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>order0_position</strong> (<em>array</em>) – List [x0,y0] of the pixel coordinates of the order 0 source position (source A).</p></li>
<li><p><strong>order1_position</strong> (<em>array</em>) – List [x1,y1] of the pixel coordinates of the order 1 source position (source B).</p></li>
<li><p><strong>theta_tilt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Angle (in degree) to tilt the interference pattern with respect to X axis (default: 0)</p></li>
<li><p><strong>lambda_plot</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Wavelength to produce the interference pattern (default: 256000)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>hologram</strong> – The hologram figure, of shape (CCD_IMSIZE,CCD_IMSIZE)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>2D-array,</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">hologram</span> <span class="o">=</span> <span class="n">build_hologram</span><span class="p">([</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">],[</span><span class="mi">800</span><span class="p">,</span><span class="mi">500</span><span class="p">],</span><span class="n">theta_tilt</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">lambda_plot</span><span class="o">=</span><span class="mi">200000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">hologram</span><span class="p">[:</span><span class="mi">5</span><span class="p">,:</span><span class="mi">5</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))))</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.build_ronchi">
<code class="sig-prename descclassname">spectractor.extractor.dispersers.</code><code class="sig-name descname">build_ronchi</code><span class="sig-paren">(</span><em class="sig-param">x_center</em>, <em class="sig-param">theta_tilt=0</em>, <em class="sig-param">grooves=400</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#build_ronchi"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.build_ronchi" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce the Ronchi pattern (alternance of recatngular stripes of transparancy 0 and 1),
centered at x_center, with an angle theta_tilt with respect
to the X axis. Grooves parameter set the number of grooves per mm.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x_center</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Center pixel to start the figure with a black stripe.</p></li>
<li><p><strong>theta_tilt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Angle (in degree) to tilt the interference pattern with respect to X axis (default: 0)</p></li>
<li><p><strong>grooves</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Number of grooves per mm (default: 400)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>hologram</strong> – The hologram figure, of shape (CCD_IMSIZE,CCD_IMSIZE)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>2D-array,</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ronchi</span> <span class="o">=</span> <span class="n">build_ronchi</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">theta_tilt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">grooves</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ronchi</span><span class="p">[:</span><span class="mi">5</span><span class="p">,:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[[0 1 0 0 1]</span>
<span class="go"> [0 1 0 0 1]</span>
<span class="go"> [0 1 0 0 1]</span>
<span class="go"> [0 1 0 0 1]</span>
<span class="go"> [0 1 0 0 1]]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.find_order01_positions">
<code class="sig-prename descclassname">spectractor.extractor.dispersers.</code><code class="sig-name descname">find_order01_positions</code><span class="sig-paren">(</span><em class="sig-param">holo_center</em>, <em class="sig-param">N_interp</em>, <em class="sig-param">theta_interp</em>, <em class="sig-param">verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#find_order01_positions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.find_order01_positions" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the order 0 and order 1 positions of an hologram.</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.get_N">
<code class="sig-prename descclassname">spectractor.extractor.dispersers.</code><code class="sig-name descname">get_N</code><span class="sig-paren">(</span><em class="sig-param">deltaX</em>, <em class="sig-param">x0</em>, <em class="sig-param">D=55.45</em>, <em class="sig-param">wavelength=656</em>, <em class="sig-param">order=1</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#get_N"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.get_N" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the grooves per mm number given the spectrum pixel x position with
its wavelength in mm, the distance to the CCD in mm and the order number. It
uses the disperser formula.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>deltaX</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The distance in pixels between the order 0 and a spectrum pixel in the rotated image.</p></li>
<li><p><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>[</em><em>x0</em><em>,</em><em>y0</em><em>]</em>) – The order 0 position in the full non-rotated image.</p></li>
<li><p><strong>D</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The distance between the CCD and the disperser in mm.</p></li>
<li><p><strong>wavelength</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The wavelength at pixel x in nm (default: 656).</p></li>
<li><p><strong>order</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – The order of the spectrum (default: 1).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>theta</strong> – The number of grooves per mm.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">delta</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">600</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="n">get_N</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">],</span> <span class="n">D</span><span class="o">=</span><span class="n">D</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<span class="go">355</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.get_delta_pix_ortho">
<code class="sig-prename descclassname">spectractor.extractor.dispersers.</code><code class="sig-name descname">get_delta_pix_ortho</code><span class="sig-paren">(</span><em class="sig-param">deltaX</em>, <em class="sig-param">x0</em>, <em class="sig-param">D=55.45</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#get_delta_pix_ortho"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.get_delta_pix_ortho" title="Permalink to this definition">¶</a></dt>
<dd><p>Subtract from the distance deltaX in pixels between a pixel x the order 0 the distance between
the projected incident point on the disperser and the order 0. In other words, the projection of the incident
angle theta0 from the disperser to the CCD is removed. The distance to the CCD D is in mm.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>deltaX</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The distance in pixels between the order 0 and a spectrum pixel in the rotated image.</p></li>
<li><p><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>[</em><em>x0</em><em>,</em><em>y0</em><em>]</em>) – The order 0 position in the full non-rotated image.</p></li>
<li><p><strong>D</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The distance between the CCD and the disperser in mm.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>distance</strong> – The projected distance in pixels</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">delta</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">55</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_delta_pix_ortho</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="p">[</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">D</span><span class="o">=</span><span class="n">D</span><span class="p">)</span>
<span class="go">500.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_delta_pix_ortho</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">],</span> <span class="n">D</span><span class="o">=</span><span class="n">D</span><span class="p">)</span>
<span class="go">497.6654556732099</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.get_refraction_angle">
<code class="sig-prename descclassname">spectractor.extractor.dispersers.</code><code class="sig-name descname">get_refraction_angle</code><span class="sig-paren">(</span><em class="sig-param">deltaX</em>, <em class="sig-param">x0</em>, <em class="sig-param">D=55.45</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#get_refraction_angle"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.get_refraction_angle" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the refraction angle with respect to the disperser normal, using geometrical consideration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>deltaX</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The distance in pixels between the order 0 and a spectrum pixel in the rotated image.</p></li>
<li><p><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>[</em><em>x0</em><em>,</em><em>y0</em><em>]</em>) – The order 0 position in the full non-rotated image.</p></li>
<li><p><strong>D</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The distance between the CCD and the disperser in mm.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>theta</strong> – The refraction angle in radians.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">delta</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">55</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">get_refraction_angle</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="p">[</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">D</span><span class="o">=</span><span class="n">D</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">delta</span><span class="o">*</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_PIXEL2MM</span><span class="p">,</span> <span class="n">D</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">get_refraction_angle</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">],</span> <span class="n">D</span><span class="o">=</span><span class="n">D</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
<span class="go">0.21</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.get_theta0">
<code class="sig-prename descclassname">spectractor.extractor.dispersers.</code><code class="sig-name descname">get_theta0</code><span class="sig-paren">(</span><em class="sig-param">x0</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#get_theta0"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.get_theta0" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the incident angle on the disperser in radians, with respect to the disperser normal and the X axis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x0</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a>) – The order 0 position in the full non-rotated image.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>theta0</strong> – The incident angle in radians</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_theta0</span><span class="p">((</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_theta0</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="go">0.0</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.neutral_lines">
<code class="sig-prename descclassname">spectractor.extractor.dispersers.</code><code class="sig-name descname">neutral_lines</code><span class="sig-paren">(</span><em class="sig-param">x_center</em>, <em class="sig-param">y_center</em>, <em class="sig-param">theta_tilt</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#neutral_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.neutral_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the nuetrla lines of an hologram.</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.dispersers.order01_positions">
<code class="sig-prename descclassname">spectractor.extractor.dispersers.</code><code class="sig-name descname">order01_positions</code><span class="sig-paren">(</span><em class="sig-param">holo_center</em>, <em class="sig-param">N</em>, <em class="sig-param">theta_tilt</em>, <em class="sig-param">theta0=0</em>, <em class="sig-param">verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/dispersers.html#order01_positions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.dispersers.order01_positions" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the order 0 and order 1 positions of an hologram.</p>
</dd></dl>

</div>
<div class="section" id="module-spectractor.extractor.extractor">
<span id="spectractor-extractor-extractor-module"></span><h2>spectractor.extractor.extractor module<a class="headerlink" href="#module-spectractor.extractor.extractor" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="spectractor.extractor.extractor.Spectractor">
<code class="sig-prename descclassname">spectractor.extractor.extractor.</code><code class="sig-name descname">Spectractor</code><span class="sig-paren">(</span><em class="sig-param">file_name</em>, <em class="sig-param">output_directory</em>, <em class="sig-param">guess</em>, <em class="sig-param">target</em>, <em class="sig-param">disperser_label=''</em>, <em class="sig-param">config='./config/ctio.ini'</em>, <em class="sig-param">atmospheric_lines=True</em>, <em class="sig-param">line_detection=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/extractor.html#Spectractor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.extractor.Spectractor" title="Permalink to this definition">¶</a></dt>
<dd><p>Main function to extract a spectrum from an image</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Input file nam of the image to analyse</p></li>
<li><p><strong>output_directory</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Output directory</p></li>
<li><p><strong>guess</strong> (<em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a><em>,</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a><em>]</em>) – [x0,y0] list of the guessed pixel positions of the target in the image (must be integers)</p></li>
<li><p><strong>target</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The name of the targeted object</p></li>
<li><p><strong>disperser_label</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The name of the disperser</p></li>
<li><p><strong>config</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The config file name</p></li>
<li><p><strong>atmospheric_lines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True atmospheric lines are used in the calibration fit</p></li>
<li><p><strong>line_detection</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <dl class="simple">
<dt>If True the absorption or emission lines are</dt><dd><p>used to calibrate the pixel to wavelength relationship</p>
</dd>
</dl>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>spectrum</strong> – The extracted spectrum object</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#spectractor.extractor.spectrum.Spectrum" title="spectractor.extractor.spectrum.Spectrum">Spectrum</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Extract the spectrogram and its characteristics from the image:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spectractor.logbook</span> <span class="k">import</span> <span class="n">LogBook</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logbook</span> <span class="o">=</span> <span class="n">LogBook</span><span class="p">(</span><span class="n">logbook</span><span class="o">=</span><span class="s1">&#39;./ctiofulllogbook_jun2017_v5.csv&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;./tests/data/reduc_20170530_134.fits&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">tag</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">disperser_label</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span> <span class="o">=</span> <span class="n">logbook</span><span class="o">.</span><span class="n">search_for_image</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">xpos</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ypos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">continue</span>
<span class="gp">... </span>    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">Spectractor</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;./tests/data/&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">],</span> <span class="n">target</span><span class="p">,</span> <span class="n">disperser_label</span><span class="p">,</span> <span class="s1">&#39;./config/ctio.ini&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-spectractor.extractor.images">
<span id="spectractor-extractor-images-module"></span><h2>spectractor.extractor.images module<a class="headerlink" href="#module-spectractor.extractor.images" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="spectractor.extractor.images.Image">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.images.</code><code class="sig-name descname">Image</code><span class="sig-paren">(</span><em class="sig-param">file_name</em>, <em class="sig-param">target=''</em>, <em class="sig-param">disperser_label=''</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.images.Image.compute_parallactic_angle">
<code class="sig-name descname">compute_parallactic_angle</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image.compute_parallactic_angle"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image.compute_parallactic_angle" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the parallactic angle.</p>
<p>Script from A. Guyonnet.</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.images.Image.compute_statistical_error">
<code class="sig-name descname">compute_statistical_error</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image.compute_statistical_error"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image.compute_statistical_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the image noise map from Image.data. The latter must be in ADU.
The function first converts the image in electron counts units, evaluate the Poisson noise,
add in quadrature the read-out noise, takes the square root and returns a map in ADU units.</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.images.Image.convert_to_ADU_rate_units">
<code class="sig-name descname">convert_to_ADU_rate_units</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image.convert_to_ADU_rate_units"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image.convert_to_ADU_rate_units" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert Image data from ADU to ADU/s units.</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">expo</span><span class="p">)</span>
<span class="go">600.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_before</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">convert_to_ADU_rate_units</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.images.Image.convert_to_ADU_units">
<code class="sig-name descname">convert_to_ADU_units</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image.convert_to_ADU_units"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image.convert_to_ADU_units" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert Image data from ADU/s to ADU units.</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">expo</span><span class="p">)</span>
<span class="go">600.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_before</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">convert_to_ADU_rate_units</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_after</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">convert_to_ADU_units</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.images.Image.load_image">
<code class="sig-name descname">load_image</code><span class="sig-paren">(</span><em class="sig-param">file_name</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image.load_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image.load_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the image and store some information from header in class attributes.
Then load the target and disperser properties. Called when an Image instance is created.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The fits file name.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.images.Image.plot_image">
<code class="sig-name descname">plot_image</code><span class="sig-paren">(</span><em class="sig-param">ax=None, scale='lin', title='', units='Image units', plot_stats=False, target_pixcoords=None, figsize=[9.3, 8], aspect=None, vmin=None, vmax=None, cmap=None, cax=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image.plot_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image.plot_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ax</strong> (<em>Axes</em><em>, </em><em>optional</em>) – Axes instance (default: None).</p></li>
<li><p><strong>scale</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Scaling of the image (choose between: lin, log or log10) (default: lin)</p></li>
<li><p><strong>title</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Title of the image (default: “”)</p></li>
<li><p><strong>units</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Units of the image to be written in the color bar label (default: “Image units”)</p></li>
<li><p><strong>cmap</strong> (<em>colormap</em>) – Color map label (default: None)</p></li>
<li><p><strong>target_pixcoords</strong> (<em>array_like</em><em>, </em><em>optional</em>) – 2D array  giving the (x,y) coordinates of the targets on the image: add a scatter plot (default: None)</p></li>
<li><p><strong>vmin</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Minimum value of the image (default: None)</p></li>
<li><p><strong>vmax</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Maximum value of the image (default: None)</p></li>
<li><p><strong>aspect</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Aspect keyword to be passed to imshow (default: None)</p></li>
<li><p><strong>cax</strong> (<em>Axes</em><em>, </em><em>optional</em>) – Color bar axes if necessary (default: None).</p></li>
<li><p><strong>figsize</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><em>tuple</em></a>) – Figure size (default: [9.3, 8]).</p></li>
<li><p><strong>plot_stats</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True, plot the uncertainty map instead of the image (default: False).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">plot_image</span><span class="p">(</span><span class="n">target_pixcoords</span><span class="o">=</span><span class="p">[</span><span class="mi">820</span><span class="p">,</span> <span class="mi">580</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.images.Image.save_image">
<code class="sig-name descname">save_image</code><span class="sig-paren">(</span><em class="sig-param">output_file_name</em>, <em class="sig-param">overwrite=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#Image.save_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.Image.save_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the image in a fits file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The output file name.</p></li>
<li><p><strong>overwrite</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True, overwrite the file if it exists previously (default: False).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">save_image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028_copy.fits&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.build_CTIO_gain_map">
<code class="sig-prename descclassname">spectractor.extractor.images.</code><code class="sig-name descname">build_CTIO_gain_map</code><span class="sig-paren">(</span><em class="sig-param">image</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#build_CTIO_gain_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.build_CTIO_gain_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the CTIO gain map according to header GAIN values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance to fill with file data and header.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.build_CTIO_read_out_noise_map">
<code class="sig-prename descclassname">spectractor.extractor.images.</code><code class="sig-name descname">build_CTIO_read_out_noise_map</code><span class="sig-paren">(</span><em class="sig-param">image</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#build_CTIO_read_out_noise_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.build_CTIO_read_out_noise_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the CTIO gain map according to header GAIN values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance to fill with file data and header.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.compute_rotation_angle_hessian">
<code class="sig-prename descclassname">spectractor.extractor.images.</code><code class="sig-name descname">compute_rotation_angle_hessian</code><span class="sig-paren">(</span><em class="sig-param">image</em>, <em class="sig-param">deg_threshold=10</em>, <em class="sig-param">width_cut=100</em>, <em class="sig-param">right_edge=1848</em>, <em class="sig-param">margin_cut=12</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#compute_rotation_angle_hessian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.compute_rotation_angle_hessian" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the rotation angle in degree of a spectrogram with the Hessian of the image.
Use the disperser rotation angle map as a prior and the target_pixcoords values to crop the image
around the spectrogram.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance.</p></li>
<li><p><strong>deg_threshold</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Don’t consider pixel with Hessian angle above deg_threshold or below -deg_threshold (default: 10).</p></li>
<li><p><strong>width_cut</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Half with of the image to consider in height (default: parameters.YWINDOW).</p></li>
<li><p><strong>right_edge</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Maximum pixel on the right edge (default: parameters.CCD_IMSIZE - 200).</p></li>
<li><p><strong>margin_cut</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – After computing the Hessian, to avoid bad values on the edges the function cut on the
edge of image margin_cut pixels.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>theta</strong> – The median value of the histogram of angles deduced with the Hessian of the pixels (in degree).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">=</span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">,</span> <span class="n">disperser_label</span><span class="o">=</span><span class="s1">&#39;HoloPhAg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Create a mock spectrogram:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">slope</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">slope</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">N</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">... </span>    <span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-1.py">Source code</a>)</p>
<div class="figure align-default">
<img alt="../_images/spectractor-extractor-1.png" src="../_images/spectractor-extractor-1.png" />
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">target_pixcoords</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">compute_rotation_angle_hessian</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{theta:.2f}</span><span class="s1">, {np.arctan(slope)*180/np.pi:.2f}&#39;</span><span class="p">)</span>
<span class="go">-5.72, -5.71</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.find_target">
<code class="sig-prename descclassname">spectractor.extractor.images.</code><code class="sig-name descname">find_target</code><span class="sig-paren">(</span><em class="sig-param">image</em>, <em class="sig-param">guess</em>, <em class="sig-param">rotated=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#find_target"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.find_target" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the target in the Image instance.</p>
<p>The object is search in a windows of size defined by the XWINDOW and YWINDOW parameters,
using two iterative fits of a PSF2D model.
User must give a guess array in the raw image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance.</p></li>
<li><p><strong>guess</strong> (<em>array_like</em>) – Two parameter array giving the estimated position of the target in the image.</p></li>
<li><p><strong>rotated</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True, the target is searched in the rotated image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>x0</strong> (<em>float</em>) – The x position of the target.</p></li>
<li><p><strong>y0</strong> (<em>float</em>) – The y position of the target.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.find_target_1Dprofile">
<code class="sig-prename descclassname">spectractor.extractor.images.</code><code class="sig-name descname">find_target_1Dprofile</code><span class="sig-paren">(</span><em class="sig-param">image</em>, <em class="sig-param">sub_image</em>, <em class="sig-param">guess</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#find_target_1Dprofile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.find_target_1Dprofile" title="Permalink to this definition">¶</a></dt>
<dd><p>Find precisely the position of the targeted object fitting a PSF1D model
on each projection of the image along x and y, using outlier removal.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance.</p></li>
<li><p><strong>sub_image</strong> (<em>array_like</em>) – The cropped image data array where the fit is performed.</p></li>
<li><p><strong>guess</strong> (<em>array_like</em>) – Two parameter array giving the estimated position of the target in the image.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">820</span><span class="p">,</span> <span class="mi">580</span><span class="p">]</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-2.py">Source code</a>)</p>
<div class="figure align-default">
<img alt="../_images/spectractor-extractor-2.png" src="../_images/spectractor-extractor-2.png" />
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sub_image</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">Dx</span><span class="p">,</span> <span class="n">Dy</span><span class="p">,</span> <span class="n">sub_errors</span> <span class="o">=</span> <span class="n">find_target_init</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">guess</span><span class="p">,</span> <span class="n">rotated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">find_target_1Dprofile</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">sub_image</span><span class="p">,</span> <span class="n">guess</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.find_target_2Dprofile">
<code class="sig-prename descclassname">spectractor.extractor.images.</code><code class="sig-name descname">find_target_2Dprofile</code><span class="sig-paren">(</span><em class="sig-param">image</em>, <em class="sig-param">sub_image</em>, <em class="sig-param">guess</em>, <em class="sig-param">sub_errors=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#find_target_2Dprofile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.find_target_2Dprofile" title="Permalink to this definition">¶</a></dt>
<dd><p>Find precisely the position of the targeted object fitting a PSF2D model.
A polynomial 2D background is subtracted first. Saturated pixels are masked with np.nan values.</p>
<p>THE ERROR ARRAY IS NOT USED FOR THE MOMENT.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance.</p></li>
<li><p><strong>sub_image</strong> (<em>array_like</em>) – The cropped image data array where the fit is performed.</p></li>
<li><p><strong>guess</strong> (<em>array_like</em>) – Two parameter array giving the estimated position of the target in the image.</p></li>
<li><p><strong>sub_errors</strong> (<em>array_like</em>) – The image data uncertainties.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">820</span><span class="p">,</span> <span class="mi">580</span><span class="p">]</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-3.py">Source code</a>)</p>
<div class="figure align-default">
<img alt="../_images/spectractor-extractor-3.png" src="../_images/spectractor-extractor-3.png" />
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sub_image</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">Dx</span><span class="p">,</span> <span class="n">Dy</span><span class="p">,</span> <span class="n">sub_errors</span> <span class="o">=</span> <span class="n">find_target_init</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">guess</span><span class="p">,</span> <span class="n">rotated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sub_image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sub_image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">find_target_2Dprofile</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">sub_image</span><span class="p">,</span> <span class="n">guess</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.find_target_init">
<code class="sig-prename descclassname">spectractor.extractor.images.</code><code class="sig-name descname">find_target_init</code><span class="sig-paren">(</span><em class="sig-param">image, guess, rotated=False, widths=[100, 100]</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#find_target_init"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.find_target_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the search of the target cropping the image and setting the saturation level.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance.</p></li>
<li><p><strong>guess</strong> (<em>array_like</em>) – Two parameter array giving the estimated position of the target in the image.</p></li>
<li><p><strong>rotated</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True, the target is searched in the rotated image.</p></li>
<li><p><strong>widths</strong> (<em>array_like</em>) – Two parameter array to define the width of the cropped image (default: [parameters.XWINDOW, parameters.YWINDOW])</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>sub_image</strong> (<em>array_like</em>) – The cropped image data array where the fit has to be performed.</p></li>
<li><p><strong>x0</strong> (<em>float</em>) – The x position of the target.</p></li>
<li><p><strong>y0</strong> (<em>float</em>) – The y position of the target.</p></li>
<li><p><strong>Dx</strong> (<em>int</em>) – The width of the cropped image.</p></li>
<li><p><strong>Dy</strong> (<em>int</em>) – The height of the cropped image.</p></li>
<li><p><strong>sub_errors</strong> (<em>array_like</em>) – The cropped image uncertainty array where the fit has to be performed.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.load_CTIO_image">
<code class="sig-prename descclassname">spectractor.extractor.images.</code><code class="sig-name descname">load_CTIO_image</code><span class="sig-paren">(</span><em class="sig-param">image</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#load_CTIO_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.load_CTIO_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Specific routine to load CTIO fits files and load their data and properties for Spectractor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance to fill with file data and header.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.load_LPNHE_image">
<code class="sig-prename descclassname">spectractor.extractor.images.</code><code class="sig-name descname">load_LPNHE_image</code><span class="sig-paren">(</span><em class="sig-param">image</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#load_LPNHE_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.load_LPNHE_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Specific routine to load LPNHE fits files and load their data and properties for Spectractor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance to fill with file data and header.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.images.turn_image">
<code class="sig-prename descclassname">spectractor.extractor.images.</code><code class="sig-name descname">turn_image</code><span class="sig-paren">(</span><em class="sig-param">image</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/images.html#turn_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.images.turn_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the rotation angle using the Hessian algorithm and turn the image.</p>
<p>The results are stored in Image.data_rotated and Image.stat_errors_rotated.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – The Image instance.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Create of False spectrogram:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">=</span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028.fits&#39;</span><span class="p">,</span> <span class="n">disperser_label</span><span class="o">=</span><span class="s1">&#39;HoloPhAg&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">CCD_IMSIZE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">slope</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">slope</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">N</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">... </span>    <span class="n">im</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-4.py">Source code</a>)</p>
<div class="figure align-default">
<img alt="../_images/spectractor-extractor-4.png" src="../_images/spectractor-extractor-4.png" />
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span><span class="o">.</span><span class="n">target_pixcoords</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">turn_image</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-5.py">Source code</a>)</p>
<div class="figure align-default">
<img alt="../_images/spectractor-extractor-5.png" src="../_images/spectractor-extractor-5.png" />
</div>
</dd></dl>

</div>
<div class="section" id="module-spectractor.extractor.psf">
<span id="spectractor-extractor-psf-module"></span><h2>spectractor.extractor.psf module<a class="headerlink" href="#module-spectractor.extractor.psf" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="spectractor.extractor.psf.ChromaticPSF">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">ChromaticPSF</code><span class="sig-paren">(</span><em class="sig-param">psf</em>, <em class="sig-param">Nx</em>, <em class="sig-param">Ny</em>, <em class="sig-param">deg=4</em>, <em class="sig-param">saturation=None</em>, <em class="sig-param">file_name=''</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.check_bounds">
<code class="sig-name descname">check_bounds</code><span class="sig-paren">(</span><em class="sig-param">poly_params</em>, <em class="sig-param">noise_level=0</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.check_bounds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.check_bounds" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate the PSF profile parameters from the polynomial coefficients and check if they are within priors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>poly_params</strong> (<em>array_like</em>) – <dl>
<dt>Parameter array of the model, in the form:</dt><dd><ul>
<li><p>Nx first parameters are amplitudes for the Moffat transverse profiles</p></li>
<li><p>next parameters are polynomial coefficients for all the PSF parameters</p></li>
</ul>
<p>in the same order as in PSF definition, except amplitude_moffat</p>
</dd>
</dl>
</p></li>
<li><p><strong>noise_level</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) – Noise level to set minimal boundary for amplitudes (negatively).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>in_bounds</strong> – Return True if all parameters respect the model parameter priors.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)">bool</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.evaluate">
<code class="sig-name descname">evaluate</code><span class="sig-paren">(</span><em class="sig-param">poly_params</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.evaluate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.evaluate" title="Permalink to this definition">¶</a></dt>
<dd><p>Dummy function to simulate a 2D spectrogram of size Nx times Ny.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>poly_params</strong> (<em>array_like</em>) – <dl>
<dt>Parameter array of the model, in the form:</dt><dd><ul class="simple">
<li><p>Nx first parameters are amplitudes for the Moffat transverse profiles</p></li>
<li><p>next parameters are polynomial coefficients for all the PSF parameters</p></li>
</ul>
<p>in the same order as in PSF definition, except amplitude_moffat</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>output</strong> – A 2D array with the model</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>array</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">poly_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">poly_params</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">&lt;matplotlib.colorbar.Colorbar object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.fill_table_with_profile_params">
<code class="sig-name descname">fill_table_with_profile_params</code><span class="sig-paren">(</span><em class="sig-param">profile_params</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.fill_table_with_profile_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.fill_table_with_profile_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Fill the table with the profile parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>profile_params</strong> (<em>array</em>) – a Nx * len(self.PSF.param_names) numpy array containing the PSF parameters as a function of pixels.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">poly_params_test</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">profile_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">from_poly_params_to_profile_params</span><span class="p">(</span><span class="n">poly_params_test</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fill_table_with_profile_params</span><span class="p">(</span><span class="n">profile_params</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.fit_chromatic_psf">
<code class="sig-name descname">fit_chromatic_psf</code><span class="sig-paren">(</span><em class="sig-param">w</em>, <em class="sig-param">data</em>, <em class="sig-param">bgd_model_func=None</em>, <em class="sig-param">data_errors=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.fit_chromatic_psf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.fit_chromatic_psf" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit a chromatic PSF model on 2D data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>w</strong> (<em>ChromaticPSFFitWorkspaceFitWorkspace</em>) – The FitWorkspace.</p></li>
<li><p><strong>data</strong> (<em>array_like</em>) – 2D array containing the image data.</p></li>
<li><p><strong>bgd_model_func</strong> (<em>callable</em><em>, </em><em>optional</em>) – A 2D function to model the extracted background (default: None -&gt; null background)</p></li>
<li><p><strong>data_errors</strong> (<em>np.array</em>) – the 2D array uncertainties.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Set the parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXDIST_BACKGROUND</span> <span class="o">=</span> <span class="mi">40</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXWIDTH_BACKGROUND</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXWIDTH_SIGNAL</span> <span class="o">=</span> <span class="mi">30</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">VERBOSE</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Build a mock spectrogram with random Poisson noise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span><span class="o">.</span><span class="n">poly_params</span> <span class="o">=</span> <span class="n">params</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">saturation</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bgd</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">+=</span> <span class="n">bgd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Extract the background:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bgd_model_func</span> <span class="o">=</span> <span class="n">extract_background_photutils</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
<p>Estimate the first guess values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fit_transverse_PSF1D_profile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span>
<span class="gp">... </span><span class="n">pixel_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">,</span> <span class="n">live_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_summary</span><span class="p">(</span><span class="n">truth</span><span class="o">=</span><span class="n">s0</span><span class="p">)</span>
</pre></div>
</div>
<p>Fit the data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">ChromaticPSF1DFitWorkspace</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fit_chromatic_psf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">data_errors</span><span class="o">=</span><span class="n">data_errors</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_summary</span><span class="p">(</span><span class="n">truth</span><span class="o">=</span><span class="n">s0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.fit_transverse_PSF1D_profile">
<code class="sig-name descname">fit_transverse_PSF1D_profile</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">err</em>, <em class="sig-param">w</em>, <em class="sig-param">ws</em>, <em class="sig-param">pixel_step=1</em>, <em class="sig-param">bgd_model_func=None</em>, <em class="sig-param">saturation=None</em>, <em class="sig-param">live_fit=False</em>, <em class="sig-param">sigma=5</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.fit_transverse_PSF1D_profile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.fit_transverse_PSF1D_profile" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the transverse profile of a 2D data image with a PSF profile.
Loop is done on the x-axis direction.
An order 1 polynomial function is fitted to subtract the background for each pixel
with a 3*sigma outlier removal procedure to remove background stars.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>array</em>) – The 2D array image. The transverse profile is fitted on the y direction
for all pixels along the x direction.</p></li>
<li><p><strong>err</strong> (<em>array</em>) – The uncertainties related to the data array.</p></li>
<li><p><strong>w</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Half width of central region where the spectrum is extracted and summed (default: 10)</p></li>
<li><p><strong>ws</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a>) – up/down region extension where the sky background is estimated with format [int, int] (default: [20,30])</p></li>
<li><p><strong>pixel_step</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a><em>, </em><em>optional</em>) – The step in pixels between the slices to be fitted (default: 1).
The values for the skipped pixels are interpolated with splines from the fitted parameters.</p></li>
<li><p><strong>bgd_model_func</strong> (<em>callable</em><em>, </em><em>optional</em>) – A 2D function to model the extracted background (default: None -&gt; null background)</p></li>
<li><p><strong>saturation</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) – The saturation level of the image. Default is set to twice the maximum of the data array and has no effect.</p></li>
<li><p><strong>live_fit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>, </em><em>optional</em>) – If True, the transverse profile fit is plotted in live accross the loop (default: False).</p></li>
<li><p><strong>sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Sigma for outlier rejection (default: 5).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Build a mock spectrogram with random Poisson noise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">saturation</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bgd</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">s0</span><span class="o">.</span><span class="n">Nx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">s0</span><span class="o">.</span><span class="n">Ny</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bgd</span> <span class="o">+=</span> <span class="mi">1000</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">xx</span><span class="o">-</span><span class="mi">20</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">yy</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">+=</span> <span class="n">bgd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Extract the background:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bgd_model_func</span> <span class="o">=</span> <span class="n">extract_background_photutils</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
<p>Fit the transverse profile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fit_transverse_PSF1D_profile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span> <span class="n">pixel_step</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span><span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">,</span> <span class="n">live_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_summary</span><span class="p">(</span><span class="n">truth</span><span class="o">=</span><span class="n">s0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.from_poly_params_to_profile_params">
<code class="sig-name descname">from_poly_params_to_profile_params</code><span class="sig-paren">(</span><em class="sig-param">poly_params</em>, <em class="sig-param">force_positive=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.from_poly_params_to_profile_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.from_poly_params_to_profile_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate the PSF profile parameters from the polynomial coefficients. If poly_params length is smaller
than self.Nx, it is assumed that the amplitude_moffat parameters are not included and set to arbitrarily to 1.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>poly_params</strong> (<em>array_like</em>) – <dl>
<dt>Parameter array of the model, in the form:</dt><dd><ul>
<li><p>Nx first parameters are amplitudes for the Moffat transverse profiles</p></li>
<li><p>next parameters are polynomial coefficients for all the PSF parameters</p></li>
</ul>
<p>in the same order as in PSF definition, except amplitude_moffat</p>
</dd>
</dl>
</p></li>
<li><p><strong>force_positive</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>, </em><em>optional</em>) – Force some profile parameters to be positive despite the polynomial coefficients (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>profile_params</strong> – Nx * len(self.PSF.param_names) numpy array containing the PSF parameters as a function of pixels.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>array</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Build a mock spectrogram with random Poisson noise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">poly_params_test</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">poly_params_test</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>From the polynomial parameters to the profile parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">profile_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">from_poly_params_to_profile_params</span><span class="p">(</span><span class="n">poly_params_test</span><span class="p">)</span>
</pre></div>
</div>
<p>From the profile parameters to the polynomial parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">profile_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">from_profile_params_to_poly_params</span><span class="p">(</span><span class="n">profile_params</span><span class="p">)</span>
</pre></div>
</div>
<p>From the polynomial parameters to the profile parameters without Moffat amplitudes:
&gt;&gt;&gt; profile_params = s.from_poly_params_to_profile_params(poly_params_test[100:])</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">profile_params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">8e3</span><span class="p">])))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.from_profile_params_to_poly_params">
<code class="sig-name descname">from_profile_params_to_poly_params</code><span class="sig-paren">(</span><em class="sig-param">profile_params</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.from_profile_params_to_poly_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.from_profile_params_to_poly_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform the profile_params array from fit_transverse_PSF1D into a set of parameters
for the chromatic PSF parameterisation.
Fit polynomial functions across the pixels for each PSF
parameters. The order of the function is given by self.degrees.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>profile_params</strong> (<em>array</em>) – a Nx * len(self.PSF.param_names) numpy array containing the PSF parameters as a function of pixels.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>profile_params</strong> – A set of parameters that can be evaluated by the chromatic PSF class evaluate function.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>array_like</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Build a mock spectrogram with random Poisson noise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">poly_params_test</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">poly_params_test</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>From the polynomial parameters to the profile parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">profile_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">from_poly_params_to_profile_params</span><span class="p">(</span><span class="n">poly_params_test</span><span class="p">)</span>
</pre></div>
</div>
<p>From the profile parameters to the polynomial parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">profile_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">from_profile_params_to_poly_params</span><span class="p">(</span><span class="n">profile_params</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.from_profile_params_to_shape_params">
<code class="sig-name descname">from_profile_params_to_shape_params</code><span class="sig-paren">(</span><em class="sig-param">profile_params</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.from_profile_params_to_shape_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.from_profile_params_to_shape_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the PSF integrals and FWHMS given the profile_params array and fill the table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>profile_params</strong> (<em>array</em>) – a Nx * len(self.PSF.param_names) numpy array containing the PSF parameters as a function of pixels.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">poly_params_test</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">profile_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">from_poly_params_to_profile_params</span><span class="p">(</span><span class="n">poly_params_test</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">from_profile_params_to_shape_params</span><span class="p">(</span><span class="n">profile_params</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.from_table_to_poly_params">
<code class="sig-name descname">from_table_to_poly_params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.from_table_to_poly_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.from_table_to_poly_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the polynomial parameters from self.table and fill an array with polynomial parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>poly_params</strong> – A set of polynomial parameters that can be evaluated by the chromatic PSF class evaluate function.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>array_like</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spectractor.extractor.spectrum</span> <span class="k">import</span> <span class="n">Spectrum</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;./tests/data/reduc_20170530_134_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">poly_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">chromatic_psf</span><span class="o">.</span><span class="n">from_table_to_poly_params</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.from_table_to_profile_params">
<code class="sig-name descname">from_table_to_profile_params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.from_table_to_profile_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.from_table_to_profile_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the profile parameters from self.table and fill an array of profile parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>profile_params</strong> – Nx * len(self.PSF.param_names) numpy array containing the PSF parameters as a function of pixels.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>array</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spectractor.extractor.spectrum</span> <span class="k">import</span> <span class="n">Spectrum</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;./tests/data/reduc_20170530_134_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">profile_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">chromatic_psf</span><span class="o">.</span><span class="n">from_table_to_profile_params</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.get_distance_along_dispersion_axis">
<code class="sig-name descname">get_distance_along_dispersion_axis</code><span class="sig-paren">(</span><em class="sig-param">shift_x=0</em>, <em class="sig-param">shift_y=0</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.get_distance_along_dispersion_axis"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.get_distance_along_dispersion_axis" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.plot_chromatic_PSF1D_residuals">
<code class="sig-name descname">plot_chromatic_PSF1D_residuals</code><span class="sig-paren">(</span><em class="sig-param">bgd</em>, <em class="sig-param">data</em>, <em class="sig-param">data_errors</em>, <em class="sig-param">guess=None</em>, <em class="sig-param">live_fit=False</em>, <em class="sig-param">title=''</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.plot_chromatic_PSF1D_residuals"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.plot_chromatic_PSF1D_residuals" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the residuals after fit_chromatic_PSF1D function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bgd</strong> (<em>array_like</em>) – The 2D background array.</p></li>
<li><p><strong>data</strong> (<em>array_like</em>) – The 2D data array.</p></li>
<li><p><strong>data_errors</strong> (<em>array_like</em>) – The 2D data uncertainty array.</p></li>
<li><p><strong>guess</strong> (<em>array_like</em><em>, </em><em>optional</em>) – The guessed profile before the fit (default: None).</p></li>
<li><p><strong>live_fit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True, the plot is shown during the fitting procedure (default: False).</p></li>
<li><p><strong>title</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em>, </em><em>optional</em>) – Title of the plot (default: “”).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.plot_summary">
<code class="sig-name descname">plot_summary</code><span class="sig-paren">(</span><em class="sig-param">truth=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.plot_summary"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.plot_summary" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.rotate_table">
<code class="sig-name descname">rotate_table</code><span class="sig-paren">(</span><em class="sig-param">angle_degree</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.rotate_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.rotate_table" title="Permalink to this definition">¶</a></dt>
<dd><p>In self.table, rotate the columns Dx, Dy, Dy_fwhm_inf and Dy_fwhm_sup by an angle
given in degree. The results overwrite the previous columns in self.table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>angle_degree</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Rotation angle in degree</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Dx_rot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">rotate_table</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.set_bounds">
<code class="sig-name descname">set_bounds</code><span class="sig-paren">(</span><em class="sig-param">data=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.set_bounds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.set_bounds" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns an array of bounds for iminuit. It is very touchy, change the values with caution !</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data</strong> (<em>array_like</em><em>, </em><em>optional</em>) – The data array, to set the bounds for the amplitude using its maximum.
If None is provided, no bounds are provided for the amplitude parameters.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>bounds</strong> – 2D array containing the pair of bounds for each polynomial parameters.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>array_like</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF.set_polynomial_degrees">
<code class="sig-name descname">set_polynomial_degrees</code><span class="sig-paren">(</span><em class="sig-param">deg</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF.set_polynomial_degrees"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF.set_polynomial_degrees" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.ChromaticPSF1D">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">ChromaticPSF1D</code><span class="sig-paren">(</span><em class="sig-param">Nx</em>, <em class="sig-param">Ny</em>, <em class="sig-param">deg=4</em>, <em class="sig-param">saturation=None</em>, <em class="sig-param">file_name=''</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.psf.ChromaticPSF" title="spectractor.extractor.psf.ChromaticPSF"><code class="xref py py-class docutils literal notranslate"><span class="pre">spectractor.extractor.psf.ChromaticPSF</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.evaluate">
<code class="sig-name descname">evaluate</code><span class="sig-paren">(</span><em class="sig-param">poly_params</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.evaluate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.evaluate" title="Permalink to this definition">¶</a></dt>
<dd><p>Simulate a 2D spectrogram of size Nx times Ny with transverse 1D PSF profiles.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>poly_params</strong> (<em>array_like</em>) – <dl>
<dt>Parameter array of the model, in the form:</dt><dd><ul class="simple">
<li><p>Nx first parameters are amplitudes for the Moffat transverse profiles</p></li>
<li><p>next parameters are polynomial coefficients for all the PSF parameters</p></li>
</ul>
<p>in the same order as in PSF definition, except amplitude_moffat</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>output</strong> – A 2D array with the model</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>array</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">poly_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">poly_params</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">&lt;matplotlib.colorbar.Colorbar object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.fit_chromatic_PSF1D">
<code class="sig-name descname">fit_chromatic_PSF1D</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">bgd_model_func=None</em>, <em class="sig-param">data_errors=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.fit_chromatic_PSF1D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.fit_chromatic_PSF1D" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit a chromatic PSF model on 2D data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>array_like</em>) – 2D array containing the image data.</p></li>
<li><p><strong>bgd_model_func</strong> (<em>callable</em><em>, </em><em>optional</em>) – A 2D function to model the extracted background (default: None -&gt; null background)</p></li>
<li><p><strong>data_errors</strong> (<em>np.array</em>) – the 2D array uncertainties.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Set the parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXDIST_BACKGROUND</span> <span class="o">=</span> <span class="mi">40</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXWIDTH_BACKGROUND</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXWIDTH_SIGNAL</span> <span class="o">=</span> <span class="mi">30</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">VERBOSE</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Build a mock spectrogram with random Poisson noise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span><span class="o">.</span><span class="n">poly_params</span> <span class="o">=</span> <span class="n">params</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">saturation</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bgd</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">+=</span> <span class="n">bgd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Extract the background:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bgd_model_func</span> <span class="o">=</span> <span class="n">extract_background_photutils</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
<p>Estimate the first guess values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fit_transverse_PSF1D_profile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span>
<span class="gp">... </span><span class="n">pixel_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">,</span> <span class="n">live_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_summary</span><span class="p">(</span><span class="n">truth</span><span class="o">=</span><span class="n">s0</span><span class="p">)</span>
</pre></div>
</div>
<p>Fit the data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fit_chromatic_PSF1D</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">data_errors</span><span class="o">=</span><span class="n">data_errors</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_summary</span><span class="p">(</span><span class="n">truth</span><span class="o">=</span><span class="n">s0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.fit_chromatic_PSF1D_minuit">
<code class="sig-name descname">fit_chromatic_PSF1D_minuit</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">bgd_model_func=None</em>, <em class="sig-param">data_errors=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.fit_chromatic_PSF1D_minuit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.fit_chromatic_PSF1D_minuit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit a chromatic PSF model on 2D data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>array_like</em>) – 2D array containing the image data.</p></li>
<li><p><strong>bgd_model_func</strong> (<em>callable</em><em>, </em><em>optional</em>) – A 2D function to model the extracted background (default: None -&gt; null background)</p></li>
<li><p><strong>data_errors</strong> (<em>np.array</em>) – the 2D array uncertainties.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Set the parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXDIST_BACKGROUND</span> <span class="o">=</span> <span class="mi">40</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXWIDTH_BACKGROUND</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXWIDTH_SIGNAL</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>
</div>
<p>Build a mock spectrogram with random Poisson noise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span><span class="o">.</span><span class="n">poly_params</span> <span class="o">=</span> <span class="n">params</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">saturation</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bgd</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">+=</span> <span class="n">bgd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Extract the background:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bgd_model_func</span> <span class="o">=</span> <span class="n">extract_background_photutils</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
<p>Estimate the first guess values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fit_transverse_PSF1D_profile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span>
<span class="gp">... </span><span class="n">pixel_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">,</span> <span class="n">live_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_summary</span><span class="p">(</span><span class="n">truth</span><span class="o">=</span><span class="n">s0</span><span class="p">)</span>
</pre></div>
</div>
<p>Fit the data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fit_chromatic_PSF1D_minuit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">data_errors</span><span class="o">=</span><span class="n">data_errors</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_summary</span><span class="p">(</span><span class="n">truth</span><span class="o">=</span><span class="n">s0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1D.generate_test_poly_params">
<code class="sig-name descname">generate_test_poly_params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1D.generate_test_poly_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1D.generate_test_poly_params" title="Permalink to this definition">¶</a></dt>
<dd><p>A set of parameters to define a test spectrogram</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>profile_params</strong> – The list of the test parameters</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>array</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.ChromaticPSF1DFitWorkspace">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">ChromaticPSF1DFitWorkspace</code><span class="sig-paren">(</span><em class="sig-param">chromatic_psf</em>, <em class="sig-param">data</em>, <em class="sig-param">data_errors</em>, <em class="sig-param">bgd_model_func=None</em>, <em class="sig-param">file_name=''</em>, <em class="sig-param">nwalkers=18</em>, <em class="sig-param">nsteps=1000</em>, <em class="sig-param">burnin=100</em>, <em class="sig-param">nbins=10</em>, <em class="sig-param">verbose=0</em>, <em class="sig-param">plot=False</em>, <em class="sig-param">live_fit=False</em>, <em class="sig-param">truth=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1DFitWorkspace"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1DFitWorkspace" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.psf.ChromaticPSFFitWorkspace" title="spectractor.extractor.psf.ChromaticPSFFitWorkspace"><code class="xref py py-class docutils literal notranslate"><span class="pre">spectractor.extractor.psf.ChromaticPSFFitWorkspace</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF1DFitWorkspace.simulate">
<code class="sig-name descname">simulate</code><span class="sig-paren">(</span><em class="sig-param">*shape_params</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF1DFitWorkspace.simulate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF1DFitWorkspace.simulate" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute a ChromaticPSF model given PSF shape parameters and minimizing
amplitude parameters given a spectrogram data array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>shape_params</strong> (<em>array_like</em>) – PSF shape polynomial parameter array.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Set the parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXDIST_BACKGROUND</span> <span class="o">=</span> <span class="mi">40</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXWIDTH_BACKGROUND</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXWIDTH_SIGNAL</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>
</div>
<p>Build a mock spectrogram with random Poisson noise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span><span class="o">.</span><span class="n">poly_params</span> <span class="o">=</span> <span class="n">params</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">saturation</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bgd</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">+=</span> <span class="n">bgd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Extract the background:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bgd_model_func</span> <span class="o">=</span> <span class="n">extract_background_photutils</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
<p>Estimate the first guess values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fit_transverse_PSF1D_profile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span>
<span class="gp">... </span><span class="n">pixel_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">,</span> <span class="n">live_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Simulate the data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">ChromaticPSF1DFitWorkspace</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="n">mod_err</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">poly_params</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">Nx</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="o">.</span><span class="n">plot_fit</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.ChromaticPSF2D">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">ChromaticPSF2D</code><span class="sig-paren">(</span><em class="sig-param">Nx</em>, <em class="sig-param">Ny</em>, <em class="sig-param">deg=4</em>, <em class="sig-param">saturation=None</em>, <em class="sig-param">file_name=''</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF2D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF2D" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.psf.ChromaticPSF" title="spectractor.extractor.psf.ChromaticPSF"><code class="xref py py-class docutils literal notranslate"><span class="pre">spectractor.extractor.psf.ChromaticPSF</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF2D.evaluate">
<code class="sig-name descname">evaluate</code><span class="sig-paren">(</span><em class="sig-param">poly_params</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF2D.evaluate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF2D.evaluate" title="Permalink to this definition">¶</a></dt>
<dd><p>Simulate a 2D spectrogram of size Nx times Ny.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>poly_params</strong> (<em>array_like</em>) – <dl>
<dt>Parameter array of the model, in the form:</dt><dd><ul class="simple">
<li><p>Nx first parameters are amplitudes for the Moffat transverse profiles</p></li>
<li><p>next parameters are polynomial coefficients for all the PSF parameters</p></li>
</ul>
<p>in the same order as in PSF definition, except amplitude_moffat</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>output</strong> – A 2D array with the model</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>array</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF2D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">20000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">poly_params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">poly_params</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">&lt;matplotlib.colorbar.Colorbar object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF2D.fit_chromatic_PSF2D">
<code class="sig-name descname">fit_chromatic_PSF2D</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">bgd_model_func=None</em>, <em class="sig-param">data_errors=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF2D.fit_chromatic_PSF2D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF2D.fit_chromatic_PSF2D" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit a chromatic PSF model on 2D data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>array_like</em>) – 2D array containing the image data.</p></li>
<li><p><strong>bgd_model_func</strong> (<em>callable</em><em>, </em><em>optional</em>) – A 2D function to model the extracted background (default: None -&gt; null background)</p></li>
<li><p><strong>data_errors</strong> (<em>np.array</em>) – the 2D array uncertainties.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Set the parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXDIST_BACKGROUND</span> <span class="o">=</span> <span class="mi">40</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXWIDTH_BACKGROUND</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXWIDTH_SIGNAL</span> <span class="o">=</span> <span class="mi">30</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">VERBOSE</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Build a mock spectrogram with random Poisson noise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span> <span class="o">=</span> <span class="n">ChromaticPSF2D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span><span class="o">.</span><span class="n">poly_params</span> <span class="o">=</span> <span class="n">params</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">saturation</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bgd</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">+=</span> <span class="n">bgd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Extract the background:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bgd_model_func</span> <span class="o">=</span> <span class="n">extract_background_photutils</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
<p>Estimate the first guess values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF2D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fit_transverse_PSF1D_profile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span>
<span class="gp">... </span><span class="n">pixel_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">,</span> <span class="n">live_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_summary</span><span class="p">(</span><span class="n">truth</span><span class="o">=</span><span class="n">s0</span><span class="p">)</span>
</pre></div>
</div>
<p>Fit the data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fit_chromatic_PSF2D</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">data_errors</span><span class="o">=</span><span class="n">data_errors</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_summary</span><span class="p">(</span><span class="n">truth</span><span class="o">=</span><span class="n">s0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF2D.fit_chromatic_PSF2D_minuit">
<code class="sig-name descname">fit_chromatic_PSF2D_minuit</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">bgd_model_func=None</em>, <em class="sig-param">data_errors=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF2D.fit_chromatic_PSF2D_minuit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF2D.fit_chromatic_PSF2D_minuit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit a chromatic PSF2D model on 2D data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>array_like</em>) – 2D array containing the image data.</p></li>
<li><p><strong>bgd_model_func</strong> (<em>callable</em><em>, </em><em>optional</em>) – A 2D function to model the extracted background (default: None -&gt; null background)</p></li>
<li><p><strong>data_errors</strong> (<em>np.array</em>) – the 2D array uncertainties.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Set the parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXDIST_BACKGROUND</span> <span class="o">=</span> <span class="mi">40</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXWIDTH_BACKGROUND</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXWIDTH_SIGNAL</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>
</div>
<p>Build a mock spectrogram with random Poisson noise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span> <span class="o">=</span> <span class="n">ChromaticPSF2D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">20000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span><span class="o">.</span><span class="n">poly_params</span> <span class="o">=</span> <span class="n">params</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">saturation</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bgd</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">+=</span> <span class="n">bgd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p># Extract the background
# &gt;&gt;&gt; bgd_model_func = extract_background_photutils(data, data_errors, ws=[30,50])
#
# # Estimate the first guess values
# &gt;&gt;&gt; s = ChromaticPSF2D(Nx=100, Ny=100, deg=4, saturation=saturation)
# &gt;&gt;&gt; s.fit_transverse_PSF1D_profile(data, data_errors, w=20, ws=[30,50],
# … pixel_step=1, bgd_model_func=bgd_model_func, saturation=saturation, live_fit=False)
#
# # Fit the data:
# &gt;&gt;&gt; parameters.DEBUG = True
# &gt;&gt;&gt; s.fit_chromatic_PSF2D_minuit(data, bgd_model_func=bgd_model_func, data_errors=data_errors)
# &gt;&gt;&gt; s.plot_summary(truth=s0)</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF2D.generate_test_poly_params">
<code class="sig-name descname">generate_test_poly_params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF2D.generate_test_poly_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF2D.generate_test_poly_params" title="Permalink to this definition">¶</a></dt>
<dd><p>A set of parameters to define a test spectrogram</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>profile_params</strong> – The list of the test parameters</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>array</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF2D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">20000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.ChromaticPSF2DFitWorkspace">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">ChromaticPSF2DFitWorkspace</code><span class="sig-paren">(</span><em class="sig-param">chromatic_psf</em>, <em class="sig-param">data</em>, <em class="sig-param">data_errors</em>, <em class="sig-param">bgd_model_func=None</em>, <em class="sig-param">file_name=''</em>, <em class="sig-param">nwalkers=18</em>, <em class="sig-param">nsteps=1000</em>, <em class="sig-param">burnin=100</em>, <em class="sig-param">nbins=10</em>, <em class="sig-param">verbose=0</em>, <em class="sig-param">plot=False</em>, <em class="sig-param">live_fit=False</em>, <em class="sig-param">truth=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF2DFitWorkspace"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF2DFitWorkspace" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.psf.ChromaticPSFFitWorkspace" title="spectractor.extractor.psf.ChromaticPSFFitWorkspace"><code class="xref py py-class docutils literal notranslate"><span class="pre">spectractor.extractor.psf.ChromaticPSFFitWorkspace</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSF2DFitWorkspace.simulate">
<code class="sig-name descname">simulate</code><span class="sig-paren">(</span><em class="sig-param">*shape_params</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSF2DFitWorkspace.simulate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSF2DFitWorkspace.simulate" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute a ChromaticPSF2D model given PSF shape parameters and minimizing
amplitude parameters using a spectrogram data array.</p>
<p>The ChromaticPSF2D model <span class="math notranslate nohighlight">\(\vec{m}(\vec{x},\vec{p})\)</span> can be written as</p>
<div class="math notranslate nohighlight" id="equation-chromaticpsf2d">
<span class="eqno">(1)<a class="headerlink" href="#equation-chromaticpsf2d" title="Permalink to this equation">¶</a></span>\[\vec{m}(\vec{x},\vec{p}) = \sum_{i=0}^{N_x} A_i \phi\left(\vec{x},\vec{p}_i\right)\]</div>
<p>with <span class="math notranslate nohighlight">\(\vec{x}\)</span> the 2D array  of the pixel coordinates, <span class="math notranslate nohighlight">\(\vec{A}\)</span> the amplitude parameter array
along the x axis of the spectrogram, <span class="math notranslate nohighlight">\(\phi\left(\vec{x},\vec{p}_i\right)\)</span> the 2D PSF kernel whose integral
is normalised to one parametrized with the <span class="math notranslate nohighlight">\(\vec{p}_i\)</span> non-linear parameter array. If the <span class="math notranslate nohighlight">\(\vec{x}\)</span> 2D array is flatten in 1D, equation <a class="reference internal" href="#equation-chromaticpsf2d">(1)</a> is</p>
<div class="math notranslate nohighlight" id="equation-chromaticpsf2d-matrix">
\begin{align}
\vec{m}(\vec{x},\vec{p}) &amp; = \mathbf{M}\left(\vec{x},\vec{p}\right) \mathbf{A} \\

\mathbf{M}\left(\vec{x},\vec{p}\right) &amp; = \left(\begin{array}{cccc}
 \phi\left(\vec{x}_1,\vec{p}_1\right) &amp; \phi\left(\vec{x}_2,\vec{p}_1\right) &amp; ... &amp; \phi\left(\vec{x}_{N_x},\vec{p}_1\right) \\
 ... &amp; ... &amp; ... &amp; ...\\
 \phi\left(\vec{x}_1,\vec{p}_{N_x}\right) &amp; \phi\left(\vec{x}_2,\vec{p}_{N_x}\right) &amp; ... &amp; \phi\left(\vec{x}_{N_x},\vec{p}_{N_x}\right) \\
\end{array}\right)
\end{align}</div><p>with <span class="math notranslate nohighlight">\(\mathbf{M}\)</span> the design matrix.</p>
<p>The goal of this function is to perform a minimisation of the amplitude vector <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> given
a set of non-linear parameters <span class="math notranslate nohighlight">\(\mathbf{p}\)</span> and a spectrogram data array <span class="math notranslate nohighlight">\(mathbf{y}\)</span> modelise as</p>
<div class="math notranslate nohighlight">
\[\mathbf{y} = \mathbf{m}(\vec{x},\vec{p}) + \vec{\epsilon}\]</div>
<p>with <span class="math notranslate nohighlight">\(\vec{\epsilon}\)</span> a random noise vector. The <span class="math notranslate nohighlight">\(\chi^2\)</span> function to minimise is</p>
<div class="math notranslate nohighlight" id="equation-chromaticspsf2d-chi2">
<span class="eqno">(3)<a class="headerlink" href="#equation-chromaticspsf2d-chi2" title="Permalink to this equation">¶</a></span>\[\chi^2(\mathbf{A})= \left(\mathbf{y} - \mathbf{M}\left(\vec{x},\vec{p}\right) \mathbf{A} \right)^T \mathbf{W}
\left(\mathbf{y} - \mathbf{M}\left(\vec{x},\vec{p}\right) \mathbf{A} \right)\]</div>
<p>with <span class="math notranslate nohighlight">\(\mathbf{W}\)</span> the weight matrix, inverse of the covariance matrix. In our case this matrix is diagonal
as the pixels are considered all independent. The minimum of equation <a class="reference internal" href="#equation-chromaticspsf2d-chi2">(3)</a> is reached for
a the set of amplitude parameters <span class="math notranslate nohighlight">\(\hat{\mathbf{A}}\)</span> given by</p>
<div class="math notranslate nohighlight">
\[\hat{\mathbf{A}} =  (\mathbf{M}^T \mathbf{W} \mathbf{M})^{-1} \mathbf{M}^T \mathbf{W} \mathbf{y}\]</div>
<p>The error matrix on the <span class="math notranslate nohighlight">\(\hat{\mathbf{A}}\)</span> coefficient is simply
<span class="math notranslate nohighlight">\((\mathbf{M}^T \mathbf{W} \mathbf{M})^{-1}\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>shape_params</strong> (<em>array_like</em>) – PSF shape polynomial parameter array.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Set the parameters:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXDIST_BACKGROUND</span> <span class="o">=</span> <span class="mi">40</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXWIDTH_BACKGROUND</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">PIXWIDTH_SIGNAL</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>
</div>
<p>Build a mock spectrogram with random Poisson noise:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span> <span class="o">=</span> <span class="n">ChromaticPSF2D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span><span class="o">.</span><span class="n">poly_params</span> <span class="o">=</span> <span class="n">params</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">saturation</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bgd</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">+=</span> <span class="n">bgd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Extract the background:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bgd_model_func</span> <span class="o">=</span> <span class="n">extract_background_photutils</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
<p>Estimate the first guess values:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF2D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fit_transverse_PSF1D_profile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span>
<span class="gp">... </span><span class="n">pixel_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">,</span> <span class="n">live_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_summary</span><span class="p">(</span><span class="n">truth</span><span class="o">=</span><span class="n">s0</span><span class="p">)</span>
</pre></div>
</div>
<p>Simulate the data:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">ChromaticPSF2DFitWorkspace</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="n">mod_err</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">poly_params</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">Nx</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="o">.</span><span class="n">plot_fit</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.ChromaticPSFFitWorkspace">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">ChromaticPSFFitWorkspace</code><span class="sig-paren">(</span><em class="sig-param">chromatic_psf</em>, <em class="sig-param">data</em>, <em class="sig-param">data_errors</em>, <em class="sig-param">bgd_model_func=None</em>, <em class="sig-param">file_name=''</em>, <em class="sig-param">nwalkers=18</em>, <em class="sig-param">nsteps=1000</em>, <em class="sig-param">burnin=100</em>, <em class="sig-param">nbins=10</em>, <em class="sig-param">verbose=0</em>, <em class="sig-param">plot=False</em>, <em class="sig-param">live_fit=False</em>, <em class="sig-param">truth=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSFFitWorkspace"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSFFitWorkspace" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="spectractor.fit.html#spectractor.fit.fitter.FitWorkspace" title="spectractor.fit.fitter.FitWorkspace"><code class="xref py py-class docutils literal notranslate"><span class="pre">spectractor.fit.fitter.FitWorkspace</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.psf.ChromaticPSFFitWorkspace.plot_fit">
<code class="sig-name descname">plot_fit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#ChromaticPSFFitWorkspace.plot_fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.ChromaticPSFFitWorkspace.plot_fit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.PSF">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">PSF</code><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.psf.PSF.evaluate">
<code class="sig-name descname">evaluate</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">p=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF.evaluate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF.evaluate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.PSF1D">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">PSF1D</code><span class="sig-paren">(</span><em class="sig-param">p=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1D" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.psf.PSF" title="spectractor.extractor.psf.PSF"><code class="xref py py-class docutils literal notranslate"><span class="pre">spectractor.extractor.psf.PSF</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.psf.PSF1D.evaluate">
<code class="sig-name descname">evaluate</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">p=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1D.evaluate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1D.evaluate" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate the PSF1D function.</p>
<p>The function is normalized to have an integral equal to amplitude_moffat parameter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array_like</em>) – The abscisse array.</p></li>
<li><p><strong>p</strong> (<em>array_like</em>) – The parameter array. If None, the array used to instanciate the class is taken.
If given, the class instance parameter array is updated.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>output</strong> – The PSF function evaluated.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>array_like</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">PSF1D</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integral</span> <span class="o">=</span> <span class="n">compute_integral</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.PSF1DAstropy">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">PSF1DAstropy</code><span class="sig-paren">(</span><em class="sig-param">amplitude_moffat=0.5</em>, <em class="sig-param">x_mean=0</em>, <em class="sig-param">gamma=3</em>, <em class="sig-param">alpha=3</em>, <em class="sig-param">eta_gauss=1</em>, <em class="sig-param">stddev=1</em>, <em class="sig-param">saturation=1</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1DAstropy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">astropy.modeling.core.Fittable1DModel</span></code></p>
<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1DAstropy.alpha">
<code class="sig-name descname">alpha</code><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.alpha" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1DAstropy.amplitude_moffat">
<code class="sig-name descname">amplitude_moffat</code><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.amplitude_moffat" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1DAstropy.axis_names">
<code class="sig-name descname">axis_names</code><em class="property"> = ['A', 'y', '\\gamma', '\\alpha', '\\eta', '\\sigma', 'saturation']</em><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.axis_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF1DAstropy.deriv">
<em class="property">static </em><code class="sig-name descname">deriv</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">amplitude_moffat</em>, <em class="sig-param">x_mean</em>, <em class="sig-param">gamma</em>, <em class="sig-param">alpha</em>, <em class="sig-param">eta_gauss</em>, <em class="sig-param">stddev</em>, <em class="sig-param">saturation</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1DAstropy.deriv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.deriv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1DAstropy.eta_gauss">
<code class="sig-name descname">eta_gauss</code><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.eta_gauss" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF1DAstropy.evaluate">
<em class="property">static </em><code class="sig-name descname">evaluate</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">amplitude_moffat</em>, <em class="sig-param">x_mean</em>, <em class="sig-param">gamma</em>, <em class="sig-param">alpha</em>, <em class="sig-param">eta_gauss</em>, <em class="sig-param">stddev</em>, <em class="sig-param">saturation</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1DAstropy.evaluate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.evaluate" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate the model on some input variables.</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF1DAstropy.fit_deriv">
<em class="property">static </em><code class="sig-name descname">fit_deriv</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">amplitude_moffat</em>, <em class="sig-param">x_mean</em>, <em class="sig-param">gamma</em>, <em class="sig-param">alpha</em>, <em class="sig-param">eta_gauss</em>, <em class="sig-param">stddev</em>, <em class="sig-param">saturation</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1DAstropy.fit_deriv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.fit_deriv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF1DAstropy.fwhm">
<code class="sig-name descname">fwhm</code><span class="sig-paren">(</span><em class="sig-param">x_array=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1DAstropy.fwhm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.fwhm" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the full width half maximum of the PSF model with a dichotomie method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x_array</strong> (<em>array_like</em><em>, </em><em>optional</em>) – An abscisse array is one wants to find FWHM on the interpolated PSF model
(to smooth the spikes from spurious parameter sets).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>FWHM</strong> – The full width half maximum of the PSF model.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">PSF1DAstropy</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span>  <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">fwhm</span><span class="p">(</span><span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">fwhm</span><span class="p">,</span> <span class="mf">7.25390625</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">fwhm</span><span class="p">(</span><span class="n">x_array</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">fwhm</span><span class="p">,</span> <span class="mf">7.083984375</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fwhm</span><span class="p">)</span>
<span class="go">7.083984375</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">psf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">))</span> <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">[&lt;matplotlib.lines.Line2D object at 0x...&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1DAstropy.gamma">
<code class="sig-name descname">gamma</code><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.gamma" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1DAstropy.inputs">
<code class="sig-name descname">inputs</code><em class="property"> = ('x',)</em><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.inputs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF1DAstropy.integrate">
<code class="sig-name descname">integrate</code><span class="sig-paren">(</span><em class="sig-param">bounds=(-inf</em>, <em class="sig-param">inf)</em>, <em class="sig-param">x_array=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1DAstropy.integrate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.integrate" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the integral of the PSF model. Bounds are -np.inf, np.inf by default, or provided
if no x_array is provided. Otherwise the bounds comes from x_array edges.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x_array</strong> (<em>array_like</em><em>, </em><em>optional</em>) – If not None, the interpoalted PSF modelis used for integration (default: None).</p></li>
<li><p><strong>bounds</strong> (<em>array_like</em><em>, </em><em>optional</em>) – The bounds of the integral (default bounds=(-np.inf, np.inf)).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>result</strong> – The integral of the PSF model.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">PSF1DAstropy</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">psf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">))</span> 
<span class="go">[&lt;matplotlib.lines.Line2D object at ...&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">psf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">))</span> 
<span class="go">[&lt;matplotlib.lines.Line2D object at ...&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-6.py">Source code</a>)</p>
<div class="figure align-default">
<img alt="../_images/spectractor-extractor-6.png" src="../_images/spectractor-extractor-6.png" />
</div>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>  
<span class="go">10.0597...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span> <span class="n">x_array</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>  
<span class="go">10.0466...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF1DAstropy.interpolation">
<code class="sig-name descname">interpolation</code><span class="sig-paren">(</span><em class="sig-param">x_array</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1DAstropy.interpolation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.interpolation" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x_array</strong> (<em>array_like</em>) – The abscisse array to interpolate the model.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>interp</strong> – Function corresponding to the interpolated model on the x_array array.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>callable</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">PSF1DAstropy</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">interp</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">interpolation</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1DAstropy.outputs">
<code class="sig-name descname">outputs</code><em class="property"> = ('y',)</em><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.outputs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1DAstropy.param_names">
<code class="sig-name descname">param_names</code><em class="property"> = ('amplitude_moffat', 'x_mean', 'gamma', 'alpha', 'eta_gauss', 'stddev', 'saturation')</em><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.param_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1DAstropy.saturation">
<code class="sig-name descname">saturation</code><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.saturation" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1DAstropy.stddev">
<code class="sig-name descname">stddev</code><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.stddev" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF1DAstropy.x_mean">
<code class="sig-name descname">x_mean</code><a class="headerlink" href="#spectractor.extractor.psf.PSF1DAstropy.x_mean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.PSF1DFitWorkspace">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">PSF1DFitWorkspace</code><span class="sig-paren">(</span><em class="sig-param">psf</em>, <em class="sig-param">data</em>, <em class="sig-param">data_errors</em>, <em class="sig-param">bgd_model_func=None</em>, <em class="sig-param">file_name=''</em>, <em class="sig-param">nwalkers=18</em>, <em class="sig-param">nsteps=1000</em>, <em class="sig-param">burnin=100</em>, <em class="sig-param">nbins=10</em>, <em class="sig-param">verbose=0</em>, <em class="sig-param">plot=False</em>, <em class="sig-param">live_fit=False</em>, <em class="sig-param">truth=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1DFitWorkspace"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1DFitWorkspace" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.psf.PSFFitWorkspace" title="spectractor.extractor.psf.PSFFitWorkspace"><code class="xref py py-class docutils literal notranslate"><span class="pre">spectractor.extractor.psf.PSFFitWorkspace</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.psf.PSF1DFitWorkspace.plot_fit">
<code class="sig-name descname">plot_fit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1DFitWorkspace.plot_fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1DFitWorkspace.plot_fit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF1DFitWorkspace.simulate">
<code class="sig-name descname">simulate</code><span class="sig-paren">(</span><em class="sig-param">amplitude</em>, <em class="sig-param">mean</em>, <em class="sig-param">gamma</em>, <em class="sig-param">alpha</em>, <em class="sig-param">eta_gauss</em>, <em class="sig-param">stddev</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1DFitWorkspace.simulate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1DFitWorkspace.simulate" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate a PSF model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>amplitude</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Amplitude of the PSF model.</p></li>
<li><p><strong>mean</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Center of the PSF model.</p></li>
<li><p><strong>gamma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Gamma of the Moffat part of the PSF model (width).</p></li>
<li><p><strong>alpha</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Alpha of the Moffat part of the PSF model (exponent).</p></li>
<li><p><strong>eta_gauss</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Negative amplitude of the Gaussian part of the PSF model.</p></li>
<li><p><strong>stddev</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Standard deviation of the Gaussian part of the PSF model.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Build a mock spectrogram with random Poisson noise:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">300</span><span class="p">,</span>  <span class="mi">50</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">200</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">PSF1D</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bgd</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">+=</span> <span class="n">bgd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Extract the background</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bgd_model_func</span> <span class="o">=</span> <span class="n">extract_background_fit1D</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>Fit the data:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">PSF1DFitWorkspace</span><span class="p">(</span><span class="n">psf</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="n">mod_err</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mod</span><span class="o">+</span><span class="n">bgd_model_func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="n">data_errors</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="o">.</span><span class="n">plot_fit</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-7.py">Source code</a>)</p>
<div class="figure align-default">
<img alt="../_images/spectractor-extractor-7.png" src="../_images/spectractor-extractor-7.png" />
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.PSF1D_chisq">
<code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">PSF1D_chisq</code><span class="sig-paren">(</span><em class="sig-param">params</em>, <em class="sig-param">model</em>, <em class="sig-param">xx</em>, <em class="sig-param">yy</em>, <em class="sig-param">yy_err=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1D_chisq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1D_chisq" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.PSF1D_chisq_jac">
<code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">PSF1D_chisq_jac</code><span class="sig-paren">(</span><em class="sig-param">params</em>, <em class="sig-param">model</em>, <em class="sig-param">xx</em>, <em class="sig-param">yy</em>, <em class="sig-param">yy_err=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF1D_chisq_jac"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF1D_chisq_jac" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.PSF2D">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">PSF2D</code><span class="sig-paren">(</span><em class="sig-param">p=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2D" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.psf.PSF" title="spectractor.extractor.psf.PSF"><code class="xref py py-class docutils literal notranslate"><span class="pre">spectractor.extractor.psf.PSF</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.psf.PSF2D.evaluate">
<code class="sig-name descname">evaluate</code><span class="sig-paren">(</span><em class="sig-param">pixels</em>, <em class="sig-param">p=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2D.evaluate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2D.evaluate" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate the PSF2D function.</p>
<p>The function is normalized to have an integral equal to amplitude_moffat parameter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pixels</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a>) – List containing the X abscisse 2D array and the Y abscisse 2D array.</p></li>
<li><p><strong>p</strong> (<em>array_like</em>) – The parameter array. If None, the array used to instanciate the class is taken.
If given, the class instance parameter array is updated.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>output</strong> – The PSF function evaluated.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>array_like</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">PSF2D</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[:</span><span class="mi">50</span><span class="p">,</span> <span class="p">:</span><span class="mi">60</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">pixels</span><span class="o">=</span><span class="p">[</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">])</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-8.py">Source code</a>)</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.PSF2DAstropy">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">PSF2DAstropy</code><span class="sig-paren">(</span><em class="sig-param">amplitude_moffat=1</em>, <em class="sig-param">x_mean=0</em>, <em class="sig-param">y_mean=0</em>, <em class="sig-param">gamma=3</em>, <em class="sig-param">alpha=3</em>, <em class="sig-param">eta_gauss=0.0</em>, <em class="sig-param">stddev=1</em>, <em class="sig-param">saturation=1</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2DAstropy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">astropy.modeling.core.Fittable2DModel</span></code></p>
<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2DAstropy.alpha">
<code class="sig-name descname">alpha</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.alpha" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2DAstropy.amplitude_moffat">
<code class="sig-name descname">amplitude_moffat</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.amplitude_moffat" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2DAstropy.eta_gauss">
<code class="sig-name descname">eta_gauss</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.eta_gauss" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF2DAstropy.evaluate">
<em class="property">static </em><code class="sig-name descname">evaluate</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">amplitude</em>, <em class="sig-param">x_mean</em>, <em class="sig-param">y_mean</em>, <em class="sig-param">gamma</em>, <em class="sig-param">alpha</em>, <em class="sig-param">eta_gauss</em>, <em class="sig-param">stddev</em>, <em class="sig-param">saturation</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2DAstropy.evaluate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.evaluate" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate the model on some input variables.</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF2DAstropy.fit_deriv">
<em class="property">static </em><code class="sig-name descname">fit_deriv</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">amplitude</em>, <em class="sig-param">x_mean</em>, <em class="sig-param">y_mean</em>, <em class="sig-param">gamma</em>, <em class="sig-param">alpha</em>, <em class="sig-param">eta_gauss</em>, <em class="sig-param">stddev</em>, <em class="sig-param">saturation</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2DAstropy.fit_deriv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.fit_deriv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2DAstropy.gamma">
<code class="sig-name descname">gamma</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.gamma" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2DAstropy.inputs">
<code class="sig-name descname">inputs</code><em class="property"> = ('x', 'y')</em><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.inputs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF2DAstropy.interpolation">
<code class="sig-name descname">interpolation</code><span class="sig-paren">(</span><em class="sig-param">x_array</em>, <em class="sig-param">y_array</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2DAstropy.interpolation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.interpolation" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x_array</strong> (<em>array_like</em>) – The x array to interpolate the model.</p></li>
<li><p><strong>y_array</strong> (<em>array_like</em>) – The y array to interpolate the model.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>interp</strong> – Function corresponding to the interpolated model on the (x_array,y_array) array.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>callable</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">PSF2DAstropy</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">interp</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">interpolation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF2DAstropy.normalisation">
<em class="property">static </em><code class="sig-name descname">normalisation</code><span class="sig-paren">(</span><em class="sig-param">amplitude</em>, <em class="sig-param">gamma</em>, <em class="sig-param">alpha</em>, <em class="sig-param">eta_gauss</em>, <em class="sig-param">stddev</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2DAstropy.normalisation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.normalisation" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2DAstropy.outputs">
<code class="sig-name descname">outputs</code><em class="property"> = ('z',)</em><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.outputs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2DAstropy.param_names">
<code class="sig-name descname">param_names</code><em class="property"> = ('amplitude_moffat', 'x_mean', 'y_mean', 'gamma', 'alpha', 'eta_gauss', 'stddev', 'saturation')</em><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.param_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2DAstropy.param_titles">
<code class="sig-name descname">param_titles</code><em class="property"> = ['A', 'x', 'y', '\\gamma', '\\alpha', '\\eta', '\\sigma', 'saturation']</em><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.param_titles" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2DAstropy.saturation">
<code class="sig-name descname">saturation</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.saturation" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2DAstropy.stddev">
<code class="sig-name descname">stddev</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.stddev" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2DAstropy.x_mean">
<code class="sig-name descname">x_mean</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.x_mean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="spectractor.extractor.psf.PSF2DAstropy.y_mean">
<code class="sig-name descname">y_mean</code><a class="headerlink" href="#spectractor.extractor.psf.PSF2DAstropy.y_mean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.PSF2DFitWorkspace">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">PSF2DFitWorkspace</code><span class="sig-paren">(</span><em class="sig-param">psf</em>, <em class="sig-param">data</em>, <em class="sig-param">data_errors</em>, <em class="sig-param">bgd_model_func=None</em>, <em class="sig-param">file_name=''</em>, <em class="sig-param">nwalkers=18</em>, <em class="sig-param">nsteps=1000</em>, <em class="sig-param">burnin=100</em>, <em class="sig-param">nbins=10</em>, <em class="sig-param">verbose=0</em>, <em class="sig-param">plot=False</em>, <em class="sig-param">live_fit=False</em>, <em class="sig-param">truth=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2DFitWorkspace"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2DFitWorkspace" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.psf.PSFFitWorkspace" title="spectractor.extractor.psf.PSFFitWorkspace"><code class="xref py py-class docutils literal notranslate"><span class="pre">spectractor.extractor.psf.PSFFitWorkspace</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.psf.PSF2DFitWorkspace.plot_fit">
<code class="sig-name descname">plot_fit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2DFitWorkspace.plot_fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2DFitWorkspace.plot_fit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="spectractor.extractor.psf.PSF2DFitWorkspace.simulate">
<code class="sig-name descname">simulate</code><span class="sig-paren">(</span><em class="sig-param">amplitude</em>, <em class="sig-param">x_mean</em>, <em class="sig-param">y_mean</em>, <em class="sig-param">gamma</em>, <em class="sig-param">alpha</em>, <em class="sig-param">eta_gauss</em>, <em class="sig-param">stddev</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2DFitWorkspace.simulate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2DFitWorkspace.simulate" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate a PSF model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>amplitude</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Amplitude of the PSF model.</p></li>
<li><p><strong>x_mean</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Center of the PSF model on X axis.</p></li>
<li><p><strong>y_mean</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Center of the PSF model on Y axis.</p></li>
<li><p><strong>gamma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Gamma of the Moffat part of the PSF model (width).</p></li>
<li><p><strong>alpha</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Alpha of the Moffat part of the PSF model (exponent).</p></li>
<li><p><strong>eta_gauss</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Negative amplitude of the Gaussian part of the PSF model.</p></li>
<li><p><strong>stddev</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Standard deviation of the Gaussian part of the PSF model.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Build a mock spectrogram with random Poisson noise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">500</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">400</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">PSF2D</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[:</span><span class="mi">50</span><span class="p">,</span> <span class="p">:</span><span class="mi">60</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p># Extract the background
# &gt;&gt;&gt; bgd_model_func = extract_background_photutils(data, data_errors, ws=[30,50])</p>
<p>Fit the data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">PSF2DFitWorkspace</span><span class="p">(</span><span class="n">psf</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">bgd_model_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="n">mod_err</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="o">.</span><span class="n">plot_fit</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.PSF2D_chisq">
<code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">PSF2D_chisq</code><span class="sig-paren">(</span><em class="sig-param">params</em>, <em class="sig-param">model</em>, <em class="sig-param">xx</em>, <em class="sig-param">yy</em>, <em class="sig-param">zz</em>, <em class="sig-param">zz_err=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2D_chisq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2D_chisq" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.PSF2D_chisq_jac">
<code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">PSF2D_chisq_jac</code><span class="sig-paren">(</span><em class="sig-param">params</em>, <em class="sig-param">model</em>, <em class="sig-param">xx</em>, <em class="sig-param">yy</em>, <em class="sig-param">zz</em>, <em class="sig-param">zz_err=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSF2D_chisq_jac"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSF2D_chisq_jac" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="spectractor.extractor.psf.PSFFitWorkspace">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">PSFFitWorkspace</code><span class="sig-paren">(</span><em class="sig-param">psf</em>, <em class="sig-param">data</em>, <em class="sig-param">data_errors</em>, <em class="sig-param">bgd_model_func=None</em>, <em class="sig-param">file_name=''</em>, <em class="sig-param">nwalkers=18</em>, <em class="sig-param">nsteps=1000</em>, <em class="sig-param">burnin=100</em>, <em class="sig-param">nbins=10</em>, <em class="sig-param">verbose=0</em>, <em class="sig-param">plot=False</em>, <em class="sig-param">live_fit=False</em>, <em class="sig-param">truth=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#PSFFitWorkspace"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.PSFFitWorkspace" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="spectractor.fit.html#spectractor.fit.fitter.FitWorkspace" title="spectractor.fit.fitter.FitWorkspace"><code class="xref py py-class docutils literal notranslate"><span class="pre">spectractor.fit.fitter.FitWorkspace</span></code></a></p>
<p>Generic PSF fitting workspace.</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.fit_PSF1D">
<code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">fit_PSF1D</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">data</em>, <em class="sig-param">guess=None</em>, <em class="sig-param">bounds=None</em>, <em class="sig-param">data_errors=None</em>, <em class="sig-param">method='minimize'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#fit_PSF1D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.fit_PSF1D" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Fit a PSF 1D Astropy model with parameters :</dt><dd><p>amplitude_gauss, x_mean, stddev, amplitude_moffat, alpha, gamma, saturation</p>
</dd>
</dl>
<p>using basin hopping global minimization method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>np.array</em>) – 1D array of the x coordinates.</p></li>
<li><p><strong>data</strong> (<em>np.array</em>) – the 1D array profile.</p></li>
<li><p><strong>guess</strong> (<em>array_like</em><em>, </em><em>optional</em>) – list containing a first guess for the PSF parameters (default: None).</p></li>
<li><p><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – 2D list containing bounds for the PSF parameters with format ((min,…), (max…)) (default: None)</p></li>
<li><p><strong>data_errors</strong> (<em>np.array</em>) – the 1D array uncertainties.</p></li>
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em>, </em><em>optional</em>) – method to use for the minimisation: choose between minimize and basinhopping.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>fitted_model</strong> – the PSF fitted model.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#spectractor.extractor.psf.PSF1DAstropy" title="spectractor.extractor.psf.PSF1DAstropy">PSF1DAstropy</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Create the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">PSF1DAstropy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">/</span><span class="mf">10.</span>
</pre></div>
</div>
<p>Prepare the fit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">guess</span> <span class="o">=</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">60</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
</pre></div>
</div>
<p>Fit with error bars:
# &gt;&gt;&gt; model = fit_PSF1D(X, Y, guess=guess, bounds=bounds, data_errors=Y_err)
# &gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
# &gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-3))
#
# Fit without error bars:
# &gt;&gt;&gt; model = fit_PSF1D(X, Y, guess=guess, bounds=bounds, data_errors=None)
# &gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
# &gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-3))
#
# Fit with error bars and basin hopping method:
# &gt;&gt;&gt; model = fit_PSF1D(X, Y, guess=guess, bounds=bounds, data_errors=Y_err, method=’basinhopping’)
# &gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
# &gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-3))</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.fit_PSF1D_minuit">
<code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">fit_PSF1D_minuit</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">data</em>, <em class="sig-param">guess=None</em>, <em class="sig-param">bounds=None</em>, <em class="sig-param">data_errors=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#fit_PSF1D_minuit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.fit_PSF1D_minuit" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Fit a PSF 1D Astropy model with parameters:</dt><dd><p>amplitude_gauss, x_mean, stddev, amplitude_moffat, alpha, gamma, saturation</p>
</dd>
</dl>
<p>using Minuit.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>np.array</em>) – 1D array of the x coordinates.</p></li>
<li><p><strong>data</strong> (<em>np.array</em>) – the 1D array profile.</p></li>
<li><p><strong>guess</strong> (<em>array_like</em><em>, </em><em>optional</em>) – list containing a first guess for the PSF parameters (default: None).</p></li>
<li><p><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – 2D list containing bounds for the PSF parameters with format ((min,…), (max…)) (default: None)</p></li>
<li><p><strong>data_errors</strong> (<em>np.array</em>) – the 1D array uncertainties.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>fitted_model</strong> – the PSF fitted model.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#spectractor.extractor.psf.PSF1DAstropy" title="spectractor.extractor.psf.PSF1DAstropy">PSF1DAstropy</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Create the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">PSF1DAstropy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
<p>Prepare the fit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">guess</span> <span class="o">=</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">60</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
</pre></div>
</div>
<p>Fit with error bars:
# &gt;&gt;&gt; model = fit_PSF1D_minuit(X, Y, guess=guess, bounds=bounds, data_errors=Y_err)
# &gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
# &gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-2))
#
# Fit without error bars:
# &gt;&gt;&gt; model = fit_PSF1D_minuit(X, Y, guess=guess, bounds=bounds, data_errors=None)
# &gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
# &gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-2))</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.fit_PSF1D_minuit_outlier_removal">
<code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">fit_PSF1D_minuit_outlier_removal</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">data</em>, <em class="sig-param">data_errors</em>, <em class="sig-param">guess=None</em>, <em class="sig-param">bounds=None</em>, <em class="sig-param">sigma=3</em>, <em class="sig-param">niter=2</em>, <em class="sig-param">consecutive=3</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#fit_PSF1D_minuit_outlier_removal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.fit_PSF1D_minuit_outlier_removal" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Fit a PSF Astropy 1D model with parameters:</dt><dd><p>amplitude_gauss, x_mean, stddev, amplitude_moffat, alpha, gamma, saturation</p>
</dd>
</dl>
<p>using Minuit. Find outliers data point above sigma*data_errors from the fit over niter iterations.
Only at least 3 consecutive outliers are considered.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>np.array</em>) – 1D array of the x coordinates.</p></li>
<li><p><strong>data</strong> (<em>np.array</em>) – the 1D array profile.</p></li>
<li><p><strong>data_errors</strong> (<em>np.array</em>) – the 1D array uncertainties.</p></li>
<li><p><strong>guess</strong> (<em>array_like</em><em>, </em><em>optional</em>) – list containing a first guess for the PSF parameters (default: None).</p></li>
<li><p><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – 2D list containing bounds for the PSF parameters with format ((min,…), (max…)) (default: None)</p></li>
<li><p><strong>sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – the sigma limit to exclude data points (default: 3).</p></li>
<li><p><strong>niter</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – the number of loop iterations to exclude  outliers and refit the model (default: 2).</p></li>
<li><p><strong>consecutive</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – the number of outliers that have to be consecutive to be considered (default: 3).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>fitted_model</strong> (<em>PSF1DAstropy</em>) – the PSF fitted model.</p></li>
<li><p><strong>outliers</strong> (<em>list</em>) – the list of the outlier indices.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Create the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">PSF1DAstropy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y</span> <span class="o">+=</span> <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">X</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
<p>Prepare the fit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">guess</span> <span class="o">=</span> <span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">6000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6000</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8000</span><span class="p">))</span>
</pre></div>
</div>
<p>Fit with error bars:
# &gt;&gt;&gt; model, outliers = fit_PSF1D_minuit_outlier_removal(X, Y, guess=guess, bounds=bounds, data_errors=Y_err,
# … sigma=3, niter=2, consecutive=3)
# &gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
# &gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-1))</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.fit_PSF1D_outlier_removal">
<code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">fit_PSF1D_outlier_removal</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">data</em>, <em class="sig-param">data_errors=None</em>, <em class="sig-param">sigma=3.0</em>, <em class="sig-param">niter=3</em>, <em class="sig-param">guess=None</em>, <em class="sig-param">bounds=None</em>, <em class="sig-param">method='minimize'</em>, <em class="sig-param">niter_basinhopping=5</em>, <em class="sig-param">T_basinhopping=0.2</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#fit_PSF1D_outlier_removal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.fit_PSF1D_outlier_removal" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Fit a PSF 1D Astropy model with parameters:</dt><dd><p>amplitude_gauss, x_mean, stddev, amplitude_moffat, alpha, gamma, saturation</p>
</dd>
</dl>
<p>using scipy. Find outliers data point above sigma*data_errors from the fit over niter iterations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>np.array</em>) – 1D array of the x coordinates.</p></li>
<li><p><strong>data</strong> (<em>np.array</em>) – the 1D array profile.</p></li>
<li><p><strong>data_errors</strong> (<em>np.array</em>) – the 1D array uncertainties.</p></li>
<li><p><strong>guess</strong> (<em>array_like</em><em>, </em><em>optional</em>) – list containing a first guess for the PSF parameters (default: None).</p></li>
<li><p><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – 2D list containing bounds for the PSF parameters with format ((min,…), (max…)) (default: None)</p></li>
<li><p><strong>sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – the sigma limit to exclude data points (default: 3).</p></li>
<li><p><strong>niter</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – the number of loop iterations to exclude  outliers and refit the model (default: 2).</p></li>
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Can be ‘minimize’ or ‘basinhopping’ (default: ‘minimize’).</p></li>
<li><p><strong>niter_basinhopping</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a><em>, </em><em>optional</em>) – The number of basin hops (default: 5)</p></li>
<li><p><strong>T_basinhopping</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) – The temperature for the basin hops (default: 0.2)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>fitted_model</strong> (<em>PSF1DAstropy</em>) – the PSF fitted model.</p></li>
<li><p><strong>outliers</strong> (<em>list</em>) – the list of the outlier indices.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Create the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">PSF1DAstropy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y</span> <span class="o">+=</span> <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">X</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
<p>Prepare the fit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">guess</span> <span class="o">=</span> <span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">6000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6000</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8000</span><span class="p">))</span>
</pre></div>
</div>
<p>Fit without bars:
# &gt;&gt;&gt; model, outliers = fit_PSF1D_outlier_removal(X, Y, guess=guess, bounds=bounds,
# … sigma=3, niter=5, method=”minimize”)
# &gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
# &gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-1))
#
# Fit with error bars:
# &gt;&gt;&gt; model, outliers = fit_PSF1D_outlier_removal(X, Y, guess=guess, bounds=bounds, data_errors=Y_err,
# … sigma=3, niter=2, method=”minimize”)
# &gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
# &gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-1))
#
# Fit with error bars and basinhopping:
# &gt;&gt;&gt; model, outliers = fit_PSF1D_outlier_removal(X, Y, guess=guess, bounds=bounds, data_errors=Y_err,
# … sigma=3, niter=5, method=”basinhopping”, niter_basinhopping=20)
# &gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]
# &gt;&gt;&gt; assert np.all(np.isclose(p[:-1], res[:-1], rtol=1e-1))</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.fit_PSF2D">
<code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">fit_PSF2D</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">data</em>, <em class="sig-param">guess=None</em>, <em class="sig-param">bounds=None</em>, <em class="sig-param">data_errors=None</em>, <em class="sig-param">method='minimize'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#fit_PSF2D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.fit_PSF2D" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Fit a PSF 2D model with parameters :</dt><dd><p>amplitude, x_mean, y_mean, stddev, eta, alpha, gamma, saturation</p>
</dd>
</dl>
<p>using basin hopping global minimization method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>np.array</em>) – 2D array of the x coordinates from meshgrid.</p></li>
<li><p><strong>y</strong> (<em>np.array</em>) – 2D array of the y coordinates from meshgrid.</p></li>
<li><p><strong>data</strong> (<em>np.array</em>) – the 2D array image.</p></li>
<li><p><strong>guess</strong> (<em>array_like</em><em>, </em><em>optional</em>) – List containing a first guess for the PSF parameters (default: None).</p></li>
<li><p><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – 2D list containing bounds for the PSF parameters with format ((min,…), (max…)) (default: None)</p></li>
<li><p><strong>data_errors</strong> (<em>np.array</em>) – the 2D array uncertainties.</p></li>
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em>, </em><em>optional</em>) – the minimisation method: ‘minimize’ or ‘basinhopping’ (default: ‘minimize’).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>fitted_model</strong> – the PSF2D fitted model.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#spectractor.extractor.psf.PSF2D" title="spectractor.extractor.psf.PSF2D">PSF2D</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Create the model:
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; X, Y = np.mgrid[:50,:50]
&gt;&gt;&gt; psf = PSF2DAstropy()
&gt;&gt;&gt; p = (50, 25, 25, 5, 1, -0.4, 1, 60)
&gt;&gt;&gt; Z = psf.evaluate(X, Y, <a href="#id1"><span class="problematic" id="id2">*</span></a>p)
&gt;&gt;&gt; Z_err = np.sqrt(Z)/10.</p>
<p>Prepare the fit:
&gt;&gt;&gt; guess = (52, 22, 22, 3.2, 1.2, -0.1, 2, 60)
&gt;&gt;&gt; bounds = ((1, 200), (10, 40), (10, 40), (0.5, 10), (0.5, 5), (-100, 200), (0.01, 10), (0, 400))</p>
<p>Fit with error bars:
&gt;&gt;&gt; model = fit_PSF2D(X, Y, Z, guess=guess, bounds=bounds, data_errors=Z_err)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]</p>
<p>Fit without error bars:
&gt;&gt;&gt; model = fit_PSF2D(X, Y, Z, guess=guess, bounds=bounds, data_errors=None)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]</p>
<p>Fit with error bars and basin hopping method:
&gt;&gt;&gt; model = fit_PSF2D(X, Y, Z, guess=guess, bounds=bounds, data_errors=Z_err, method=’basinhopping’)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.fit_PSF2D_minuit">
<code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">fit_PSF2D_minuit</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">data</em>, <em class="sig-param">guess=None</em>, <em class="sig-param">bounds=None</em>, <em class="sig-param">data_errors=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#fit_PSF2D_minuit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.fit_PSF2D_minuit" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Fit a PSF 2D model with parameters :</dt><dd><p>amplitude, x_mean, y_mean, stddev, eta, alpha, gamma, saturation</p>
</dd>
</dl>
<p>using basin hopping global minimization method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>np.array</em>) – 2D array of the x coordinates from meshgrid.</p></li>
<li><p><strong>y</strong> (<em>np.array</em>) – 2D array of the y coordinates from meshgrid.</p></li>
<li><p><strong>data</strong> (<em>np.array</em>) – the 2D array image.</p></li>
<li><p><strong>guess</strong> (<em>array_like</em><em>, </em><em>optional</em>) – List containing a first guess for the PSF parameters (default: None).</p></li>
<li><p><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – 2D list containing bounds for the PSF parameters with format ((min,…), (max…)) (default: None)</p></li>
<li><p><strong>data_errors</strong> (<em>np.array</em>) – the 2D array uncertainties.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>fitted_model</strong> – the PSF2D fitted model.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#spectractor.extractor.psf.PSF2D" title="spectractor.extractor.psf.PSF2D">PSF2D</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Create the model:
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; X, Y = np.mgrid[:50,:50]
&gt;&gt;&gt; psf = PSF2DAstropy()
&gt;&gt;&gt; p = (50, 25, 25, 5, 1, -0.4, 1, 60)
&gt;&gt;&gt; Z = psf.evaluate(X, Y, <a href="#id3"><span class="problematic" id="id4">*</span></a>p)
&gt;&gt;&gt; Z_err = np.sqrt(Z)/10.</p>
<p>Prepare the fit:
&gt;&gt;&gt; guess = (52, 22, 22, 3.2, 1.2, -0.1, 2, 60)
&gt;&gt;&gt; bounds = ((1, 200), (10, 40), (10, 40), (0.5, 10), (0.5, 5), (-100, 200), (0.01, 10), (0, 400))</p>
<p>Fit with error bars:
&gt;&gt;&gt; model = fit_PSF2D_minuit(X, Y, Z, guess=guess, bounds=bounds, data_errors=Z_err)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]</p>
<p>Fit without error bars:
&gt;&gt;&gt; model = fit_PSF2D_minuit(X, Y, Z, guess=guess, bounds=bounds, data_errors=None)
&gt;&gt;&gt; res = [getattr(model, p).value for p in model.param_names]</p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.psf.plot_transverse_PSF1D_profile">
<code class="sig-prename descclassname">spectractor.extractor.psf.</code><code class="sig-name descname">plot_transverse_PSF1D_profile</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">indices</em>, <em class="sig-param">bgd_indices</em>, <em class="sig-param">data</em>, <em class="sig-param">err</em>, <em class="sig-param">fit=None</em>, <em class="sig-param">bgd_model_func=None</em>, <em class="sig-param">params=None</em>, <em class="sig-param">PSF_guess=None</em>, <em class="sig-param">outliers=[]</em>, <em class="sig-param">sigma=3</em>, <em class="sig-param">live_fit=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/psf.html#plot_transverse_PSF1D_profile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.psf.plot_transverse_PSF1D_profile" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the transverse profile of  the spectrogram.</p>
<p>This plot function is called in transverse_PSF1D_profile if live_fit option is True.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Pixel index along the dispersion axis.</p></li>
<li><p><strong>indices</strong> (<em>array_like</em>) – Pixel indices across the dispersion axis.</p></li>
<li><p><strong>bgd_indices</strong> (<em>array_like</em>) – Pixel indices across the dispersion axis for the background estimate.</p></li>
<li><p><strong>data</strong> (<em>array_like</em>) – The 2D spectrogram data array.</p></li>
<li><p><strong>err</strong> (<em>array_like</em>) – The 2D spectrogram uncertainty data array.</p></li>
<li><p><strong>fit</strong> (<a class="reference internal" href="#spectractor.extractor.psf.PSF1D" title="spectractor.extractor.psf.PSF1D"><em>PSF1D</em></a><em>, </em><em>optional</em>) – Best fitting model function for the profile (default: None).</p></li>
<li><p><strong>bgd_model_func</strong> (<em>callable</em><em>, </em><em>optional</em>) – A 2D function to model the extracted background (default: None -&gt; null background)</p></li>
<li><p><strong>params</strong> (<em>array_like</em><em>, </em><em>optional</em>) – Best fitting model parameter array (default: None).</p></li>
<li><p><strong>PSF_guess</strong> (<a class="reference internal" href="#spectractor.extractor.psf.PSF1D" title="spectractor.extractor.psf.PSF1D"><em>PSF1D</em></a><em>, </em><em>optional</em>) – Guessed fitting model function for the profile before the fit (default: None).</p></li>
<li><p><strong>outliers</strong> (<em>array_like</em><em>, </em><em>optional</em>) – Pixel indices of the outliers across the dispersion axis (default: None).</p></li>
<li><p><strong>sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a><em>, </em><em>optional</em>) – Value of the sigma-clipping rejection (default: 3).
Necessary only if an outlier array is given with the outliers keyword.</p></li>
<li><p><strong>live_fit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True, plot is shown  in live during the fitting procedure (default: False).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Build a mock spectrogram with random Poisson noise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s0</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">generate_test_poly_params</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">saturation</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bgd</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">+=</span> <span class="n">bgd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Extract the background:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bgd_model_func</span> <span class="o">=</span> <span class="n">extract_background_photutils</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
<p>Fit the transverse profile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ChromaticPSF1D</span><span class="p">(</span><span class="n">Nx</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">fit_transverse_PSF1D_profile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_errors</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span> <span class="n">pixel_step</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span><span class="n">bgd_model_func</span><span class="o">=</span><span class="n">bgd_model_func</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="n">saturation</span><span class="p">,</span> <span class="n">live_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-spectractor.extractor.spectroscopy">
<span id="spectractor-extractor-spectroscopy-module"></span><h2>spectractor.extractor.spectroscopy module<a class="headerlink" href="#module-spectractor.extractor.spectroscopy" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="spectractor.extractor.spectroscopy.Line">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.spectroscopy.</code><code class="sig-name descname">Line</code><span class="sig-paren">(</span><em class="sig-param">wavelength, label, atmospheric=False, emission=False, label_pos=[0.007, 0.02], width_bounds=[0.5, 6], use_for_calibration=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectroscopy.html#Line"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectroscopy.Line" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Class modeling the emission or absorption lines.</p>
<dl class="method">
<dt id="spectractor.extractor.spectroscopy.Line.gaussian_model">
<code class="sig-name descname">gaussian_model</code><span class="sig-paren">(</span><em class="sig-param">lambdas</em>, <em class="sig-param">A=1</em>, <em class="sig-param">sigma=2</em>, <em class="sig-param">use_fit=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectroscopy.html#Line.gaussian_model"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectroscopy.Line.gaussian_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a Gaussian model of the spectral line.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lambdas</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>array</em>) – Wavelength array of float in nm</p></li>
<li><p><strong>A</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Amplitude of the Gaussian (default: +1)</p></li>
<li><p><strong>sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Standard deviation of the Gaussian (default: 2)</p></li>
<li><p><strong>use_fit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>, </em><em>optional</em>) – If True, it overrides the previous setting values and use the Gaussian fit made on data, if ti exists.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>model</strong> – The amplitude array of float of the Gaussian model of the line.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a>, array</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Give lambdas as a float:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">l</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="mf">656.3</span><span class="p">,</span> <span class="n">atmospheric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$H</span><span class="se">\a</span><span class="s1">lpha$&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sigma</span> <span class="o">=</span> <span class="mf">2.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">gaussian_model</span><span class="p">(</span><span class="mf">656.3</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">use_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="go">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">gaussian_model</span><span class="p">(</span><span class="mf">656.3</span><span class="o">+</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">A</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">use_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{model:.3f}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">0.500</span>
</pre></div>
</div>
<p>Use a fit (for the example we create a mock fit result):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">.</span><span class="n">fit_lambdas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span><span class="mi">700</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">.</span><span class="n">fit_gauss</span> <span class="o">=</span> <span class="n">gauss</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">fit_lambdas</span><span class="p">,</span> <span class="mf">1e-10</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">.</span><span class="n">fit_fwhm</span> <span class="o">=</span> <span class="mf">2.3</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lambdas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">gaussian_model</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">use_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[0. 0. 0. 0. 0.]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.spectroscopy.Lines">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.spectroscopy.</code><code class="sig-name descname">Lines</code><span class="sig-paren">(</span><em class="sig-param">lines</em>, <em class="sig-param">redshift=0</em>, <em class="sig-param">atmospheric_lines=True</em>, <em class="sig-param">hydrogen_only=False</em>, <em class="sig-param">emission_spectrum=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectroscopy.html#Lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectroscopy.Lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Class gathering all the lines and associated methods.</p>
<dl class="method">
<dt id="spectractor.extractor.spectroscopy.Lines.plot_atomic_lines">
<code class="sig-name descname">plot_atomic_lines</code><span class="sig-paren">(</span><em class="sig-param">ax</em>, <em class="sig-param">color_atomic='g'</em>, <em class="sig-param">color_atmospheric='b'</em>, <em class="sig-param">fontsize=12</em>, <em class="sig-param">force=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectroscopy.html#Lines.plot_atomic_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectroscopy.Lines.plot_atomic_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Over plot the atomic lines as vertical lines, only if they are fitted or with high
signal to  noise ratio, unless force keyword is set to True.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ax</strong> (<em>Axes</em>) – An Axes instance on which plot the spectral lines.</p></li>
<li><p><strong>color_atomic</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Color of the atomic lines (default: ‘g’).</p></li>
<li><p><strong>color_atmospheric</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Color of the atmospheric lines (default: ‘b’).</p></li>
<li><p><strong>fontsize</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Font size of the spectral line labels (default: 12).</p></li>
<li><p><strong>force</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Force the plot of vertical lines if set to True (default: False).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spectractor.extractor.spectroscopy</span> <span class="k">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spectractor</span> <span class="k">import</span> <span class="n">parameters</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="go">(300, 1000)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span> <span class="o">=</span> <span class="n">Lines</span><span class="p">(</span><span class="n">HYDROGEN_LINES</span><span class="o">+</span><span class="n">ATMOSPHERIC_LINES</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">high_snr</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">high_snr</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">plot_atomic_lines</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-9.py">Source code</a>)</p>
<div class="figure align-default">
<img alt="../_images/spectractor-extractor-9.png" src="../_images/spectractor-extractor-9.png" />
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectroscopy.Lines.plot_detected_lines">
<code class="sig-name descname">plot_detected_lines</code><span class="sig-paren">(</span><em class="sig-param">ax=None</em>, <em class="sig-param">print_table=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectroscopy.html#Lines.plot_detected_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectroscopy.Lines.plot_detected_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Detect and fit the lines in a spectrum. The method is to look at maxima or minima
around emission or absorption tabulated lines, and to select surrounding pixels
to fit a (positive or negative) gaussian and a polynomial background. If several regions
overlap, a multi-gaussian fit is performed above a common polynomial background.
The mean global shift (in nm) between the detected and tabulated lines is returned, considering
only the lines with a signal-to-noise ratio above a threshold.
The order of the polynomial background is set in parameters.py with CALIB_BGD_ORDER.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ax</strong> (<em>Axes</em>) – The Axes instance if needed (default: None).</p></li>
<li><p><strong>print_table</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>, </em><em>optional</em>) – If True, print a summary table (default: False).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Creation of a mock spectrum with emission and absorption lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spectractor.extractor.spectrum</span> <span class="k">import</span> <span class="n">Spectrum</span><span class="p">,</span> <span class="n">detect_lines</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lambdas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span> <span class="o">=</span> <span class="mf">1e4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">lambdas</span><span class="o">-</span><span class="mi">600</span><span class="p">)</span><span class="o">/</span><span class="mi">200</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span> <span class="o">+=</span> <span class="n">HALPHA</span><span class="o">.</span><span class="n">gaussian_model</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span> <span class="o">+=</span> <span class="n">HBETA</span><span class="o">.</span><span class="n">gaussian_model</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span> <span class="o">+=</span> <span class="n">O2</span><span class="o">.</span><span class="n">gaussian_model</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span> <span class="n">A</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span><span class="o">.</span><span class="n">lambdas</span> <span class="o">=</span> <span class="n">lambdas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">spectrum</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span><span class="o">.</span><span class="n">err</span> <span class="o">=</span> <span class="n">spectrum_err</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fwhm_func</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">lambdas</span><span class="p">)</span>
</pre></div>
</div>
<p>Detect the lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span> <span class="o">=</span> <span class="n">Lines</span><span class="p">([</span><span class="n">HALPHA</span><span class="p">,</span> <span class="n">HBETA</span><span class="p">,</span> <span class="n">O2</span><span class="p">],</span> <span class="n">hydrogen_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span><span class="n">atmospheric_lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">redshift</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">emission_spectrum</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">global_chisq</span> <span class="o">=</span> <span class="n">detect_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">lambdas</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">spectrum_err</span><span class="p">,</span> <span class="n">fwhm_func</span><span class="o">=</span><span class="n">fwhm_func</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot the result:</p>
<p>(<a class="reference external" href="../source/spectractor-extractor-10.py">Source code</a>)</p>
<div class="figure align-default">
<img alt="../_images/spectractor-extractor-10.png" src="../_images/spectractor-extractor-10.png" />
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectroscopy.Lines.sort_lines">
<code class="sig-name descname">sort_lines</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectroscopy.html#Lines.sort_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectroscopy.Lines.sort_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Sort the lines in increasing order of wavelength, and add the redshift effect.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>sorted_lines</strong> – List of the sorted lines</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)">list</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span> <span class="o">=</span> <span class="n">Lines</span><span class="p">(</span><span class="n">HYDROGEN_LINES</span><span class="o">+</span><span class="n">ATMOSPHERIC_LINES</span><span class="p">,</span> <span class="n">redshift</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_lines</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">sort_lines</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">wavelength</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">sorted_lines</span><span class="p">][:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[382.044, 393.366, 396.847, 410.2, 430.79]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-spectractor.extractor.spectrum">
<span id="spectractor-extractor-spectrum-module"></span><h2>spectractor.extractor.spectrum module<a class="headerlink" href="#module-spectractor.extractor.spectrum" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="spectractor.extractor.spectrum.Spectrum">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.spectrum.</code><code class="sig-name descname">Spectrum</code><span class="sig-paren">(</span><em class="sig-param">file_name=''</em>, <em class="sig-param">image=None</em>, <em class="sig-param">order=1</em>, <em class="sig-param">target=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.convert_from_ADUrate_to_flam">
<code class="sig-name descname">convert_from_ADUrate_to_flam</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.convert_from_ADUrate_to_flam"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.convert_from_ADUrate_to_flam" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert units from ADU/s to erg/s/cm^2/nm.
The SED is supposed to be in flam units ie erg/s/cm^2/nm</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;tests/data/reduc_20170605_028_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">convert_from_ADUrate_to_flam</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.convert_from_flam_to_ADUrate">
<code class="sig-name descname">convert_from_flam_to_ADUrate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.convert_from_flam_to_ADUrate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.convert_from_flam_to_ADUrate" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert units from erg/s/cm^2/nm to ADU/s.
The SED is supposed to be in flam units ie erg/s/cm^2/nm</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;tests/data/reduc_20170605_028_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">convert_from_flam_to_ADUrate</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.load_chromatic_psf">
<code class="sig-name descname">load_chromatic_psf</code><span class="sig-paren">(</span><em class="sig-param">input_file_name</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.load_chromatic_psf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.load_chromatic_psf" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the spectrum from a fits file (data, error and wavelengths).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>input_file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Path to the input fits file</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">load_spectrum</span><span class="p">(</span><span class="s1">&#39;outputs/reduc_20170530_134_spectrum.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.load_filter">
<code class="sig-name descname">load_filter</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.load_filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.load_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Load filter properties and set relevant LAMBDA_MIN and LAMBDA_MAX values.</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="s1">&#39;FGB37&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">load_filter</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.load_spectrogram">
<code class="sig-name descname">load_spectrogram</code><span class="sig-paren">(</span><em class="sig-param">input_file_name</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.load_spectrogram"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.load_spectrogram" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the spectrum from a fits file (data, error and wavelengths).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>input_file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Path to the input fits file</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">load_spectrum</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028_spectrum.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.load_spectrum">
<code class="sig-name descname">load_spectrum</code><span class="sig-paren">(</span><em class="sig-param">input_file_name</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.load_spectrum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.load_spectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the spectrum from a fits file (data, error and wavelengths).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>input_file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Path to the input fits file</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">load_spectrum</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<span class="go">erg/s/cm$^2$/nm</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.plot_spectrogram">
<code class="sig-name descname">plot_spectrogram</code><span class="sig-paren">(</span><em class="sig-param">ax=None, scale='lin', title='', units='Image units', plot_stats=False, target_pixcoords=None, vmin=None, vmax=None, figsize=[9.3, 8], aspect=None, cmap=None, cax=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.plot_spectrogram"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.plot_spectrogram" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot spectrogram.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ax</strong> (<em>Axes</em><em>, </em><em>optional</em>) – Axes instance (default: None).</p></li>
<li><p><strong>scale</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Scaling of the image (choose between: lin, log or log10) (default: lin)</p></li>
<li><p><strong>title</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Title of the image (default: “”)</p></li>
<li><p><strong>units</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Units of the image to be written in the color bar label (default: “Image units”)</p></li>
<li><p><strong>cmap</strong> (<em>colormap</em>) – Color map label (default: None)</p></li>
<li><p><strong>target_pixcoords</strong> (<em>array_like</em><em>, </em><em>optional</em>) – 2D array  giving the (x,y) coordinates of the targets on the image: add a scatter plot (default: None)</p></li>
<li><p><strong>vmin</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Minimum value of the image (default: None)</p></li>
<li><p><strong>vmax</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Maximum value of the image (default: None)</p></li>
<li><p><strong>aspect</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Aspect keyword to be passed to imshow (default: None)</p></li>
<li><p><strong>cax</strong> (<em>Axes</em><em>, </em><em>optional</em>) – Color bar axes if necessary (default: None).</p></li>
<li><p><strong>figsize</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><em>tuple</em></a>) – Figure size (default: [9.3, 8]).</p></li>
<li><p><strong>plot_stats</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True, plot the uncertainty map instead of the spectrogram (default: False).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;tests/data/reduc_20170605_028_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_spectrogram</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../source/spectractor-extractor-11.py">Source code</a>)</p>
<div class="figure align-default">
<img alt="../_images/spectractor-extractor-11.png" src="../_images/spectractor-extractor-11.png" />
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.plot_spectrum">
<code class="sig-name descname">plot_spectrum</code><span class="sig-paren">(</span><em class="sig-param">ax=None</em>, <em class="sig-param">xlim=None</em>, <em class="sig-param">live_fit=False</em>, <em class="sig-param">label=''</em>, <em class="sig-param">force_lines=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.plot_spectrum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.plot_spectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot spectrum with emission and absorption lines.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ax</strong> (<em>Axes</em><em>, </em><em>optional</em>) – Axes instance (default: None).</p></li>
<li><p><strong>label</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Label for the legend (default: ‘’).</p></li>
<li><p><strong>xlim</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – List of minimum and maximum abscisses (default: None)</p></li>
<li><p><strong>live_fit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>, </em><em>optional</em>) – If True the spectrum is plotted in live during the fitting procedures
(default: False).</p></li>
<li><p><strong>force_lines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Force the over plot of vertical lines for atomic lines if set to True (default: False).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;tests/data/reduc_20170530_134_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">900</span><span class="p">],</span> <span class="n">live_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_lines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.save_spectrogram">
<code class="sig-name descname">save_spectrogram</code><span class="sig-paren">(</span><em class="sig-param">output_file_name</em>, <em class="sig-param">overwrite=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.save_spectrogram"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.save_spectrogram" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the spectrogram into a fits file (data, error and background).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Path of the output fits file.</p></li>
<li><p><strong>overwrite</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>,  </em><em>optional</em>) – If True overwrite the output file if needed (default: False).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.spectrum.Spectrum.save_spectrum">
<code class="sig-name descname">save_spectrum</code><span class="sig-paren">(</span><em class="sig-param">output_file_name</em>, <em class="sig-param">overwrite=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#Spectrum.save_spectrum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.Spectrum.save_spectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the spectrum into a fits file (data, error and wavelengths).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_file_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Path of the output fits file.</p></li>
<li><p><strong>overwrite</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If True overwrite the output file if needed (default: False).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;tests/data/reduc_20170530_134_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">save_spectrum</span><span class="p">(</span><span class="s1">&#39;./tests/test.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Overwrite previous file:
&gt;&gt;&gt; s.save_spectrum(‘./tests/test.fits’, overwrite=True)</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.spectrum.calibrate_spectrum">
<code class="sig-prename descclassname">spectractor.extractor.spectrum.</code><code class="sig-name descname">calibrate_spectrum</code><span class="sig-paren">(</span><em class="sig-param">spectrum</em>, <em class="sig-param">xlim=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#calibrate_spectrum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.calibrate_spectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert pixels into wavelengths given the position of the order 0,
the data for the spectrum, and the properties of the disperser. Convert the
spectrum amplitude from ADU rate to flams. Truncate the outputs to the wavelenghts
between parameters.LAMBDA_MIN and parameters.LAMBDA_MAX.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spectrum</strong> (<a class="reference internal" href="#spectractor.extractor.spectrum.Spectrum" title="spectractor.extractor.spectrum.Spectrum"><em>Spectrum</em></a>) – Spectrum object to calibrate</p></li>
<li><p><strong>xlim</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>, </em><em>optional</em>) – List of minimum and maximum abscisses</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.spectrum.calibrate_spectrum_with_lines">
<code class="sig-prename descclassname">spectractor.extractor.spectrum.</code><code class="sig-name descname">calibrate_spectrum_with_lines</code><span class="sig-paren">(</span><em class="sig-param">spectrum</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#calibrate_spectrum_with_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.calibrate_spectrum_with_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert pixels into wavelengths given the position of the order 0,
the data for the spectrum, the properties of the disperser. Fit the absorption
(and eventually the emission) lines to perform a second calibration of the
distance between the CCD and the disperser. The number of fitting steps is
limited to 30.</p>
<p>Prerequisites: a first calibration from pixels to wavelengths must have been performed before</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>spectrum</strong> (<a class="reference internal" href="#spectractor.extractor.spectrum.Spectrum" title="spectractor.extractor.spectrum.Spectrum"><em>Spectrum</em></a>) – Spectrum object to calibrate</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>lambdas</strong> – The new wavelength array in nm.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>array_like</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;tests/data/reduc_20170605_028_spectrum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">LAMBDA_MIN</span> <span class="o">=</span> <span class="mi">550</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">LAMBDA_MAX</span> <span class="o">=</span> <span class="mi">800</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lambdas</span> <span class="o">=</span> <span class="n">calibrate_spectrum_with_lines</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.spectrum.detect_lines">
<code class="sig-prename descclassname">spectractor.extractor.spectrum.</code><code class="sig-name descname">detect_lines</code><span class="sig-paren">(</span><em class="sig-param">lines</em>, <em class="sig-param">lambdas</em>, <em class="sig-param">spec</em>, <em class="sig-param">spec_err=None</em>, <em class="sig-param">fwhm_func=None</em>, <em class="sig-param">snr_minlevel=3</em>, <em class="sig-param">ax=None</em>, <em class="sig-param">xlim=(300</em>, <em class="sig-param">1100)</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#detect_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.detect_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Detect and fit the lines in a spectrum. The method is to look at maxima or minima
around emission or absorption tabulated lines, and to select surrounding pixels
to fit a (positive or negative) gaussian and a polynomial background. If several regions
overlap, a multi-gaussian fit is performed above a common polynomial background.
The mean global shift (in nm) between the detected and tabulated lines is returned, considering
only the lines with a signal-to-noise ratio above a threshold.
The order of the polynomial background is set in parameters.py with CALIB_BGD_ORDER.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<a class="reference internal" href="#spectractor.extractor.spectroscopy.Lines" title="spectractor.extractor.spectroscopy.Lines"><em>Lines</em></a>) – The Lines object containing the line characteristics</p></li>
<li><p><strong>lambdas</strong> (<em>float array</em>) – The wavelength array (in nm)</p></li>
<li><p><strong>spec</strong> (<em>float array</em>) – The spectrum amplitude array</p></li>
<li><p><strong>spec_err</strong> (<em>float array</em><em>, </em><em>optional</em>) – The spectrum amplitude uncertainty array (default: None)</p></li>
<li><p><strong>fwhm_func</strong> (<em>callable</em><em>, </em><em>optional</em>) – The fwhm of the cross spectrum to reset CALIB_PEAK_WIDTH parameter as a function of lambda (default: None)</p></li>
<li><p><strong>snr_minlevel</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – The minimum signal over noise ratio to consider using a fitted line in the computation of the mean
shift output and to print it in the outpur table (default: 3)</p></li>
<li><p><strong>ax</strong> (<em>Axes</em><em>, </em><em>optional</em>) – An Axes instance to over plot the result of the fit (default: None).</p></li>
<li><p><strong>xlim</strong> (<em>array</em><em>, </em><em>optional</em>) – (min, max) list limiting the wavelength interval where to detect spectral lines (default:
(parameters.LAMBDA_MIN, parameters.LAMBDA_MAX))</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>shift</strong> – The mean shift (in nm) between the detected and tabulated lines</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Creation of a mock spectrum with emission and absorption lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spectractor.extractor.spectroscopy</span> <span class="k">import</span> <span class="n">Lines</span><span class="p">,</span> <span class="n">HALPHA</span><span class="p">,</span> <span class="n">HBETA</span><span class="p">,</span> <span class="n">O2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lambdas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span> <span class="o">=</span> <span class="mf">1e4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">lambdas</span><span class="o">-</span><span class="mi">600</span><span class="p">)</span><span class="o">/</span><span class="mi">200</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span> <span class="o">+=</span> <span class="n">HALPHA</span><span class="o">.</span><span class="n">gaussian_model</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span> <span class="o">+=</span> <span class="n">HBETA</span><span class="o">.</span><span class="n">gaussian_model</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span> <span class="o">+=</span> <span class="n">O2</span><span class="o">.</span><span class="n">gaussian_model</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span> <span class="n">A</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span><span class="o">.</span><span class="n">lambdas</span> <span class="o">=</span> <span class="n">lambdas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">spectrum</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span><span class="o">.</span><span class="n">err</span> <span class="o">=</span> <span class="n">spectrum_err</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fwhm_func</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">lambdas</span><span class="p">)</span>
</pre></div>
</div>
<p>Detect the lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span> <span class="o">=</span> <span class="n">Lines</span><span class="p">([</span><span class="n">HALPHA</span><span class="p">,</span> <span class="n">HBETA</span><span class="p">,</span> <span class="n">O2</span><span class="p">],</span> <span class="n">hydrogen_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span><span class="n">atmospheric_lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">redshift</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">emission_spectrum</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">global_chisq</span> <span class="o">=</span> <span class="n">detect_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">lambdas</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">spectrum_err</span><span class="p">,</span> <span class="n">fwhm_func</span><span class="o">=</span><span class="n">fwhm_func</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot the result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot_spectrum_simple</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">lambdas</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">data_err</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">err</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span><span class="o">.</span><span class="n">plot_detected_lines</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">DISPLAY</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.spectrum.extract_spectrum_from_image">
<code class="sig-prename descclassname">spectractor.extractor.spectrum.</code><code class="sig-name descname">extract_spectrum_from_image</code><span class="sig-paren">(</span><em class="sig-param">image</em>, <em class="sig-param">spectrum</em>, <em class="sig-param">w=10</em>, <em class="sig-param">ws=(20</em>, <em class="sig-param">30)</em>, <em class="sig-param">right_edge=1848</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/spectrum.html#extract_spectrum_from_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.spectrum.extract_spectrum_from_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the 1D spectrum from the image.</p>
<p>Method : remove a uniform background estimated from the rectangular lateral bands</p>
<p>The spectrum amplitude is the sum of the pixels in the 2*w rectangular window
centered on the order 0 y position.
The up and down backgrounds are estimated as the median in rectangular regions
above and below the spectrum, in the ws-defined rectangular regions; stars are filtered
as nan values using an hessian analysis of the image to remove structures.
The subtracted background is the mean of the two up and down backgrounds.
Stars are filtered.</p>
<dl class="simple">
<dt>Prerequisites: the target position must have been found before, and the</dt><dd><p>image turned to have an horizontal dispersion line</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<a class="reference internal" href="#spectractor.extractor.images.Image" title="spectractor.extractor.images.Image"><em>Image</em></a>) – Image object from which to extract the spectrum</p></li>
<li><p><strong>spectrum</strong> (<a class="reference internal" href="#spectractor.extractor.spectrum.Spectrum" title="spectractor.extractor.spectrum.Spectrum"><em>Spectrum</em></a>) – Spectrum object to store new wavelengths, data and error arrays</p></li>
<li><p><strong>w</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Half width of central region where the spectrum is extracted and summed (default: 10)</p></li>
<li><p><strong>ws</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a>) – up/down region extension where the sky background is estimated with format [int, int] (default: [20,30])</p></li>
<li><p><strong>right_edge</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Right-hand pixel position above which no pixel should be used (default: 1800)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-spectractor.extractor.targets">
<span id="spectractor-extractor-targets-module"></span><h2>spectractor.extractor.targets module<a class="headerlink" href="#module-spectractor.extractor.targets" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="spectractor.extractor.targets.ArcLamp">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.targets.</code><code class="sig-name descname">ArcLamp</code><span class="sig-paren">(</span><em class="sig-param">label</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#ArcLamp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.ArcLamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.targets.Target" title="spectractor.extractor.targets.Target"><code class="xref py py-class docutils literal notranslate"><span class="pre">spectractor.extractor.targets.Target</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.targets.ArcLamp.load">
<code class="sig-name descname">load</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#ArcLamp.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.ArcLamp.load" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.targets.Monochromator">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.targets.</code><code class="sig-name descname">Monochromator</code><span class="sig-paren">(</span><em class="sig-param">label</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Monochromator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Monochromator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.targets.Target" title="spectractor.extractor.targets.Target"><code class="xref py py-class docutils literal notranslate"><span class="pre">spectractor.extractor.targets.Target</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.targets.Monochromator.load">
<code class="sig-name descname">load</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Monochromator.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Monochromator.load" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.targets.Star">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.targets.</code><code class="sig-name descname">Star</code><span class="sig-paren">(</span><em class="sig-param">label</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Star"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Star" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#spectractor.extractor.targets.Target" title="spectractor.extractor.targets.Target"><code class="xref py py-class docutils literal notranslate"><span class="pre">spectractor.extractor.targets.Target</span></code></a></p>
<dl class="method">
<dt id="spectractor.extractor.targets.Star.build_sed">
<code class="sig-name descname">build_sed</code><span class="sig-paren">(</span><em class="sig-param">index=0</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Star.build_sed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Star.build_sed" title="Permalink to this definition">¶</a></dt>
<dd><p>Interpolate the database reference spectra and return self.sed as a function of the wavelength.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>index</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Index of the spectrum stored in the self.spectra list</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Star</span><span class="p">(</span><span class="s1">&#39;HD111980&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">build_sed</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">sed</span><span class="p">(</span><span class="mi">550</span><span class="p">)</span>
<span class="go">array(1.67605113e-11)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.targets.Star.load">
<code class="sig-name descname">load</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Star.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Star.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the coordinates of the target.</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Star</span><span class="p">(</span><span class="s1">&#39;3C273&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">coord</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
<span class="go">2d03m08.598s</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.targets.Star.load_spectra">
<code class="sig-name descname">load_spectra</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Star.load_spectra"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Star.load_spectra" title="Permalink to this definition">¶</a></dt>
<dd><p>Load reference spectra from Pysynphot database or NED database.</p>
<p>If the object redshift is &gt;0.2, the LAMBDA_MIN and LAMBDA_MAX parameters
are redshifted accordingly.</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Star</span><span class="p">(</span><span class="s1">&#39;3C273&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">4</span><span class="p">])</span>
<span class="go">[0.0000000e+00 2.5048577e-14 2.4238061e-14 2.4088789e-14]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Star</span><span class="p">(</span><span class="s1">&#39;HD111980&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">4</span><span class="p">])</span>
<span class="go">[2.16890002e-13 2.66480010e-13 2.03540011e-13 2.38780004e-13]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Star</span><span class="p">(</span><span class="s1">&#39;PKS1510-089&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">redshift</span><span class="p">)</span>
<span class="go">0.36</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{parameters.LAMBDA_MIN:.1f}</span><span class="s1">, </span><span class="si">{parameters.LAMBDA_MAX:.1f}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="go">408.0, 1496.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">4</span><span class="p">])</span>
<span class="go">[117.34012 139.27621  87.38032 143.0816 ]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="spectractor.extractor.targets.Star.plot_spectra">
<code class="sig-name descname">plot_spectra</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Star.plot_spectra"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Star.plot_spectra" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the spectra stored in the self.spectra list.</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Star</span><span class="p">(</span><span class="s1">&#39;HD111980&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">plot_spectra</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="spectractor.extractor.targets.Target">
<em class="property">class </em><code class="sig-prename descclassname">spectractor.extractor.targets.</code><code class="sig-name descname">Target</code><span class="sig-paren">(</span><em class="sig-param">label</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#Target"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.Target" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
</dd></dl>

<dl class="function">
<dt id="spectractor.extractor.targets.load_target">
<code class="sig-prename descclassname">spectractor.extractor.targets.</code><code class="sig-name descname">load_target</code><span class="sig-paren">(</span><em class="sig-param">label</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spectractor/extractor/targets.html#load_target"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#spectractor.extractor.targets.load_target" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the target properties according to the type set by parameters.OBS_OBJECT_TYPE.</p>
<p>Currently, the type can be either “STAR”, “HG-AR” or “MONOCHROMATOR”. The label parameter gives the
name of the source and allows to load its specific properties.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>label</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The label of the target.</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>, </em><em>optional</em>) – If True, more verbosity (default: False).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">OBS_OBJECT_TYPE</span> <span class="o">=</span> <span class="s2">&quot;STAR&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">load_target</span><span class="p">(</span><span class="s2">&quot;HD111980&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
<span class="go">HD111980</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">coord</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
<span class="go">-18d31m20.009s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">OBS_OBJECT_TYPE</span> <span class="o">=</span> <span class="s2">&quot;MONOCHROMATOR&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">load_target</span><span class="p">(</span><span class="s2">&quot;XX&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
<span class="go">XX</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">OBS_OBJECT_TYPE</span> <span class="o">=</span> <span class="s2">&quot;HG-AR&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">load_target</span><span class="p">(</span><span class="s2">&quot;XX&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">wavelength</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">lines</span><span class="p">][:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[253.652, 296.728, 302.15, 313.155, 334.148]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span><span class="o">.</span><span class="n">OBS_OBJECT_TYPE</span> <span class="o">=</span> <span class="s2">&quot;OTHER&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">load_target</span><span class="p">(</span><span class="s2">&quot;XX&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-spectractor.extractor">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-spectractor.extractor" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="spectractor.fit.html" class="btn btn-neutral float-right" title="spectractor.fit package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="spectractor.html" class="btn btn-neutral float-left" title="spectractor package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Jeremy Neveu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>